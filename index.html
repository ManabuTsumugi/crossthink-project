<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† v5.0 - AIËá™ÂæãÂØæË©±„Ç∑„Çπ„ÉÜ„É†</title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           min-height: 100vh;
           padding: 20px;
       }

       .container {
           max-width: 1200px;
           margin: 0 auto;
           background: rgba(255, 255, 255, 0.95);
           border-radius: 20px;
           box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
           overflow: hidden;
       }

       .header {
           background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
           color: white;
           padding: 30px;
           text-align: center;
       }

       .header h1 {
           font-size: 2.5em;
           margin-bottom: 10px;
           text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
       }

       .header p {
           font-size: 1.2em;
           opacity: 0.9;
       }

       .demo-label {
           background: rgba(255, 255, 255, 0.2);
           padding: 10px 20px;
           border-radius: 25px;
           display: inline-block;
           margin-top: 15px;
           font-weight: bold;
       }

       .mode-tabs {
           display: flex;
           background: #f8f9fa;
           border-bottom: 2px solid #e9ecef;
       }

       .tab-button {
           flex: 1;
           padding: 20px;
           border: none;
           background: transparent;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s;
           border-bottom: 3px solid transparent;
       }

       .tab-button.active {
           background: white;
           border-bottom-color: #4facfe;
           color: #4facfe;
       }

       .tab-button:hover:not(.active) {
           background: rgba(79, 172, 254, 0.1);
       }

       .tab-content {
           display: none;
           padding: 30px;
       }

       .tab-content.active {
           display: block;
       }

       /* Ëá™ÂæãÂØæË©±„É¢„Éº„Éâ */
       .autonomous-section {
           background: #f0f8ff;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           border-left: 4px solid #4facfe;
       }

       .autonomous-controls {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin-bottom: 20px;
       }

       .control-group {
           background: white;
           padding: 15px;
           border-radius: 10px;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
       }

       .control-group h4 {
           margin-bottom: 10px;
           color: #333;
       }

       .slider-container {
           margin: 10px 0;
       }

       .slider-label {
           display: flex;
           justify-content: space-between;
           margin-bottom: 5px;
           font-size: 0.9em;
           color: #666;
       }

       .range-slider {
           width: 100%;
           height: 6px;
           border-radius: 3px;
           background: linear-gradient(90deg, #ff6b6b, #feca57, #48cae4);
           outline: none;
           -webkit-appearance: none;
       }

       .range-slider::-webkit-slider-thumb {
           -webkit-appearance: none;
           appearance: none;
           width: 20px;
           height: 20px;
           border-radius: 50%;
           background: white;
           border: 3px solid #4facfe;
           cursor: pointer;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
       }

       .range-slider::-moz-range-thumb {
           width: 20px;
           height: 20px;
           border-radius: 50%;
           background: white;
           border: 3px solid #4facfe;
           cursor: pointer;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
       }

       /* ‰∫∫Èñì‰ªãÂÖ•„É¢„Éº„Éâ */
       .intervention-section {
           background: #fff8e1;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           border-left: 4px solid #ffc107;
       }

       .human-input-area {
           background: white;
           padding: 20px;
           border-radius: 10px;
           margin-bottom: 20px;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
       }

       .human-input {
           width: 100%;
           min-height: 100px;
           padding: 15px;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           font-size: 16px;
           resize: vertical;
           margin-bottom: 15px;
       }

       .human-input:focus {
           outline: none;
           border-color: #ffc107;
       }

       .intervention-buttons {
           display: flex;
           gap: 10px;
           flex-wrap: wrap;
       }

       /* Â≠¶ÁøíÊ©üËÉΩ */
       .learning-section {
           background: #e8f5e8;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           border-left: 4px solid #4caf50;
       }

       .knowledge-base {
           background: white;
           padding: 20px;
           border-radius: 10px;
           margin-bottom: 20px;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
           max-height: 300px;
           overflow-y: auto;
       }

       .knowledge-item {
           padding: 10px;
           border-bottom: 1px solid #eee;
           margin-bottom: 10px;
       }

       .knowledge-item:last-child {
           border-bottom: none;
       }

       .knowledge-topic {
           font-weight: bold;
           color: #4caf50;
           margin-bottom: 5px;
       }

       .knowledge-content {
           font-size: 0.9em;
           color: #666;
       }

       .quick-buttons {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
           gap: 15px;
           margin-bottom: 20px;
       }

       .quick-btn {
           padding: 15px 20px;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           border: none;
           border-radius: 15px;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s;
           text-align: left;
       }

       .quick-btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
       }

       .config-section {
           padding: 30px;
           background: #f8f9fa;
           border-bottom: 1px solid #e9ecef;
       }

       .config-grid {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin-bottom: 20px;
       }

       .api-config {
           background: white;
           padding: 20px;
           border-radius: 15px;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
       }

       .api-config h3 {
           margin-bottom: 10px;
           color: #333;
           display: flex;
           align-items: center;
           gap: 10px;
       }

       .openai-config h3::before {
           content: "üü¢";
           font-size: 1.2em;
       }

       .gemini-config h3::before {
           content: "üî∑";
           font-size: 1.2em;
       }

       .api-input {
           width: 100%;
           padding: 12px;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           font-size: 14px;
           transition: border-color 0.3s;
       }

       .api-input:focus {
           outline: none;
           border-color: #4facfe;
       }

       .topic-section {
           padding: 20px 30px;
       }

       .topic-input {
           width: 100%;
           padding: 15px;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           font-size: 16px;
           margin-bottom: 20px;
       }

       .controls {
           display: flex;
           gap: 15px;
           justify-content: center;
           flex-wrap: wrap;
       }

       .btn {
           padding: 12px 24px;
           border: none;
           border-radius: 25px;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s;
           text-decoration: none;
           display: inline-flex;
           align-items: center;
           gap: 8px;
       }

       .btn-primary {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
       }

       .btn-danger {
           background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
           color: white;
       }

       .btn-secondary {
           background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
           color: #2d3436;
       }

       .btn-warning {
           background: linear-gradient(135deg, #ffc107 0%, #ff8800 100%);
           color: white;
       }

       .btn-success {
           background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
           color: white;
       }

       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
       }

       .btn:disabled {
           opacity: 0.6;
           cursor: not-allowed;
           transform: none;
       }

       .stats-section {
           padding: 20px 30px;
           background: #f8f9fa;
       }

       .stats-grid {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
           gap: 15px;
       }

       .stat-card {
           background: white;
           padding: 20px;
           border-radius: 15px;
           text-align: center;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
       }

       .stat-number {
           font-size: 2.5em;
           font-weight: bold;
           margin-bottom: 5px;
       }

       .stat-label {
           color: #666;
           font-size: 0.9em;
       }

       .openai-stat .stat-number { color: #10a37f; }
       .gemini-stat .stat-number { color: #4285f4; }
       .human-stat .stat-number { color: #ffc107; }
       .learning-stat .stat-number { color: #4caf50; }

       .error-display, .warning-display {
           padding: 15px;
           margin: 20px 30px;
           border-radius: 10px;
           text-align: center;
           display: none;
       }

       .error-display {
           background: #ff6b6b;
           color: white;
       }

       .warning-display {
           background: #ffa500;
           color: white;
       }

       .chat-container {
           padding: 30px;
           min-height: 400px;
           max-height: 600px;
           overflow-y: auto;
       }

       .message {
           margin-bottom: 20px;
           padding: 20px;
           border-radius: 15px;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
           animation: fadeIn 0.5s ease-in;
       }

       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(20px); }
           to { opacity: 1; transform: translateY(0); }
       }

       .message-header {
           display: flex;
           align-items: center;
           gap: 10px;
           margin-bottom: 10px;
           font-weight: bold;
       }

       .message-time {
           margin-left: auto;
           font-size: 0.8em;
           opacity: 0.7;
       }

       .system-message {
           background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
           border-left: 5px solid #fdcb6e;
       }

       .openai-message {
           background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
           border-left: 5px solid #10a37f;
       }

       .gemini-message {
           background: linear-gradient(135deg, #b3d9ff 0%, #d4edda 100%);
           border-left: 5px solid #4285f4;
       }

       .human-message {
           background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
           border-left: 5px solid #ffc107;
       }

       .learning-message {
           background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
           border-left: 5px solid #4caf50;
       }

       .thinking {
           font-style: italic;
           opacity: 0.8;
           color: #666;
       }

       .intervention-prompt {
           background: #fffbf0;
           border: 2px dashed #ffc107;
           padding: 15px;
           border-radius: 10px;
           margin: 10px 0;
           text-align: center;
           color: #856404;
       }

       .deepening-request {
           background: #f0f8ff;
           border: 2px dashed #4facfe;
           padding: 15px;
           border-radius: 10px;
           margin: 10px 0;
           text-align: center;
           color: #0056b3;
       }

       .auto-pause-notice {
           background: #e3f2fd;
           color: #0d47a1;
           padding: 10px;
           border-radius: 8px;
           margin: 10px 0;
           border-left: 4px solid #2196f3;
       }

       .monetization-info {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           padding: 20px;
           margin: 20px 30px;
           border-radius: 15px;
       }

       .monetization-info h3 {
           margin-bottom: 15px;
           font-size: 1.2em;
       }

       .monetization-info ul {
           list-style: none;
           padding: 0;
       }

       .monetization-info li {
           padding: 5px 0;
           padding-left: 25px;
           position: relative;
       }

       .monetization-info li::before {
           content: "üöÄ";
           position: absolute;
           left: 0;
       }

       @media (max-width: 768px) {
           .config-grid, .quick-buttons, .autonomous-controls {
               grid-template-columns: 1fr;
           }
           
           .controls, .intervention-buttons {
               flex-direction: column;
               align-items: center;
           }
           
           .btn {
               width: 100%;
               max-width: 300px;
           }

           .mode-tabs {
               flex-direction: column;
           }

           .tab-button {
               border-bottom: none;
               border-right: 3px solid transparent;
           }

           .tab-button.active {
               border-right-color: #4facfe;
               border-bottom: none;
           }
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>üåü Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</h1>
           <p>AIËá™ÂæãÂØæË©±„Éª‰∫∫Èñì‰ªãÂÖ•„ÉªÂ≠¶ÁøíÊ©üËÉΩÊê≠Ëºâ„Ç∑„Çπ„ÉÜ„É†</p>
           <div class="demo-label">
               üöÄ v5.0 - Advanced Interactive Edition
           </div>
       </div>

       <div class="mode-tabs">
           <button class="tab-button active" onclick="switchTab('autonomous')">
               ü§ñ AIËá™ÂæãÂØæË©±
           </button>
           <button class="tab-button" onclick="switchTab('intervention')">
               üë§ ‰∫∫Èñì‰ªãÂÖ•„É¢„Éº„Éâ
           </button>
           <button class="tab-button" onclick="switchTab('learning')">
               üß† Â≠¶ÁøíÊ©üËÉΩ
           </button>
       </div>

       <!-- AIËá™ÂæãÂØæË©±„Çø„Éñ -->
       <div id="autonomous-tab" class="tab-content active">
           <div class="autonomous-section">
               <h3>ü§ñ AIËá™ÂæãÂØæË©±Ë®≠ÂÆö</h3>
               <div class="autonomous-controls">
                   <div class="control-group">
                       <h4>üéØ ÂØæË©±„É¢„Éº„Éâ</h4>
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>üè† ÂÆüÁî®ÁöÑ</span>
                               <span>üíº „Éì„Ç∏„Éç„Çπ</span>
                               <span>üß† Âì≤Â≠¶ÁöÑ</span>
                           </div>
                           <input type="range" id="targetModeSlider" class="range-slider" min="0" max="100" value="33">
                       </div>
                       
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>üí° Ê°àÂá∫„Åó</span>
                               <span>ü§ù ÂêàÊÑèÂΩ¢Êàê</span>
                               <span>üîç Êé¢Á¥¢</span>
                           </div>
                           <input type="range" id="goalModeSlider" class="range-slider" min="0" max="100" value="50">
                       </div>
                   </div>

                   <div class="control-group">
                       <h4>‚öôÔ∏è Ëá™ÂæãÂØæË©±Ë®≠ÂÆö</h4>
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>Áü≠ÊôÇÈñìÈõÜ‰∏≠</span>
                               <span id="autonomyLengthLabel">Ê®ôÊ∫ñ (8„É°„ÉÉ„Çª„Éº„Ç∏)</span>
                               <span>Ê∑±„ÅÑÊé¢Ê±Ç</span>
                           </div>
                           <input type="range" id="autonomyLengthSlider" class="range-slider" min="4" max="20" value="8">
                       </div>
                       
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>‰∫∫Èñì‰ªãÂÖ•: „Å™„Åó</span>
                               <span id="interventionFreqLabel">‰∏≠Á®ãÂ∫¶</span>
                               <span>È†ªÁπÅ</span>
                           </div>
                           <input type="range" id="interventionFreqSlider" class="range-slider" min="0" max="10" value="3">
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <!-- ‰∫∫Èñì‰ªãÂÖ•„Çø„Éñ -->
       <div id="intervention-tab" class="tab-content">
           <div class="intervention-section">
               <h3>üë§ ‰∫∫Èñì‰ªãÂÖ•„Ç≥„É≥„Éà„É≠„Éº„É´</h3>
               <div class="human-input-area">
                   <h4>üí¨ „ÅÇ„Å™„Åü„ÅÆÁô∫Ë®Ä</h4>
                   <textarea id="humanInput" class="human-input" 
                            placeholder="AI„ÅÆÂØæË©±„Å´‰ªãÂÖ•„Åó„Åü„ÅÑÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇË≥™Âïè„ÄÅÊåáÊëò„ÄÅÊñ∞„Åó„ÅÑË¶ñÁÇπ„ÅÆÊèê‰æõ„Å™„Å©„ÄÅËá™Áî±„Å´Áô∫Ë®Ä„Åß„Åç„Åæ„Åô„ÄÇ"></textarea>
                   
                   <div class="intervention-buttons">
                       <button class="btn btn-warning" onclick="humanIntervention()">
                           üí¨ ÂØæË©±„Å´‰ªãÂÖ•
                       </button>
                       <button class="btn btn-secondary" onclick="requestDeepening()">
                           üîç Ë´ñÁÇπ„ÇíÊ∑±Êéò„ÇäË¶ÅÊ±Ç
                       </button>
                       <button class="btn btn-primary" onclick="redirectDialogue()">
                           üéØ ÂØæË©±„ÅÆÊñπÂêëËª¢Êèõ
                       </button>
                       <button class="btn btn-success" onclick="saveInsight()">
                           üí° Ê¥ûÂØü„ÇíÂ≠¶Áøí„Éá„Éº„Çø„Å´‰øùÂ≠ò
                       </button>
                   </div>
               </div>
               
               <div class="quick-buttons">
                   <button class="quick-btn" onclick="quickIntervention('ÂÖ∑‰Ωì‰æã')">
                       üìù „ÄåÂÖ∑‰Ωì‰æã„ÇíÊïô„Åà„Å¶„Äç
                   </button>
                   <button class="quick-btn" onclick="quickIntervention('ÂèçÂØæÊÑèË¶ã')">
                       üîÑ „ÄåÂèçÂØæ„ÅÆË¶ñÁÇπ„Åß„ÅØÔºü„Äç
                   </button>
                   <button class="quick-btn" onclick="quickIntervention('ÂÆüÁî®ÊÄß')">
                       üõ†Ô∏è „ÄåÂÆüÁî®ÊÄß„ÇíÈáçË¶ñ„Åó„Å¶„Äç
                   </button>
                   <button class="quick-btn" onclick="quickIntervention('Á∞°ÊΩî„Å´')">
                       ‚úÇÔ∏è „Äå„ÇÇ„Å£„Å®Á∞°ÊΩî„Å´„Äç
                   </button>
               </div>
           </div>
       </div>

       <!-- Â≠¶ÁøíÊ©üËÉΩ„Çø„Éñ -->
       <div id="learning-tab" class="tab-content">
           <div class="learning-section">
               <h3>üß† Ê±éÁî®AIÂ≠¶ÁøíÊ©üËÉΩ</h3>
               <div class="knowledge-base" id="knowledgeBase">
                   <div class="knowledge-item">
                       <div class="knowledge-topic">„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ</div>
                       <div class="knowledge-content">Crossthink v5.0 Â≠¶ÁøíÊ©üËÉΩ„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åó„Åü„ÄÇÂØæË©±„Åã„ÇâÂæó„Çâ„Çå„ÅüÊ¥ûÂØü„ÇíËá™ÂãïÂ≠¶Áøí„Åó„Åæ„Åô„ÄÇ</div>
                   </div>
               </div>
               
               <div class="controls">
                   <button class="btn btn-success" onclick="exportKnowledge()">
                       üì§ Â≠¶Áøí„Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                   </button>
                   <button class="btn btn-primary" onclick="importKnowledge()">
                       üì• Â≠¶Áøí„Éá„Éº„Çø„Ç§„É≥„Éù„Éº„Éà
                   </button>
                   <button class="btn btn-warning" onclick="clearKnowledge()">
                       üóëÔ∏è Â≠¶Áøí„Éá„Éº„Çø„ÇØ„É™„Ç¢
                   </button>
                   <button class="btn btn-secondary" onclick="showLearningStats()">
                       üìä Â≠¶ÁøíÁµ±Ë®àË°®Á§∫
                   </button>
               </div>
           </div>
       </div>

       <div class="config-section">
           <h2>üîß APIË®≠ÂÆö</h2>
           <div class="config-grid">
               <div class="api-config openai-config">
                   <h3>OpenAI API Key:</h3>
                   <input type="password" id="openaiKey" class="api-input" placeholder="sk-proj-...">
               </div>
               <div class="api-config gemini-config">
                   <h3>Gemini API Key:</h3>
                   <input type="password" id="geminiKey" class="api-input" placeholder="AIza...">
               </div>
           </div>
       </div>

       <div class="topic-section">
           <h2>üìù ÂØæË©±„Éà„Éî„ÉÉ„ÇØ:</h2>
           <input type="text" id="topicInput" class="topic-input" 
                  placeholder="AIÂêåÂ£´„Å´ÂØæË©±„Åï„Åõ„Åü„ÅÑ„Éà„Éî„ÉÉ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" 
                  value="AIÊôÇ‰ª£„Å´„Åä„Åë„Çã‰∫∫Èñì„ÅÆÂâµÈÄ†ÊÄß„Å®„ÅØ‰Ωï„ÅãÔºü">
           
           <div class="controls">
               <button id="startBtn" class="btn btn-primary">üöÄ ÂØæË©±ÈñãÂßã</button>
               <button id="pauseBtn" class="btn btn-warning" disabled>‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢</button>
               <button id="stopBtn" class="btn btn-danger" disabled>‚èπÔ∏è ÂÅúÊ≠¢</button>
               <button id="clearBtn" class="btn btn-secondary">üóëÔ∏è „ÇØ„É™„Ç¢</button>
               <button id="exportBtn" class="btn btn-secondary">üìù Ë¶ÅÁ¥ÑÁîüÊàê</button>
           </div>
       </div>

       <div class="stats-section">
           <h2>üìä ÂØæË©±Áµ±Ë®à</h2>
           <div class="stats-grid">
               <div class="stat-card">
                   <div class="stat-number" id="totalMessages">0</div>
                   <div class="stat-label">Á∑è„É°„ÉÉ„Çª„Éº„Ç∏Êï∞</div>
               </div>
               <div class="stat-card openai-stat">
                   <div class="stat-number" id="openaiMessages">0</div>
                   <div class="stat-label">ChatGPTÁô∫Ë®Ä</div>
               </div>
               <div class="stat-card gemini-stat">
                   <div class="stat-number" id="geminiMessages">0</div>
                   <div class="stat-label">GeminiÁô∫Ë®Ä</div>
               </div>
               <div class="stat-card human-stat">
                   <div class="stat-number" id="humanMessages">0</div>
                   <div class="stat-label">‰∫∫Èñì‰ªãÂÖ•</div>
               </div>
               <div class="stat-card learning-stat">
                   <div class="stat-number" id="learningItems">1</div>
                   <div class="stat-label">Â≠¶Áøí„Ç¢„Ç§„ÉÜ„É†</div>
               </div>
               <div class="stat-card">
                   <div class="stat-number" id="elapsed">0</div>
                   <div class="stat-label">ÁµåÈÅéÊôÇÈñì(Áßí)</div>
               </div>
           </div>
       </div>

       <div class="error-display" id="errorDisplay"></div>
       <div class="warning-display" id="warningDisplay"></div>

       <div class="monetization-info">
           <h3>üöÄ v5.0 Advanced Interactive Edition „ÅÆÁâπÂæ¥:</h3>
           <ul>
               <li>AIÂêåÂ£´„ÅÆËá™ÂæãÂØæË©±„Ç∑„Çπ„ÉÜ„É†ÔºöË®≠ÂÆöÂèØËÉΩ„Å™ÂØæË©±Èï∑„Å®‰ªãÂÖ•È†ªÂ∫¶</li>
               <li>„É™„Ç¢„É´„Çø„Ç§„É†‰∫∫Èñì‰ªãÂÖ•ÔºöÂØæË©±„ÅÆÊµÅ„Çå„ÇíÂ§â„Åà„ÇãÂº∑Âäõ„Å™‰ªãÂÖ•Ê©üËÉΩ</li>
               <li>Ê±éÁî®Â≠¶ÁøíÊ©üËÉΩÔºöÂØæË©±„Åã„ÇâÂæó„Çâ„Çå„ÅüÊ¥ûÂØü„ÇíËá™ÂãïÂ≠¶Áøí„ÉªËìÑÁ©ç</li>
               <li>Ê∑±Êéò„ÇäË¶ÅÊ±Ç„Ç∑„Çπ„ÉÜ„É†ÔºöÁâπÂÆö„ÅÆË´ñÁÇπ„ÇíÊ∑±„ÅèÊé¢Ê±Ç</li>
               <li>ÊñπÂêëËª¢ÊèõÊ©üËÉΩÔºöÂØæË©±„ÅÆÊµÅ„Çå„ÇíÊà¶Áï•ÁöÑ„Å´„Ç≥„É≥„Éà„É≠„Éº„É´</li>
               <li>Â≠¶Áøí„Éá„Éº„ÇøÁÆ°ÁêÜÔºö„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Éª„Ç§„É≥„Éù„Éº„ÉàÊ©üËÉΩ‰ªò„Åç</li>
           </ul>
       </div>

       <div class="chat-container" id="chatContainer">
           <!-- ÂØæË©±„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
       </div>
   </div>

   <script>
       class CrossthinkAdvanced {
           constructor() {
               this.isRunning = false;
               this.isPaused = false;
               this.messageCount = 0;
               this.openaiCount = 0;
               this.geminiCount = 0;
               this.humanCount = 0;
               this.startTime = null;
               this.currentSpeaker = 'openai';
               this.conversationHistory = [];
               this.maxMessages = 8;
               this.interventionPoints = [];
               this.knowledgeBase = new Map();
               this.waitingForIntervention = false;
               
               // „É¢„Éº„ÉâË®≠ÂÆö
               this.targetMode = 'philosophical';
               this.goalMode = 'exploration';
               this.interventionFrequency = 3;
               this.currentTab = 'autonomous';
               
               // Â≠¶ÁøíÊ©üËÉΩ
               this.learningEnabled = true;
               this.autoLearnKeywords = ['ÈáçË¶Å', 'Êú¨Ë≥™', 'Ê†∏ÂøÉ', 'ÁµêË´ñ', 'Áô∫Ë¶ã', 'Ê¥ûÂØü', 'Èù©Êñ∞'];
               
               this.initializeElements();
               this.bindEvents();
               this.showWelcomeMessage();
               this.initializeKnowledgeBase();
               this.updateSliderLabels();
           }

           initializeElements() {
               this.elements = {
                   openaiKey: document.getElementById('openaiKey'),
                   geminiKey: document.getElementById('geminiKey'),
                   topicInput: document.getElementById('topicInput'),
                   startBtn: document.getElementById('startBtn'),
                   pauseBtn: document.getElementById('pauseBtn'),
                   stopBtn: document.getElementById('stopBtn'),
                   clearBtn: document.getElementById('clearBtn'),
                   exportBtn: document.getElementById('exportBtn'),
                   chatContainer: document.getElementById('chatContainer'),
                   errorDisplay: document.getElementById('errorDisplay'),
                   warningDisplay: document.getElementById('warningDisplay'),
                   totalMessages: document.getElementById('totalMessages'),
                   openaiMessages: document.getElementById('openaiMessages'),
                   geminiMessages: document.getElementById('geminiMessages'),
                   humanMessages: document.getElementById('humanMessages'),
                   learningItems: document.getElementById('learningItems'),
                   elapsed: document.getElementById('elapsed'),ÂÜçË©¶Ë°åMÁ∂ö„Åë„ÇãÁ∑®ÈõÜ„Ç∏„É£„Éê„Çπ„ÇØ„É™„Éó„Éà                   // „Çπ„É©„Ç§„ÉÄ„ÉºË¶ÅÁ¥†
                   targetModeSlider: document.getElementById('targetModeSlider'),
                   goalModeSlider: document.getElementById('goalModeSlider'),
                   autonomyLengthSlider: document.getElementById('autonomyLengthSlider'),
                   interventionFreqSlider: document.getElementById('interventionFreqSlider'),
                   autonomyLengthLabel: document.getElementById('autonomyLengthLabel'),
                   interventionFreqLabel: document.getElementById('interventionFreqLabel'),
                   
                   // ‰∫∫Èñì‰ªãÂÖ•Ë¶ÅÁ¥†
                   humanInput: document.getElementById('humanInput'),
                   
                   // Â≠¶ÁøíÊ©üËÉΩË¶ÅÁ¥†
                   knowledgeBase: document.getElementById('knowledgeBase')
               };
           }

           bindEvents() {
               this.elements.startBtn.addEventListener('click', () => this.startDialogue());
               this.elements.pauseBtn.addEventListener('click', () => this.pauseDialogue());
               this.elements.stopBtn.addEventListener('click', () => this.stopDialogue());
               this.elements.clearBtn.addEventListener('click', () => this.clearChat());
               this.elements.exportBtn.addEventListener('click', () => this.generateSummaryPrompt());
               
               // „Çπ„É©„Ç§„ÉÄ„Éº„Ç§„Éô„É≥„Éà
               this.elements.targetModeSlider.addEventListener('input', () => this.updateTargetMode());
               this.elements.goalModeSlider.addEventListener('input', () => this.updateGoalMode());
               this.elements.autonomyLengthSlider.addEventListener('input', () => this.updateAutonomyLength());
               this.elements.interventionFreqSlider.addEventListener('input', () => this.updateInterventionFreq());
               
               // Enter„Ç≠„Éº„Åß„ÅÆ‰ªãÂÖ•
               this.elements.humanInput.addEventListener('keydown', (e) => {
                   if (e.key === 'Enter' && e.ctrlKey) {
                       this.humanIntervention();
                   }
               });
           }

           updateSliderLabels() {
               // ÂØæË©±Èï∑„É©„Éô„É´Êõ¥Êñ∞
               this.elements.autonomyLengthSlider.addEventListener('input', () => {
                   const value = this.elements.autonomyLengthSlider.value;
                   this.elements.autonomyLengthLabel.textContent = `${value}„É°„ÉÉ„Çª„Éº„Ç∏`;
                   this.maxMessages = parseInt(value);
               });
               
               // ‰ªãÂÖ•È†ªÂ∫¶„É©„Éô„É´Êõ¥Êñ∞
               this.elements.interventionFreqSlider.addEventListener('input', () => {
                   const value = parseInt(this.elements.interventionFreqSlider.value);
                   const labels = ['„Å™„Åó', 'Á®Ä', 'Â∞ë', '‰∏≠', 'Â§ö', 'È†ªÁπÅ', 'ÈùûÂ∏∏„Å´È†ªÁπÅ', 'Â∏∏ÊôÇ', '„É™„Ç¢„É´„Çø„Ç§„É†', '„Ç∑„É≥„ÇØ„É≠', '„Éï„É´‰ªãÂÖ•'];
                   this.elements.interventionFreqLabel.textContent = labels[value] || '‰∏≠Á®ãÂ∫¶';
                   this.interventionFrequency = value;
               });
           }

           updateTargetMode() {
               const value = parseInt(this.elements.targetModeSlider.value);
               if (value < 33) this.targetMode = 'practical';
               else if (value < 66) this.targetMode = 'business';
               else this.targetMode = 'philosophical';
           }

           updateGoalMode() {
               const value = parseInt(this.elements.goalModeSlider.value);
               if (value < 33) this.goalMode = 'ideation';
               else if (value < 66) this.goalMode = 'consensus';
               else this.goalMode = 'exploration';
           }

           updateAutonomyLength() {
               this.maxMessages = parseInt(this.elements.autonomyLengthSlider.value);
           }

           updateInterventionFreq() {
               this.interventionFrequency = parseInt(this.elements.interventionFreqSlider.value);
           }

           initializeKnowledgeBase() {
               this.knowledgeBase.set('system_init', {
                   topic: '„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ',
                   content: 'Crossthink v5.0 Advanced Interactive Edition „ÅåÂàùÊúüÂåñ„Åï„Çå„Åæ„Åó„Åü„ÄÇ',
                   timestamp: new Date(),
                   source: 'system'
               });
               this.updateKnowledgeDisplay();
           }

           showWelcomeMessage() {
               this.addMessage('system', 
                   'Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† v5.0 Advanced Interactive Edition „Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ\n\n' +
                   'üöÄ v5.0 „ÅÆÊñ∞Ê©üËÉΩ:\n' +
                   '‚Ä¢ ü§ñ AIËá™ÂæãÂØæË©±: AI„ÅåËá™‰∏ªÁöÑ„Å´Ë≠∞Ë´ñ„ÇíÂ±ïÈñã\n' +
                   '‚Ä¢ üë§ ‰∫∫Èñì‰ªãÂÖ•: „É™„Ç¢„É´„Çø„Ç§„É†„ÅßÂØæË©±„Å´ÂèÇÂä†ÂèØËÉΩ\n' +
                   '‚Ä¢ üß† Â≠¶ÁøíÊ©üËÉΩ: ÂØæË©±„Åã„ÇâÊ¥ûÂØü„ÇíËá™ÂãïÂ≠¶Áøí„ÉªËìÑÁ©ç\n' +
                   '‚Ä¢ üîç Ê∑±Êéò„ÇäË¶ÅÊ±Ç: ÁâπÂÆö„ÅÆË´ñÁÇπ„ÇíË©≥„Åó„ÅèÊé¢Ê±Ç\n' +
                   '‚Ä¢ üéØ ÊñπÂêëËª¢Êèõ: ÂØæË©±„ÅÆÊµÅ„Çå„ÇíÊà¶Áï•ÁöÑ„Å´„Ç≥„É≥„Éà„É≠„Éº„É´\n\n' +
                   'üí° ‰Ωø„ÅÑÊñπ:\n' +
                   '1. „Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà„Å¶Ê©üËÉΩ„ÇíË®≠ÂÆö\n' +
                   '2. AIËá™ÂæãÂØæË©±„Åß„Éë„É©„É°„Éº„ÇøË™øÊï¥\n' +
                   '3. API„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Éà„Éî„ÉÉ„ÇØÂÖ•Âäõ\n' +
                   '4. ÂØæË©±ÈñãÂßãÂæå„ÄÅ„ÅÑ„Å§„Åß„ÇÇ‰ªãÂÖ•ÂèØËÉΩ\n\n' +
                   'üéØ Advanced Features:\n' +
                   'üìà „É™„Ç¢„É´„Çø„Ç§„É†Â≠¶Áøí„Ç∑„Çπ„ÉÜ„É†\n' +
                   'üéì ‰∫∫Èñì-AIÂçîÂÉçÊúÄÈÅ©Âåñ\n' +
                   'üí° ÂãïÁöÑ„Å™Ê¥ûÂØüÊäΩÂá∫\n' +
                   'üî¨ ÈÄ≤Âåñ„Åô„ÇãÂØæË©±ÂìÅË≥™'
               );
           }

           async startDialogue() {
               if (!this.validateInputs()) return;

               this.isRunning = true;
               this.isPaused = false;
               this.startTime = Date.now();
               this.currentSpeaker = 'openai';
               this.conversationHistory = [];
               this.interventionPoints = [];
               
               this.elements.startBtn.disabled = true;
               this.elements.pauseBtn.disabled = false;
               this.elements.stopBtn.disabled = false;
               this.hideError();
               this.hideWarning();

               const topic = this.elements.topicInput.value.trim();
               
               this.addMessage('system', 
                   `üöÄ AIËá™ÂæãÂØæË©±ÈñãÂßã\n` +
                   `üìù „Éà„Éî„ÉÉ„ÇØ: "${topic}"\n` +
                   `üé™ „É¢„Éº„Éâ: ${this.getTargetLabel()} √ó ${this.getGoalLabel()}\n` +
                   `‚è±Ô∏è ÊúÄÂ§ß„É°„ÉÉ„Çª„Éº„Ç∏Êï∞: ${this.maxMessages}\n` +
                   `üë§ ‰ªãÂÖ•Ë®≠ÂÆö: ${this.getInterventionLabel()}\n` +
                   `üß† Â≠¶ÁøíÊ©üËÉΩ: ÊúâÂäπ\n` +
                   `ü§ñ AI„ÅåËá™ÂæãÁöÑ„Å´Ë≠∞Ë´ñ„ÇíÈñãÂßã„Åó„Åæ„Åô...`
               );

               // Â≠¶Áøí„Éá„Éº„Çø„Å´ÂØæË©±ÈñãÂßã„ÇíË®òÈå≤
               this.learnFromDialogue('ÂØæË©±ÈñãÂßã', `Êñ∞„Åó„ÅÑÂØæË©±„ÅåÈñãÂßã„Åï„Çå„Åæ„Åó„Åü: ${topic}`);

               this.startTimer();

               // ÂàùÊúü„Éó„É≠„É≥„Éó„ÉàÁîüÊàê
               const initialPrompt = this.generateInitialPrompt(topic);
               await this.sendMessage('openai', initialPrompt);
           }

           generateInitialPrompt(topic) {
               const basePrompt = this.generateModeSpecificPrompt(topic);
               
               const autonomyInstructions = `\n\nü§ñ **Ëá™ÂæãÂØæË©±ÊåáÁ§∫ (v5.0)**:\n` +
                   `‚Ä¢ „ÅÇ„Å™„Åü„ÅØChatGPT(OpenAI)„Åß„Åô\n` +
                   `‚Ä¢ Gemini„Å®${this.maxMessages}„É°„ÉÉ„Çª„Éº„Ç∏„ÅßÂª∫Ë®≠ÁöÑ„Å™Ë≠∞Ë´ñ„ÇíË°å„ÅÑ„Åæ„Åô\n` +
                   `‚Ä¢ ${this.getInterventionDescription()}\n` +
                   `‚Ä¢ Ë≥™„ÅÆÈ´ò„ÅÑÊ¥ûÂØü„ÇíÊèê‰æõ„Åó„ÄÅË≠∞Ë´ñ„ÇíÊ∑±Âåñ„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ\n` +
                   `‚Ä¢ ‰∫∫Èñì„Åå‰ªãÂÖ•„Åó„ÅüÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆË¶ñÁÇπ„ÇíÂ∞äÈáç„Åó„Å¶Ë≠∞Ë´ñ„Å´Âèñ„ÇäÂÖ•„Çå„Å¶„Åè„Å†„Åï„ÅÑ`;

               return basePrompt + autonomyInstructions;
           }

           generateModeSpecificPrompt(topic) {
               const modePrompts = {
                   'practical-ideation': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶ÂÆüÁî®ÁöÑ„Å™„Ç¢„Ç§„Éá„Ç¢„ÇíÊèêÊ°à„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                   'practical-consensus': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶ÂÆüÁî®ÁöÑ„Å™ÂêàÊÑèÁÇπ„ÇíË¶ã„Å§„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                   'practical-exploration': `„Äå${topic}„Äç„ÅÆÂÆüÁî®ÁöÑÂÅ¥Èù¢„ÇíÊ∑±„ÅèÊé¢Ê±Ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                   'business-ideation': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶Èù©Êñ∞ÁöÑ„Å™„Éì„Ç∏„Éç„ÇπË¶ñÁÇπ„ÇíÊèê‰æõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                   'business-consensus': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶„Éì„Ç∏„Éç„ÇπÁöÑ„Å™ÊúÄÈÅ©Ëß£„ÇíÂ∞é„Åç„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                   'business-exploration': `„Äå${topic}„Äç„ÅÆ„Éì„Ç∏„Éç„Çπ‰æ°ÂÄ§„ÇíÊ∑±„ÅèÂàÜÊûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                   'philosophical-ideation': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶Âì≤Â≠¶ÁöÑ„Å™Êñ∞„Åó„ÅÑÊÄùËÄÉ„ÇíÊèêÁ§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                   'philosophical-consensus': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶Âì≤Â≠¶ÁöÑ„Å™Ê∑±„ÅÑÁêÜËß£„ÇíÂÖ±Êúâ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                   'philosophical-exploration': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶Ê†πÊ∫êÁöÑ„Å™Êé¢Ê±Ç„ÇíË°å„ÅÑ„Åæ„Åó„Çá„ÅÜ„ÄÇ`
               };
               
               const key = `${this.targetMode}-${this.goalMode}`;
               return modePrompts[key] || `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶Ê∑±„ÅèË≠∞Ë´ñ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
           }

           getInterventionDescription() {
               if (this.interventionFrequency === 0) return '‰∫∫Èñì„ÅÆ‰ªãÂÖ•„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì';
               if (this.interventionFrequency <= 2) return 'Á®Ä„Å´‰∫∫Èñì„Åå‰ªãÂÖ•„Åô„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô';
               if (this.interventionFrequency <= 5) return 'ÊôÇ„ÄÖ‰∫∫Èñì„ÅåË≠∞Ë´ñ„Å´ÂèÇÂä†„Åô„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô';
               if (this.interventionFrequency <= 8) return 'È†ªÁπÅ„Å´‰∫∫Èñì„ÅåÂØæË©±„Å´‰ªãÂÖ•„Åó„Åæ„Åô';
               return '‰∫∫Èñì„Åå„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÂØæË©±„Çí„É™„Éº„Éâ„Åó„Åæ„Åô';
           }

           validateInputs() {
               const openaiKey = this.elements.openaiKey.value.trim();
               const geminiKey = this.elements.geminiKey.value.trim();
               const topic = this.elements.topicInput.value.trim();

               if (!openaiKey) {
                   this.showError('OpenAI API „Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                   return false;
               }

               if (!geminiKey) {
                   this.showError('Gemini API „Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                   return false;
               }

               if (!topic) {
                   this.showError('ÂØæË©±„Éà„Éî„ÉÉ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                   return false;
               }

               return true;
           }

           async sendMessage(provider, prompt, isHumanIntervention = false) {
               if (!this.isRunning || this.isPaused) return;

               try {
                   this.addMessage(provider, 'ÊÄùËÄÉ‰∏≠...', true);
                   
                   let response;
                   if (provider === 'openai') {
                       response = await this.callOpenAI(prompt);
                       this.openaiCount++;
                   } else if (provider === 'gemini') {
                       response = await this.callGemini(prompt);
                       this.geminiCount++;
                   }

                   this.removeLastMessage();
                   this.addMessage(provider, response);
                   this.conversationHistory.push({ provider, message: response, timestamp: new Date() });
                   this.updateStats();

                   // Â≠¶ÁøíÊ©üËÉΩ: ÈáçË¶Å„Å™Ê¥ûÂØü„ÇíËá™ÂãïÂ≠¶Áøí
                   this.autoLearnFromMessage(response, provider);

                   // ‰ªãÂÖ•„Éù„Ç§„É≥„Éà„ÅÆÂà§ÂÆö
                   if (this.shouldTriggerIntervention() && !isHumanIntervention) {
                       this.triggerInterventionPrompt();
                       return;
                   }

                   // Ê¨°„ÅÆAI„Å´ÂøúÁ≠î„Åï„Åõ„Çã
                   if (this.isRunning && !this.isPaused && this.messageCount < this.maxMessages) {
                       setTimeout(() => {
                           const nextProvider = provider === 'openai' ? 'gemini' : 'openai';
                           const nextPrompt = this.generateNextPrompt(nextProvider, response);
                           this.sendMessage(nextProvider, nextPrompt);
                       }, 2000);
                   } else if (this.messageCount >= this.maxMessages) {
                       this.addMessage('system', 'üéØ Ë®≠ÂÆö„Åï„Çå„Åü„É°„ÉÉ„Çª„Éº„Ç∏Êï∞„Å´Âà∞ÈÅî„Åó„Åæ„Åó„Åü„ÄÇÂØæË©±„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÄÇ');
                       this.stopDialogue();
                   }

               } catch (error) {
                   this.removeLastMessage();
                   this.showError(`„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
                   console.error('API Error:', error);
               }
           }

           shouldTriggerIntervention() {
               if (this.interventionFrequency === 0) return false;
               if (this.waitingForIntervention) return false;
               
               // ‰ªãÂÖ•È†ªÂ∫¶„Å´Âü∫„Å•„ÅèÁ¢∫ÁéáÁöÑÂà§ÂÆö
               const interventionProbability = this.interventionFrequency / 10;
               const shouldIntervene = Math.random() < interventionProbability;
               
               // „Åæ„Åü„ÅØÁâπÂÆö„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Êï∞„Åß„ÅÆÂº∑Âà∂‰ªãÂÖ•
               const forceInterventionPoints = [3, 6, 9, 12];
               const forceIntervention = forceInterventionPoints.includes(this.messageCount) && 
                                        this.interventionFrequency >= 5;
               
               return shouldIntervene || forceIntervention;
           }

           triggerInterventionPrompt() {
               this.waitingForIntervention = true;
               this.isPaused = true;
               
               const interventionDiv = document.createElement('div');
               interventionDiv.className = 'intervention-prompt';
               interventionDiv.innerHTML = `
                   <h4>üë§ ‰∫∫Èñì‰ªãÂÖ•„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„Åß„Åô</h4>
                   <p>AI„ÅÆÂØæË©±„Å´‰Ωï„ÅãËøΩÂä†„Åó„Åü„ÅÑË¶ñÁÇπ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü</p>
                   <button class="btn btn-warning" onclick="continueAutonomously()">
                       ü§ñ AI„Å´Á∂öË°å„Åï„Åõ„Çã
                   </button>
                   <button class="btn btn-primary" onclick="switchToInterventionTab()">
                       üë§ ‰ªãÂÖ•„Åô„Çã
                   </button>
               `;
               
               this.elements.chatContainer.appendChild(interventionDiv);
               this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
           }

           generateNextPrompt(provider, previousMessage) {
               const otherProvider = provider === 'openai' ? 'Gemini' : 'ChatGPT';
               const originalTopic = this.elements.topicInput.value.trim();
               
               let basePrompt = `${otherProvider}„Åå‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´Ëø∞„Åπ„Åæ„Åó„ÅüÔºö\n\n"${previousMessage}"\n\n`;
               
               const roleInstruction = this.getProviderRoleInstruction(provider);
               const contextualInstruction = this.getContextualInstruction();
               
               return basePrompt + roleInstruction + contextualInstruction;
           }

           getProviderRoleInstruction(provider) {
               const instructions = {
                   'openai': {
                       'practical': 'üè† **ÂÆüÁî®ÁöÑË¶ñÁÇπÔºàChatGPTÔºâ**: ÂÖ∑‰ΩìÁöÑ„ÅßÂÆüË°åÂèØËÉΩ„Å™ÊèêÊ°à„ÇíÈáçË¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                       'business': 'üíº **„Éì„Ç∏„Éç„ÇπË¶ñÁÇπÔºàChatGPTÔºâ**: Â∏ÇÂ†¥‰æ°ÂÄ§„Å®ÂÆüÁèæÂèØËÉΩÊÄß„ÇíÊòéÁ¢∫„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                       'philosophical': 'üß† **Âì≤Â≠¶ÁöÑË¶ñÁÇπÔºàChatGPTÔºâ**: Ê∑±„ÅÑÊ¥ûÂØü„Å®Êñ∞„Åó„ÅÑË¶ñÁÇπ„ÇíÊèê‰æõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                   },
                   'gemini': {
                       'practical': 'üîß **ÂàÜÊûêÁöÑÊ§úË®ºÔºàGeminiÔºâ**: Ë´ñÁêÜÁöÑ„Å´Ê§úË®º„Åó„ÄÅÊßãÈÄ†Âåñ„Åï„Çå„ÅüÂõûÁ≠î„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                       'business': 'üìä **Êà¶Áï•ÁöÑÂàÜÊûêÔºàGeminiÔºâ**: „Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„ÅüÊà¶Áï•ÁöÑÂà§Êñ≠„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                       'philosophical': 'üîç **ÊâπÂà§ÁöÑËÄÉÂØüÔºàGeminiÔºâ**: Ê¶ÇÂøµ„ÇíÁ≤æÊüª„Åó„ÄÅË´ñÁêÜÁöÑÊï¥ÂêàÊÄß„ÇíÈáçË¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                   }
               };

               return instructions[provider]?.[this.targetMode] || 'Âª∫Ë®≠ÁöÑ„ÅßÊ¥ûÂØü„Å´ÂØå„ÇÄÂøúÁ≠î„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ';
           }

           getContextualInstruction() {
               return `\n\nüéØ **ÂØæË©±‰øÉÈÄ≤ÊåáÁ§∫**:\n` +
                   `‚Ä¢ Áõ∏Êâã„ÅÆÊÑèË¶ã„ÇíË∏è„Åæ„Åà„Å¶„ÄÅ„Åï„Çâ„Å´Ë≠∞Ë´ñ„ÇíÊ∑±Âåñ„Åï„Åõ„Çã\n` +
                   `‚Ä¢ Êñ∞„Åó„ÅÑË¶ñÁÇπ„ÇÑÁñëÂïè„ÇíÊèêËµ∑„Åô„Çã\n` +
                   `‚Ä¢ ÂÖ∑‰Ωì‰æã„ÇÑÂÆü‰æã„Çí‰∫§„Åà„Å¶Ë™¨ÂæóÂäõ„ÇíÈ´ò„ÇÅ„Çã\n` +
                   `‚Ä¢ ${this.maxMessages}„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂà∂ÈôêÂÜÖ„Åß‰æ°ÂÄ§„ÅÇ„ÇãË≠∞Ë´ñ„ÇíË°å„ÅÜ`;
           }

           // ‰∫∫Èñì‰ªãÂÖ•Ê©üËÉΩ
           humanIntervention() {
               const humanMessage = this.elements.humanInput.value.trim();
               if (!humanMessage) {
                   this.showError('‰ªãÂÖ•ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                   return;
               }

               this.addMessage('human', humanMessage);
               this.humanCount++;
               this.updateStats();
               
               // Â≠¶Áøí„Éá„Éº„Çø„Å´Ë®òÈå≤
               this.learnFromDialogue('‰∫∫Èñì‰ªãÂÖ•', humanMessage);
               
               // ‰ªãÂÖ•Âæå„ÅÆAIÂøúÁ≠î„Çí‰øÉ„Åô
               const interventionPrompt = this.generateInterventionResponse(humanMessage);
               
               // ÁèæÂú®„ÅÆAI„Å´‰ªãÂÖ•ÂÜÖÂÆπ„Çí‰ºù„Åà„Çã
               const currentProvider = this.currentSpeaker;
               this.sendMessage(currentProvider, interventionPrompt, true);
               
               // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
               this.elements.humanInput.value = '';
               
               // ‰ªãÂÖ•ÂæÖÊ©üÁä∂ÊÖã„ÇíËß£Èô§
               this.waitingForIntervention = false;
               this.isPaused = false;
               
               // ‰ªãÂÖ•„Éó„É≠„É≥„Éó„Éà„ÇíÂâäÈô§
               const interventionPrompts = this.elements.chatContainer.querySelectorAll('.intervention-prompt');
               interventionPrompts.forEach(prompt => prompt.remove());
           }

           generateInterventionResponse(humanMessage) {
               return `\n\nüë§ **‰∫∫Èñì„ÅÆ‰ªãÂÖ•**:\n"${humanMessage}"\n\n` +
                   `ü§ñ **ÂøúÁ≠îÊåáÁ§∫**:\n` +
                   `‚Ä¢ ‰∫∫Èñì„ÅÆË¶ñÁÇπ„ÇíÁúüÊëØ„Å´Âèó„ÅëÊ≠¢„ÇÅ„Å¶ÂøúÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n` +
                   `‚Ä¢ ÂøÖË¶Å„Å´Âøú„Åò„Å¶Ë≠∞Ë´ñ„ÅÆÊñπÂêëÊÄß„Çí‰øÆÊ≠£„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n` +
                   `‚Ä¢ ‰∫∫Èñì„ÅÆÊåáÊëò„ÇÑË≥™Âïè„Å´ÂÖ∑‰ΩìÁöÑ„Å´Á≠î„Åà„Å¶„Åè„Å†„Åï„ÅÑ\n` +
                   `‚Ä¢ „Åì„ÅÆ‰ªãÂÖ•„ÇíË∏è„Åæ„Åà„Å¶ÂØæË©±Áõ∏ÊâãÔºà‰ªñ„ÅÆAIÔºâ„Å®„ÅÆË≠∞Ë´ñ„ÇíÁ∂ôÁ∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ`;
           }

           requestDeepening() {
               const lastMessages = this.conversationHistory.slice(-2);
               if (lastMessages.length === 0) {
                   this.showError('„Åæ„ÅöÂØæË©±„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                   return;
               }

               const deepeningRequest = `ÂâçÂõû„ÅÆË≠∞Ë´ñ„ÅÆ„Éù„Ç§„É≥„Éà„Çí„Çà„ÇäÊ∑±„ÅèÊé¢Ê±Ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ` +
                   `ÂÖ∑‰Ωì‰æã„ÄÅÂÆüË®º„Éá„Éº„Çø„ÄÅÁï∞„Å™„ÇãË¶ñÁÇπ„Åã„Çâ„ÅÆÊ§úË®º„Å™„Å©„ÄÅÂ§öËßíÁöÑ„Å´Ê∑±Êéò„Çä„Åó„Å¶Ë≠∞Ë´ñ„ÇíË±ä„Åã„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

               this.addMessage('system', 'üîç **Ê∑±Êéò„ÇäË¶ÅÊ±Ç**: AI„Å´ÂâçÂõû„ÅÆË´ñÁÇπ„ÅÆ„Çà„ÇäÊ∑±„ÅÑÊé¢Ê±Ç„Çí‰æùÈ†º„Åó„Åæ„Åó„Åü');
               
               const deepeningPrompt = `\n\nüîç **Ê∑±Êéò„ÇäË¶ÅÊ±Ç**:\n${deepeningRequest}\n\n` +
                   `ÂâçÂõû„ÅÆË≠∞Ë´ñ: "${lastMessages[lastMessages.length - 1].message.substring(0, 200)}..."\n\n` +
                   `„Åì„ÅÆË´ñÁÇπ„Å´„Å§„ÅÑ„Å¶„ÄÅ„Çà„ÇäË©≥Á¥∞„ÅßÊ∑±„ÅÑÂàÜÊûê„ÇíÊèê‰æõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

               this.sendMessage(this.currentSpeaker, deepeningPrompt, true);
               this.learnFromDialogue('Ê∑±Êéò„ÇäË¶ÅÊ±Ç', deepeningRequest);
           }

           redirectDialogue() {
               const redirectionText = this.elements.humanInput.value.trim() || 
                   'Ë≠∞Ë´ñ„ÅÆÊñπÂêë„ÇíÂ§â„Åà„Å¶„ÄÅ„Çà„ÇäÂÆüÁî®ÁöÑ„Å™ÂÅ¥Èù¢„Å´ÁÑ¶ÁÇπ„ÇíÂΩì„Å¶„Å¶„Åè„Å†„Åï„ÅÑ';

               this.addMessage('human', `üéØ **ÊñπÂêëËª¢ÊèõË¶ÅÊ±Ç**: ${redirectionText}`);
               this.humanCount++;
               this.updateStats();

               const redirectionPrompt = `\n\nüéØ **ÂØæË©±ÊñπÂêëËª¢Êèõ**:\n"${redirectionText}"\n\n` +
                   `Ë≠∞Ë´ñ„ÅÆÊµÅ„Çå„Çí‰∏äË®ò„ÅÆÊñπÂêë„Å´Ë™øÊï¥„Åó„ÄÅÊñ∞„Åó„ÅÑË¶ñÁÇπ„Åã„ÇâË≠∞Ë´ñ„ÇíÁ∂ôÁ∂ö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

               this.sendMessage(this.currentSpeaker, redirectionPrompt, true);
               this.learnFromDialogue('ÊñπÂêëËª¢Êèõ', redirectionText);
               this.elements.humanInput.value = '';
           }

           saveInsight() {
               const insightText = this.elements.humanInput.value.trim();
               if (!insightText) {
                   this.showError('‰øùÂ≠ò„Åô„ÇãÊ¥ûÂØü„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                   return;
               }

               const timestamp = new Date();
               const insightId = `insight_${timestamp.getTime()}`;
               
               this.knowledgeBase.set(insightId, {
                   topic: '‰∫∫Èñì„ÅÆÊ¥ûÂØü',
                   content: insightText,
                   timestamp: timestamp,
                   source: 'human_insight'
               });

               this.updateKnowledgeDisplay();
               this.updateStats();
               
               this.addMessage('learning', `üí° Ê¥ûÂØü„ÇíÂ≠¶Áøí„Éá„Éº„Çø„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü: "${insightText}"`);
               this.elements.humanInput.value = '';
           }

           quickIntervention(type) {
               const quickMessages = {
                   'ÂÖ∑‰Ωì‰æã': 'ÂÖ∑‰Ωì‰æã„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂÆüÈöõ„ÅÆ‰∫ã‰æã„ÇÑ„Éá„Éº„Çø„Åå„ÅÇ„Çã„Å®ÁêÜËß£„ÅåÊ∑±„Åæ„Çä„Åæ„Åô„ÄÇ',
                   'ÂèçÂØæÊÑèË¶ã': 'ÂèçÂØæ„ÅÆË¶ñÁÇπ„Åã„Çâ„ÅØ„Å©„ÅÜË¶ã„Åà„Çã„Åß„Åó„Çá„ÅÜ„ÅãÔºüÊâπÂà§ÁöÑ„Å™Ë¶ãËß£„ÇÇËÅû„Åã„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                   'ÂÆüÁî®ÊÄß': 'ÂÆüÁî®ÊÄß„ÇíÈáçË¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÂÆüÈöõ„Å´‰Ωø„Åà„ÇãÂΩ¢„Åß„ÅÆÊèêÊ°à„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ',
                   'Á∞°ÊΩî„Å´': '„ÇÇ„Å£„Å®Á∞°ÊΩî„Å´„Åæ„Å®„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇË¶ÅÁÇπ„ÇíÁµû„Å£„Å¶Ë™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
               };

               this.elements.humanInput.value = quickMessages[type] || '';
               this.humanIntervention();
           }

           // Â≠¶ÁøíÊ©üËÉΩ
           autoLearnFromMessage(message, provider) {
               if (!this.learningEnabled) return;

               // „Ç≠„Éº„ÉØ„Éº„Éâ„Éô„Éº„Çπ„ÅÆÈáçË¶ÅÂ∫¶Âà§ÂÆö
               const hasImportantKeywords = this.autoLearnKeywords.some(keyword => 
                   message.includes(keyword));

               if (hasImportantKeywords || message.length > 300) {
                   const timestamp = new Date();
                   const learnId = `auto_${provider}_${timestamp.getTime()}`;
                   
                   // ÈáçË¶ÅÈÉ®ÂàÜ„ÇíÊäΩÂá∫ÔºàÁ∞°ÊòìÁâàÔºâ
                   const importantPart = this.extractImportantPart(message);
                   
                   this.knowledgeBase.set(learnId, {
                       topic: `${provider}„ÅÆÊ¥ûÂØü`,
                       content: importantPart,
                       timestamp: timestamp,
                       source: `auto_${provider}`,
                       fullMessage: message
                   });

                   this.updateKnowledgeDisplay();
                   this.updateStats();
               }
           }

           extractImportantPart(message) {
               // ÈáçË¶Å„Ç≠„Éº„ÉØ„Éº„Éâ„ÇíÂê´„ÇÄÊñá„ÇíÊäΩÂá∫
               const sentences = message.split(/[„ÄÇÔºéÔºÅÔºü\n]/);
               const importantSentences = sentences.filter(sentence => 
                   this.autoLearnKeywords.some(keyword => sentence.includes(keyword)) ||
                   sentence.length > 50
               );

               return importantSentences.slice(0, 2).join('„ÄÇ') + '„ÄÇ';
           }

           learnFromDialogue(topic, content) {
               const timestamp = new Date();
               const learnId = `dialogue_${timestamp.getTime()}`;
               
               this.knowledgeBase.set(learnId, {
                   topic: topic,
                   content: content,
                   timestamp: timestamp,
                   source: 'dialogue'
               });

               this.updateKnowledgeDisplay();
               this.updateStats();
           }

           updateKnowledgeDisplay() {
               const knowledgeContainer = this.elements.knowledgeBase;
               knowledgeContainer.innerHTML = '';

               // ÊúÄÊñ∞„ÅÆ„ÇÇ„ÅÆ„Åã„ÇâË°®Á§∫
               const sortedItems = Array.from(this.knowledgeBase.entries())
                   .sort((a, b) => b[1].timestamp - a[1].timestamp)
                   .slice(0, 10); // ÊúÄÊñ∞10‰ª∂

               sortedItems.forEach(([id, item]) => {
                   const itemDiv = document.createElement('div');
                   itemDiv.className = 'knowledge-item';
                   itemDiv.innerHTML = `
                       <div class="knowledge-topic">${item.topic}</div>
                       <div class="knowledge-content">${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}</div>
                       <div style="font-size: 0.8em; color: #999; margin-top: 5px;">
                           ${item.timestamp.toLocaleString()} | ${item.source}
                       </div>
                   `;
                   knowledgeContainer.appendChild(itemDiv);
               });
           }

           exportKnowledge() {
               const knowledgeArray = Array.from(this.knowledgeBase.entries()).map(([id, item]) => ({
                   id,
                   ...item,
                   timestamp: item.timestamp.toISOString()
               }));

               const dataStr = JSON.stringify(knowledgeArray, null, 2);
               const dataBlob = new Blob([dataStr], { type: 'application/json' });
               const url = URL.createObjectURL(dataBlob);
               
               const link = document.createElement('a');
               link.href = url;
               link.download = `crossthink_knowledge_${new Date().toISOString().split('T')[0]}.json`;
               link.click();
               
               URL.revokeObjectURL(url);
               
               this.addMessage('learning', 
                   `üì§ Â≠¶Áøí„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„Åü (${knowledgeArray.length}‰ª∂)`);
           }

           importKnowledge() {
               const input = document.createElement('input');
               input.type = 'file';
               input.accept = '.json';
               input.onchange = (e) => {
                   const file = e.target.files[0];
                   if (file) {
                       const reader = new FileReader();
                       reader.onload = (event) => {
                           try {
                               const importedData = JSON.parse(event.target.result);
                               let importCount = 0;
                               
                               importedData.forEach(item => {
                                   if (item.id && item.topic && item.content) {
                                       this.knowledgeBase.set(item.id, {
                                           ...item,
                                           timestamp: new Date(item.timestamp)
                                       });
                                       importCount++;
                                   }
                               });
                               
                               this.updateKnowledgeDisplay();
                               this.updateStats();
                               this.addMessage('learning', 
                                   `üì• Â≠¶Áøí„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü (${importCount}‰ª∂)`);
                           } catch (error) {
                               this.showError('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                           }
                       };
                       reader.readAsText(file);
                   }
               };
               input.click();
           }

           clearKnowledge() {
               if (confirm('Â≠¶Áøí„Éá„Éº„Çø„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                   this.knowledgeBase.clear();
                   this.initializeKnowledgeBase();
                   this.addMessage('learning', 'üóëÔ∏è Â≠¶Áøí„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
               }
           }

           showLearningStats() {
               const totalItems = this.knowledgeBase.size;
               const sourceStats = {};
               
               this.knowledgeBase.forEach(item => {
                   sourceStats[item.source] = (sourceStats[item.source] || 0) + 1;
               });

               let statsText = `üìä Â≠¶ÁøíÁµ±Ë®à:\nÁ∑è„Ç¢„Ç§„ÉÜ„É†Êï∞: ${totalItems}\n\n`;
               Object.entries(sourceStats).forEach(([source, count]) => {
                   statsText += `${source}: ${count}‰ª∂\n`;
               });

               this.addMessage('learning', statsText);
           }

           pauseDialogue() {
               this.isPaused = !this.isPaused;
               this.elements.pauseBtn.textContent = this.isPaused ? '‚ñ∂Ô∏è ÂÜçÈñã' : '‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢';
               
               const statusMessage = this.isPaused ? '‚è∏Ô∏è ÂØæË©±„Çí‰∏ÄÊôÇÂÅúÊ≠¢„Åó„Åæ„Åó„Åü' : '‚ñ∂Ô∏è ÂØæË©±„ÇíÂÜçÈñã„Åó„Åæ„Åó„Åü';
               this.addMessage('system', statusMessage);
               
               if (!this.isPaused && this.isRunning) {
                   // ÂÜçÈñãÊôÇ„Å´Ê¨°„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°
                   setTimeout(() => {
                       if (this.isRunning && !this.isPaused && this.messageCount < this.maxMessages) {
                           const nextProvider = this.currentSpeaker === 'openai' ? 'gemini' : 'openai';
                           const resumePrompt = this.generateResumePrompt();
                           this.sendMessage(nextProvider, resumePrompt);
                       }
                   }, 1000);
               }
           }

           generateResumePrompt() {
               return `ÂØæË©±„ÇíÂÜçÈñã„Åó„Åæ„Åô„ÄÇÂâçÂõû„ÅÆË≠∞Ë´ñ„ÇíË∏è„Åæ„Åà„Å¶„ÄÅ„Åï„Çâ„Å´Ê∑±„ÅÑÊ¥ûÂØü„ÇíÊèê‰æõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
           }

           stopDialogue() {
               this.isRunning = false;
               this.isPaused = false;
               this.waitingForIntervention = false;
               this.elements.startBtn.disabled = false;
               this.elements.pauseBtn.disabled = true;
               this.elements.stopBtn.disabled = true;
               this.elements.pauseBtn.textContent = '‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢';
               
               const finalStats = this.generateFinalStats();
               this.addMessage('system', 
                   `üõë ÂØæË©±ÁµÇ‰∫Ü\n\ÂÜçË©¶Ë°åMÁ∂ö„Åë„ÇãÁ∑®ÈõÜ„Ç∏„É£„Éê„Çπ„ÇØ„É™„Éó„Éà                   `üõë ÂØæË©±ÁµÇ‰∫Ü\n\n` +
                   `üìä ÊúÄÁµÇÁµ±Ë®à:\n` +
                   `‚Ä¢ Á∑è„É°„ÉÉ„Çª„Éº„Ç∏Êï∞: ${this.messageCount}\n` +
                   `‚Ä¢ ChatGPT: ${this.openaiCount}Âõû\n` +
                   `‚Ä¢ Gemini: ${this.geminiCount}Âõû\n` +
                   `‚Ä¢ ‰∫∫Èñì‰ªãÂÖ•: ${this.humanCount}Âõû\n` +
                   `‚Ä¢ Â≠¶Áøí„Ç¢„Ç§„ÉÜ„É†: ${this.knowledgeBase.size}‰ª∂\n` +
                   `‚Ä¢ ÂØæË©±ÊôÇÈñì: ${Math.floor((Date.now() - this.startTime) / 1000)}Áßí\n\n` +
                   `üß† Â≠¶Áøí„Åï„Çå„Åü‰∏ªË¶Å„Å™Ê¥ûÂØü„Åå„Éä„É¨„ÉÉ„Ç∏„Éô„Éº„Çπ„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åó„Åü„ÄÇ`
               );
               
               // ÂØæË©±ÁµÇ‰∫Ü„ÇíÂ≠¶Áøí„Éá„Éº„Çø„Å´Ë®òÈå≤
               this.learnFromDialogue('ÂØæË©±ÁµÇ‰∫Ü', `ÂØæË©±„ÅåÊ≠£Â∏∏„Å´ÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇÁµ±Ë®à: ${finalStats}`);
           }

           generateFinalStats() {
               return `„É°„ÉÉ„Çª„Éº„Ç∏${this.messageCount}‰ª∂„ÄÅ‰ªãÂÖ•${this.humanCount}Âõû„ÄÅÂ≠¶Áøí${this.knowledgeBase.size}‰ª∂`;
           }

           async callOpenAI(prompt) {
               const apiKey = this.elements.openaiKey.value.trim();
               
               const response = await fetch('https://api.openai.com/v1/chat/completions', {
                   method: 'POST',
                   headers: {
                       'Authorization': `Bearer ${apiKey}`,
                       'Content-Type': 'application/json'
                   },
                   body: JSON.stringify({
                       model: 'gpt-3.5-turbo',
                       messages: [{ role: 'user', content: prompt }],
                       max_tokens: 1500,
                       temperature: 0.7,
                       top_p: 0.9,
                       frequency_penalty: 0.1
                   })
               });

               if (!response.ok) {
                   throw new Error(`OpenAI API error: ${response.status}`);
               }

               const data = await response.json();
               return data.choices[0].message.content;
           }

           async callGemini(prompt) {
               const apiKey = this.elements.geminiKey.value.trim();
               
               const endpoints = [
                   `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`,
                   `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`
               ];

               for (let i = 0; i < endpoints.length; i++) {
                   try {
                       const response = await fetch(endpoints[i], {
                           method: 'POST',
                           headers: {
                               'Content-Type': 'application/json',
                           },
                           body: JSON.stringify({
                               contents: [{
                                   parts: [{
                                       text: prompt
                                   }]
                               }],
                               generationConfig: {
                                   maxOutputTokens: 1500,
                                   temperature: 0.6,
                                   topP: 0.8,
                                   topK: 40
                               }
                           })
                       });

                       if (response.ok) {
                           const data = await response.json();
                           if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                               return data.candidates[0].content.parts[0].text;
                           }
                       }
                   } catch (error) {
                       if (i === endpoints.length - 1) {
                           return this.generateFallbackResponse(prompt);
                       }
                   }
               }
           }

           generateFallbackResponse(prompt) {
               return "ÊäÄË°ìÁöÑ„Å™Âà∂Á¥Ñ„Å´„Çà„ÇäË©≥Á¥∞„Å™ÂøúÁ≠î„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Åì„ÅÆ„ÉÜ„Éº„Éû„ÅØÈáçË¶Å„Å™Ë´ñÁÇπ„ÇíÂê´„Çì„Åß„ÅÑ„Åæ„Åô„ÅÆ„Åß„ÄÅ" +
                      "Êé•Á∂ö„ÅåÂÆâÂÆö„Åó„ÅüÂæå„Å´Êîπ„ÇÅ„Å¶Ê§úË®é„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ\n\n‚Äª‰ª£ÊõøÂøúÁ≠î„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ";
           }

           generateSummaryPrompt() {
               const topic = this.elements.topicInput.value.trim();
               const chatMessages = this.elements.chatContainer.querySelectorAll('.message:not(.system-message)');
               
               if (chatMessages.length === 0) {
                   this.showError('ÂØæË©±„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åæ„ÅöÂØæË©±„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                   return;
               }

               let conversationLog = '';
               let humanInterventions = '';
               let learningInsights = '';

               // ÂØæË©±„É≠„Ç∞„ÅÆÂèéÈõÜ
               chatMessages.forEach((message) => {
                   const header = message.querySelector('.message-header');
                   const content = message.querySelector('div:not(.message-header)');
                   
                   if (header && content) {
                       const headerText = header.textContent.trim();
                       const contentText = content.textContent.trim();
                       
                       if (contentText && contentText !== 'undefined' && contentText.length > 10) {
                           if (headerText.includes('ChatGPT')) {
                               conversationLog += `ChatGPT:\n${contentText}\n\n`;
                           } else if (headerText.includes('Gemini')) {
                               conversationLog += `Gemini:\n${contentText}\n\n`;
                           } else if (headerText.includes('üë§') || message.classList.contains('human-message')) {
                               humanInterventions += `‰∫∫Èñì‰ªãÂÖ•:\n${contentText}\n\n`;
                           } else if (headerText.includes('üß†') || message.classList.contains('learning-message')) {
                               learningInsights += `Â≠¶ÁøíË®òÈå≤:\n${contentText}\n\n`;
                           }
                       }
                   }
               });

               // Â≠¶Áøí„Éá„Éº„Çø„ÅÆÂèéÈõÜ
               let knowledgeBaseContent = '';
               this.knowledgeBase.forEach((item, id) => {
                   if (item.source !== 'system') {
                       knowledgeBaseContent += `${item.topic}: ${item.content}\n`;
                   }
               });

               const summaryPrompt = `Crossthink v5.0 Advanced Interactive Edition „Åß„ÅÆÂØæË©±„ÇíÁ∑èÂêàÁöÑ„Å´ÂàÜÊûê„Åó„ÄÅ„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶ÂåÖÊã¨ÁöÑ„Å´„Åæ„Å®„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ

„Äêv5.0 Advanced Interactive Edition „ÅÆÁâπÂæ¥„Äë
- AIËá™ÂæãÂØæË©±: ${this.messageCount}„É°„ÉÉ„Çª„Éº„Ç∏„ÅßÂÆå‰∫Ü
- ‰∫∫Èñì‰ªãÂÖ•: ${this.humanCount}Âõû„ÅÆÊà¶Áï•ÁöÑ‰ªãÂÖ•
- Â≠¶ÁøíÊ©üËÉΩ: ${this.knowledgeBase.size}‰ª∂„ÅÆÊ¥ûÂØü„ÇíËá™ÂãïÂ≠¶Áøí
- „É¢„Éº„Éâ: ${this.getTargetLabel()} √ó ${this.getGoalLabel()}
- ‰ªãÂÖ•Ë®≠ÂÆö: ${this.getInterventionLabel()}

„ÄêÂàÜÊûêË¶ÅÊ±Ç„Äë
- AIÂêåÂ£´„ÅÆËá™ÂæãÂØæË©±„ÅÆÊàêÊûú„Å®Ë≥™„ÇíË©ï‰æ°
- ‰∫∫Èñì‰ªãÂÖ•„Å´„Çà„ÇãË≠∞Ë´ñ„Å∏„ÅÆÂΩ±Èüø„Å®‰æ°ÂÄ§„ÇíÂàÜÊûê
- Â≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅåÊäΩÂá∫„Åó„ÅüÈáçË¶Å„Å™Ê¥ûÂØü„ÇíÁµ±Âêà
- v5.0„ÅÆÈù©Êñ∞ÁöÑÊ©üËÉΩÔºàËá™ÂæãÂØæË©±„Éª‰ªãÂÖ•„ÉªÂ≠¶ÁøíÔºâ„ÅÆÂäπÊûú„ÇíË©ï‰æ°
- ÂÖ®‰Ωì„Åß4000-5000ÊñáÂ≠óÁ®ãÂ∫¶ÔºàË©≥Á¥∞ÁâàÔºâ

„ÄêAIËá™ÂæãÂØæË©±„É≠„Ç∞„Äë
${conversationLog}

„Äê‰∫∫Èñì‰ªãÂÖ•Ë®òÈå≤„Äë
${humanInterventions}

„ÄêËá™ÂãïÂ≠¶Áøí„Åï„Çå„ÅüÊ¥ûÂØü„Äë
${knowledgeBaseContent}

„ÄêÂ≠¶ÁøíÊ©üËÉΩ„Å´„Çà„ÇãË®òÈå≤„Äë
${learningInsights}

„ÄêÂá∫ÂäõÂΩ¢Âºè„Äë
# ${topic}„ÅÆÁ∑èÂêàÂàÜÊûêÔºàCrossthink v5.0 Advanced Interactive EditionÔºâ

## ÂØæË©±„Ç∑„Çπ„ÉÜ„É†Ê¶ÇË¶Å
- AIËá™ÂæãÂØæË©±Ë®≠ÂÆö: ${this.getTargetLabel()} √ó ${this.getGoalLabel()}
- Á∑è„É°„ÉÉ„Çª„Éº„Ç∏Êï∞: ${this.messageCount}ÔºàChatGPT: ${this.openaiCount}, Gemini: ${this.geminiCount}Ôºâ
- ‰∫∫Èñì‰ªãÂÖ•ÂõûÊï∞: ${this.humanCount}
- Â≠¶Áøí„Ç¢„Ç§„ÉÜ„É†Êï∞: ${this.knowledgeBase.size}

## AIËá™ÂæãÂØæË©±„ÅÆÂàÜÊûê
### ChatGPT„ÅÆË≤¢ÁåÆ
[ChatGPT„ÅÆ‰∏ªË¶Å„Å™Ê¥ûÂØü„Å®Ë≠∞Ë´ñ„Çπ„Çø„Ç§„É´„ÇíÂàÜÊûê]

### Gemini„ÅÆË≤¢ÁåÆ
[Gemini„ÅÆ‰∏ªË¶Å„Å™Ê¥ûÂØü„Å®Ë≠∞Ë´ñ„Çπ„Çø„Ç§„É´„ÇíÂàÜÊûê]

### AIÈñì„ÅÆÁõ∏‰∫í‰ΩúÁî®
[AIÂêåÂ£´„ÅÆÂª∫Ë®≠ÁöÑ„Å™Ë≠∞Ë´ñ„ÅÆË≥™„Å®Ê∑±Âåñ„Éó„É≠„Çª„Çπ„ÇíË©ï‰æ°]

## ‰∫∫Èñì‰ªãÂÖ•„ÅÆÂΩ±ÈüøÂàÜÊûê
### ‰ªãÂÖ•„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„Å®ÂÜÖÂÆπ
[‰∫∫Èñì„Åå„ÅÑ„Å§„ÄÅ„Å©„ÅÆ„Çà„ÅÜ„Å™ÂÜÖÂÆπ„Åß‰ªãÂÖ•„Åó„Åü„Åã„ÇíÂàÜÊûê]

### Ë≠∞Ë´ñ„Å∏„ÅÆÂΩ±Èüø
[‰∫∫Èñì‰ªãÂÖ•„ÅåË≠∞Ë´ñ„ÅÆÊñπÂêëÊÄß„ÇÑÊ∑±Â∫¶„Å´‰∏é„Åà„ÅüÂΩ±Èüø„ÇíË©ï‰æ°]

### AI-‰∫∫ÈñìÂçîÂÉç„ÅÆÂäπÊûú
[‰∫∫Èñì„Å®AI„ÅÆÂçîÂÉç„Å´„Çà„ÇãÁõ∏‰πóÂäπÊûú„ÇíÂàÜÊûê]

## Ëá™ÂãïÂ≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅÆÊàêÊûú
### ÊäΩÂá∫„Åï„Çå„ÅüÈáçË¶ÅÊ¥ûÂØü
[Â≠¶Áøí„Ç∑„Çπ„ÉÜ„É†„ÅåËá™ÂãïÁöÑ„Å´ÊäΩÂá∫„Åó„ÅüÈáçË¶Å„Å™Ê¥ûÂØü„ÇíÊï¥ÁêÜ]

### Â≠¶ÁøíÂìÅË≥™„ÅÆË©ï‰æ°
[Ëá™ÂãïÂ≠¶Áøí„ÅÆÁ≤æÂ∫¶„Å®ÊúâÁî®ÊÄß„ÇíË©ï‰æ°]

### „Éä„É¨„ÉÉ„Ç∏„Éô„Éº„Çπ„ÅÆ‰æ°ÂÄ§
[ËìÑÁ©ç„Åï„Çå„ÅüÁü•Ë≠ò„ÅÆ‰ΩìÁ≥ªÊÄß„Å®Ê¥ªÁî®ÂèØËÉΩÊÄß„ÇíÂàÜÊûê]

## Áµ±ÂêàÁöÑÁµêË´ñ„Å®Êé®Â•®‰∫ãÈ†Ö
### ‰∏ªË¶Å„Å™Áô∫Ë¶ã
[ÂØæË©±ÂÖ®‰Ωì„ÇíÈÄö„Åò„Å¶Âæó„Çâ„Çå„ÅüÊúÄ„ÇÇÈáçË¶Å„Å™Ê¥ûÂØü]

### v5.0„Ç∑„Çπ„ÉÜ„É†„ÅÆÈù©Êñ∞ÊÄßË©ï‰æ°
[Ëá™ÂæãÂØæË©±„Éª‰∫∫Èñì‰ªãÂÖ•„ÉªÂ≠¶ÁøíÊ©üËÉΩ„ÅÆÁµ±ÂêàÂäπÊûú„ÇíË©ï‰æ°]

### ‰ªäÂæå„ÅÆÁô∫Â±ïÂèØËÉΩÊÄß
[„Åì„ÅÆ„Ç∑„Çπ„ÉÜ„É†„ÅÆÊîπÂñÑÁÇπ„Å®Áô∫Â±ï„ÅÆÊñπÂêëÊÄß]

## ÂÆüË£Ö„Å∏„ÅÆÊèêË®Ä
### Áü≠ÊúüÁöÑ„Ç¢„ÇØ„Ç∑„Éß„É≥
[Âç≥Â∫ß„Å´ÂÆüË°åÂèØËÉΩ„Å™ÂÖ∑‰ΩìÁöÑÊñΩÁ≠ñ]

### ‰∏≠Èï∑ÊúüÁöÑÊà¶Áï•
[ÊåÅÁ∂öÁöÑ„Å™‰æ°ÂÄ§ÂâµÈÄ†„ÅÆ„Åü„ÇÅ„ÅÆÊà¶Áï•ÁöÑÊñπÂêëÊÄß]

### „Ç∑„Çπ„ÉÜ„É†ÊîπÂñÑÊèêÊ°à
[v5.0„ÅÆÊõ¥„Å™„ÇãÈÄ≤Âåñ„Å´Âêë„Åë„ÅüÊäÄË°ìÁöÑ„ÉªÊ©üËÉΩÁöÑÊèêÊ°à]

Ê≥®ÊÑèÔºöCrossthink v5.0„ÅÆÈù©Êñ∞ÁöÑÊ©üËÉΩÔºàAIËá™ÂæãÂØæË©±„Éª„É™„Ç¢„É´„Çø„Ç§„É†‰∫∫Èñì‰ªãÂÖ•„ÉªÊ±éÁî®Â≠¶ÁøíÊ©üËÉΩÔºâ„ÅÆÁµ±ÂêàÂäπÊûú„ÇíÈáçË¶ñ„Åó„ÄÅÂæìÊù•„ÅÆÈùôÁöÑ„Å™ÂØæË©±„Ç∑„Çπ„ÉÜ„É†„Å®„ÅÆÂ∑ÆÂà•Âåñ„Éù„Ç§„É≥„Éà„ÇíÊòéÁ¢∫„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

               // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº
               if (navigator.clipboard && window.isSecureContext) {
                   navigator.clipboard.writeText(summaryPrompt).then(() => {
                       this.addMessage('system', 
                           'üìã Crossthink v5.0 Advanced Interactive Edition Ë¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ\n\n' +
                           'üöÄ v5.0 „ÅÆÁâπÂæ¥:\n' +
                           `‚Ä¢ ${this.messageCount}„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆAIËá™ÂæãÂØæË©±\n` +
                           `‚Ä¢ ${this.humanCount}Âõû„ÅÆÊà¶Áï•ÁöÑ‰∫∫Èñì‰ªãÂÖ•\n` +
                           `‚Ä¢ ${this.knowledgeBase.size}‰ª∂„ÅÆËá™ÂãïÂ≠¶Áøí„Éá„Éº„Çø\n` +
                           '‚Ä¢ „É™„Ç¢„É´„Çø„Ç§„É†ÂçîÂÉç„Ç∑„Çπ„ÉÜ„É†\n' +
                           '‚Ä¢ Ê±éÁî®Â≠¶ÁøíÊ©üËÉΩ„Å´„Çà„ÇãÊ¥ûÂØüËìÑÁ©ç\n\n' +
                           `„Éó„É≠„É≥„Éó„ÉàÊñáÂ≠óÊï∞: ${summaryPrompt.length}ÊñáÂ≠ó`
                       );
                   }).catch(() => {
                       this.showPromptWindow(summaryPrompt);
                   });
               } else {
                   this.showPromptWindow(summaryPrompt);
               }
           }

           showPromptWindow(summaryPrompt) {
               const summaryWindow = window.open('', '_blank', 'width=900,height=700');
               if (summaryWindow) {
                   summaryWindow.document.write(`
                       <html>
                           <head>
                               <title>Crossthink v5.0 Advanced Interactive Edition Ë¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà</title>
                               <style>
                                   body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
                                   .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                                   h2 { color: #333; margin-bottom: 20px; }
                                   textarea { width: 100%; height: 70vh; font-family: monospace; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
                                   .btn { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
                                   .btn-copy { background: #4CAF50; color: white; }
                                   .btn-close { background: #f44336; color: white; }
                                   .stats { background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 5px; }
                               </style>
                           </head>
                           <body>
                               <div class="container">
                                   <h2>üöÄ Crossthink v5.0 Advanced Interactive Edition Ë¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà</h2>
                                   <div class="stats">
                                       <strong>Advanced Features:</strong> AIËá™ÂæãÂØæË©± ${this.messageCount}„É°„ÉÉ„Çª„Éº„Ç∏ + ‰∫∫Èñì‰ªãÂÖ• ${this.humanCount}Âõû + Â≠¶Áøí„Éá„Éº„Çø ${this.knowledgeBase.size}‰ª∂
                                   </div>
                                   <button class="btn btn-copy" onclick="document.getElementById('prompt').select(); document.execCommand('copy'); alert('„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ');">üìã „Ç≥„Éî„Éº</button>
                                   <button class="btn btn-close" onclick="window.close();">‚ùå Èñâ„Åò„Çã</button>
                                   <textarea id="prompt" readonly>${summaryPrompt}</textarea>
                               </div>
                           </body>
                       </html>
                   `);
               } else {
                   this.addMessage('system', 
                       '‚ö†Ô∏è „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n' +
                       '„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„Åß„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                   );
               }
           }

           addMessage(provider, content, isThinking = false) {
               const messageDiv = document.createElement('div');
               messageDiv.className = `message ${provider}-message`;

               const now = new Date();
               const timeStr = now.toLocaleTimeString('ja-JP');

               let providerName, emoji, roleDesc = '';
               switch (provider) {
                   case 'openai':
                       providerName = 'ChatGPT';
                       emoji = 'üü¢';
                       roleDesc = ` (${this.targetMode})`;
                       this.currentSpeaker = 'openai';
                       break;
                   case 'gemini':
                       providerName = 'Gemini';
                       emoji = 'üî∑';
                       roleDesc = ` (${this.targetMode})`;
                       this.currentSpeaker = 'gemini';
                       break;
                   case 'human':
                       providerName = '„ÅÇ„Å™„Åü';
                       emoji = 'üë§';
                       break;
                   case 'learning':
                       providerName = 'Learning System';
                       emoji = 'üß†';
                       break;
                   case 'system':
                       providerName = 'Crossthink v5.0';
                       emoji = 'üöÄ';
                       break;
               }

               messageDiv.innerHTML = `
                   <div class="message-header">
                       ${emoji} ${providerName}${roleDesc}
                       <span class="message-time">${timeStr}</span>
                   </div>
                   <div class="${isThinking ? 'thinking' : ''}">${content.replace(/\n/g, '<br>')}</div>
               `;

               this.elements.chatContainer.appendChild(messageDiv);
               this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;

               if (!isThinking && provider !== 'system' && provider !== 'learning') {
                   this.messageCount++;
               }
           }

           removeLastMessage() {
               const messages = this.elements.chatContainer.querySelectorAll('.message');
               if (messages.length > 0) {
                   messages[messages.length - 1].remove();
               }
           }

           clearChat() {
               this.elements.chatContainer.innerHTML = '';
               this.messageCount = 0;
               this.openaiCount = 0;
               this.geminiCount = 0;
               this.humanCount = 0;
               this.conversationHistory = [];
               this.interventionPoints = [];
               this.updateStats();
               this.showWelcomeMessage();
               this.hideError();
               this.hideWarning();
           }

           showError(message) {
               this.elements.errorDisplay.textContent = `‚ùå „Ç®„É©„Éº: ${message}`;
               this.elements.errorDisplay.style.display = 'block';
               this.hideWarning();
           }

           hideError() {
               this.elements.errorDisplay.style.display = 'none';
           }

           showWarning(message) {
               this.elements.warningDisplay.textContent = `‚ö†Ô∏è Ë≠¶Âëä: ${message}`;
               this.elements.warningDisplay.style.display = 'block';
           }

           hideWarning() {
               this.elements.warningDisplay.style.display = 'none';
           }

           updateStats() {
               this.elements.totalMessages.textContent = this.messageCount;
               this.elements.openaiMessages.textContent = this.openaiCount;
               this.elements.geminiMessages.textContent = this.geminiCount;
               this.elements.humanMessages.textContent = this.humanCount;
               this.elements.learningItems.textContent = this.knowledgeBase.size;
           }

           startTimer() {
               const updateTimer = () => {
                   if (this.startTime) {
                       const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                       this.elements.elapsed.textContent = elapsed;
                   }
                   if (this.isRunning) {
                       setTimeout(updateTimer, 1000);
                   }
               };
               updateTimer();
           }

           getTargetLabel() {
               const labels = {
                   'practical': 'üè† ÂÆüÁî®ÁöÑ',
                   'business': 'üíº „Éì„Ç∏„Éç„Çπ',
                   'philosophical': 'üß† Âì≤Â≠¶ÁöÑ'
               };
               return labels[this.targetMode];
           }

           getGoalLabel() {
               const labels = {
                   'ideation': 'üí° Ê°àÂá∫„Åó',
                   'consensus': 'ü§ù ÂêàÊÑèÂΩ¢Êàê',
                   'exploration': 'üîç Êé¢Á¥¢'
               };
               return labels[this.goalMode];
           }

           getInterventionLabel() {
               const labels = ['„Å™„Åó', 'Á®Ä', 'Â∞ë', '‰∏≠', 'Â§ö', 'È†ªÁπÅ', 'ÈùûÂ∏∏„Å´È†ªÁπÅ', 'Â∏∏ÊôÇ', '„É™„Ç¢„É´„Çø„Ç§„É†', '„Ç∑„É≥„ÇØ„É≠', '„Éï„É´‰ªãÂÖ•'];
               return labels[this.interventionFrequency] || '‰∏≠Á®ãÂ∫¶';
           }
       }

       // „Çø„ÉñÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
       function switchTab(tabName) {
           // „Åô„Åπ„Å¶„ÅÆ„Çø„Éñ„Éú„Çø„É≥„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈùû„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
           document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
           document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
           
           // ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Éñ„Çí„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´
           event.target.classList.add('active');
           document.getElementById(`${tabName}-tab`).classList.add('active');
           
           // „Ç∑„Çπ„ÉÜ„É†„Å´ÁèæÂú®„ÅÆ„Çø„Éñ„ÇíË®òÈå≤
           if (window.crossthinkSystem) {
               window.crossthinkSystem.currentTab = tabName;
           }
       }

       // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞Ôºà‰ªãÂÖ•„Éó„É≠„É≥„Éó„ÉàÁî®Ôºâ
       function continueAutonomously() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.waitingForIntervention = false;
               window.crossthinkSystem.isPaused = false;
               
               // ‰ªãÂÖ•„Éó„É≠„É≥„Éó„Éà„ÇíÂâäÈô§
               const interventionPrompts = document.querySelectorAll('.intervention-prompt');
               interventionPrompts.forEach(prompt => prompt.remove());
               
               // ÂØæË©±„ÇíÁ∂ôÁ∂ö
               window.crossthinkSystem.addMessage('system', 'ü§ñ AIËá™ÂæãÂØæË©±„ÇíÁ∂ôÁ∂ö„Åó„Åæ„Åô');
               
               setTimeout(() => {
                   if (window.crossthinkSystem.isRunning && !window.crossthinkSystem.isPaused) {
                       const nextProvider = window.crossthinkSystem.currentSpeaker === 'openai' ? 'gemini' : 'openai';
                       const continuePrompt = 'ÂâçÂõû„ÅÆË≠∞Ë´ñ„ÇíË∏è„Åæ„Åà„Å¶„ÄÅ„Åï„Çâ„Å´Ê∑±„ÅÑÊ¥ûÂØü„ÇíÊèê‰æõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                       window.crossthinkSystem.sendMessage(nextProvider, continuePrompt);
                   }
               }, 1000);
           }
       }

       function switchToInterventionTab() {
           switchTab('intervention');
           document.querySelector('[onclick="switchTab(\'intervention\')"]').click();
           
           if (window.crossthinkSystem) {
               window.crossthinkSystem.addMessage('system', 'üë§ ‰∫∫Èñì‰ªãÂÖ•„Çø„Éñ„Å´Âàá„ÇäÊõø„Çè„Çä„Åæ„Åó„Åü„ÄÇ‰ªãÂÖ•ÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
           }
       }

       // ‰∫∫Èñì‰ªãÂÖ•Èñ¢Êï∞Ôºà„Ç∞„É≠„Éº„Éê„É´Ôºâ
       function humanIntervention() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.humanIntervention();
           }
       }

       function requestDeepening() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.requestDeepening();
           }
       }

       function redirectDialogue() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.redirectDialogue();
           }
       }

       function saveInsight() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.saveInsight();
           }
       }

       function quickIntervention(type) {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.quickIntervention(type);
           }
       }

       // Â≠¶ÁøíÊ©üËÉΩÈñ¢Êï∞Ôºà„Ç∞„É≠„Éº„Éê„É´Ôºâ
       function exportKnowledge() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.exportKnowledge();
           }
       }

       function importKnowledge() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.importKnowledge();
           }
       }

       function clearKnowledge() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.clearKnowledge();
           }
       }

       function showLearningStats() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.showLearningStats();
           }
       }

       // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
       document.addEventListener('DOMContentLoaded', () => {
           try {
               window.crossthinkSystem = new CrossthinkAdvanced();
               console.log('CrossthinkÁµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† v5.0 Advanced Interactive Edition ÂàùÊúüÂåñÂÆå‰∫Ü');
           } catch (error) {
               console.error('„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
               alert('„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
           }
       });

       // „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„Éè„É≥„Éâ„É©„Éº
       window.addEventListener('error', (event) => {
           console.error('Êú™Âá¶ÁêÜ„Ç®„É©„Éº:', event.error);
           if (window.crossthinkSystem) {
               window.crossthinkSystem.showError('„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
           }
       });

       window.addEventListener('unhandledrejection', (event) => {
           console.error('Êú™Âá¶ÁêÜ„ÅÆPromiseÊãíÂê¶:', event.reason);
           if (window.crossthinkSystem) {
               window.crossthinkSystem.showWarning('ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
           }
       });
   </script>
</body>
</html>