<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Crossthink çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  v5.0 - AIè‡ªå¾‹å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ </title>
   <style>
       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }

       body {
           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           min-height: 100vh;
           padding: 20px;
       }

       .container {
           max-width: 1200px;
           margin: 0 auto;
           background: rgba(255, 255, 255, 0.95);
           border-radius: 20px;
           box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
           overflow: hidden;
       }

       .header {
           background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
           color: white;
           padding: 30px;
           text-align: center;
       }

       .header h1 {
           font-size: 2.5em;
           margin-bottom: 10px;
           text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
       }

       .header p {
           font-size: 1.2em;
           opacity: 0.9;
       }

       .demo-label {
           background: rgba(255, 255, 255, 0.2);
           padding: 10px 20px;
           border-radius: 25px;
           display: inline-block;
           margin-top: 15px;
           font-weight: bold;
       }

       .mode-tabs {
           display: flex;
           background: #f8f9fa;
           border-bottom: 2px solid #e9ecef;
       }

       .tab-button {
           flex: 1;
           padding: 20px;
           border: none;
           background: transparent;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s;
           border-bottom: 3px solid transparent;
       }

       .tab-button.active {
           background: white;
           border-bottom-color: #4facfe;
           color: #4facfe;
       }

       .tab-button:hover:not(.active) {
           background: rgba(79, 172, 254, 0.1);
       }

       .tab-content {
           display: none;
           padding: 30px;
       }

       .tab-content.active {
           display: block;
       }

       /* è‡ªå¾‹å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ */
       .autonomous-section {
           background: #f0f8ff;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           border-left: 4px solid #4facfe;
       }

       .autonomous-controls {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin-bottom: 20px;
       }

       .control-group {
           background: white;
           padding: 15px;
           border-radius: 10px;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
       }

       .control-group h4 {
           margin-bottom: 10px;
           color: #333;
       }

       .slider-container {
           margin: 10px 0;
       }

       .slider-label {
           display: flex;
           justify-content: space-between;
           margin-bottom: 5px;
           font-size: 0.9em;
           color: #666;
       }

       .range-slider {
           width: 100%;
           height: 6px;
           border-radius: 3px;
           background: linear-gradient(90deg, #ff6b6b, #feca57, #48cae4);
           outline: none;
           -webkit-appearance: none;
       }

       .range-slider::-webkit-slider-thumb {
           -webkit-appearance: none;
           appearance: none;
           width: 20px;
           height: 20px;
           border-radius: 50%;
           background: white;
           border: 3px solid #4facfe;
           cursor: pointer;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
       }

       .range-slider::-moz-range-thumb {
           width: 20px;
           height: 20px;
           border-radius: 50%;
           background: white;
           border: 3px solid #4facfe;
           cursor: pointer;
           box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
       }

       /* äººé–“ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰ */
       .intervention-section {
           background: #fff8e1;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           border-left: 4px solid #ffc107;
       }

       .human-input-area {
           background: white;
           padding: 20px;
           border-radius: 10px;
           margin-bottom: 20px;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
       }

       .human-input {
           width: 100%;
           min-height: 100px;
           padding: 15px;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           font-size: 16px;
           resize: vertical;
           margin-bottom: 15px;
       }

       .human-input:focus {
           outline: none;
           border-color: #ffc107;
       }

       .intervention-buttons {
           display: flex;
           gap: 10px;
           flex-wrap: wrap;
       }

       /* å­¦ç¿’æ©Ÿèƒ½ */
       .learning-section {
           background: #e8f5e8;
           padding: 20px;
           border-radius: 15px;
           margin-bottom: 20px;
           border-left: 4px solid #4caf50;
       }

       .knowledge-base {
           background: white;
           padding: 20px;
           border-radius: 10px;
           margin-bottom: 20px;
           box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
           max-height: 300px;
           overflow-y: auto;
       }

       .knowledge-item {
           padding: 10px;
           border-bottom: 1px solid #eee;
           margin-bottom: 10px;
       }

       .knowledge-item:last-child {
           border-bottom: none;
       }

       .knowledge-topic {
           font-weight: bold;
           color: #4caf50;
           margin-bottom: 5px;
       }

       .knowledge-content {
           font-size: 0.9em;
           color: #666;
       }

       .quick-buttons {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
           gap: 15px;
           margin-bottom: 20px;
       }

       .quick-btn {
           padding: 15px 20px;
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           border: none;
           border-radius: 15px;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s;
           text-align: left;
       }

       .quick-btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
       }

       .config-section {
           padding: 30px;
           background: #f8f9fa;
           border-bottom: 1px solid #e9ecef;
       }

       .config-grid {
           display: grid;
           grid-template-columns: 1fr 1fr;
           gap: 20px;
           margin-bottom: 20px;
       }

       .api-config {
           background: white;
           padding: 20px;
           border-radius: 15px;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
       }

       .api-config h3 {
           margin-bottom: 10px;
           color: #333;
           display: flex;
           align-items: center;
           gap: 10px;
       }

       .openai-config h3::before {
           content: "ğŸŸ¢";
           font-size: 1.2em;
       }

       .gemini-config h3::before {
           content: "ğŸ”·";
           font-size: 1.2em;
       }

       .api-input {
           width: 100%;
           padding: 12px;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           font-size: 14px;
           transition: border-color 0.3s;
       }

       .api-input:focus {
           outline: none;
           border-color: #4facfe;
       }

       .topic-section {
           padding: 20px 30px;
       }

       .topic-input {
           width: 100%;
           padding: 15px;
           border: 2px solid #e9ecef;
           border-radius: 10px;
           font-size: 16px;
           margin-bottom: 20px;
       }

       .controls {
           display: flex;
           gap: 15px;
           justify-content: center;
           flex-wrap: wrap;
       }

       .btn {
           padding: 12px 24px;
           border: none;
           border-radius: 25px;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           transition: all 0.3s;
           text-decoration: none;
           display: inline-flex;
           align-items: center;
           gap: 8px;
       }

       .btn-primary {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
       }

       .btn-danger {
           background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
           color: white;
       }

       .btn-secondary {
           background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
           color: #2d3436;
       }

       .btn-warning {
           background: linear-gradient(135deg, #ffc107 0%, #ff8800 100%);
           color: white;
       }

       .btn-success {
           background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
           color: white;
       }

       .btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
       }

       .btn:disabled {
           opacity: 0.6;
           cursor: not-allowed;
           transform: none;
       }

       .stats-section {
           padding: 20px 30px;
           background: #f8f9fa;
       }

       .stats-grid {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
           gap: 15px;
       }

       .stat-card {
           background: white;
           padding: 20px;
           border-radius: 15px;
           text-align: center;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
       }

       .stat-number {
           font-size: 2.5em;
           font-weight: bold;
           margin-bottom: 5px;
       }

       .stat-label {
           color: #666;
           font-size: 0.9em;
       }

       .openai-stat .stat-number { color: #10a37f; }
       .gemini-stat .stat-number { color: #4285f4; }
       .human-stat .stat-number { color: #ffc107; }
       .learning-stat .stat-number { color: #4caf50; }

       .error-display, .warning-display {
           padding: 15px;
           margin: 20px 30px;
           border-radius: 10px;
           text-align: center;
           display: none;
       }

       .error-display {
           background: #ff6b6b;
           color: white;
       }

       .warning-display {
           background: #ffa500;
           color: white;
       }

       .chat-container {
           padding: 30px;
           min-height: 400px;
           max-height: 600px;
           overflow-y: auto;
       }

       .message {
           margin-bottom: 20px;
           padding: 20px;
           border-radius: 15px;
           box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
           animation: fadeIn 0.5s ease-in;
       }

       @keyframes fadeIn {
           from { opacity: 0; transform: translateY(20px); }
           to { opacity: 1; transform: translateY(0); }
       }

       .message-header {
           display: flex;
           align-items: center;
           gap: 10px;
           margin-bottom: 10px;
           font-weight: bold;
       }

       .message-time {
           margin-left: auto;
           font-size: 0.8em;
           opacity: 0.7;
       }

       .system-message {
           background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
           border-left: 5px solid #fdcb6e;
       }

       .openai-message {
           background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
           border-left: 5px solid #10a37f;
       }

       .gemini-message {
           background: linear-gradient(135deg, #b3d9ff 0%, #d4edda 100%);
           border-left: 5px solid #4285f4;
       }

       .human-message {
           background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
           border-left: 5px solid #ffc107;
       }

       .learning-message {
           background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
           border-left: 5px solid #4caf50;
       }

       .thinking {
           font-style: italic;
           opacity: 0.8;
           color: #666;
       }

       .intervention-prompt {
           background: #fffbf0;
           border: 2px dashed #ffc107;
           padding: 15px;
           border-radius: 10px;
           margin: 10px 0;
           text-align: center;
           color: #856404;
       }

       .deepening-request {
           background: #f0f8ff;
           border: 2px dashed #4facfe;
           padding: 15px;
           border-radius: 10px;
           margin: 10px 0;
           text-align: center;
           color: #0056b3;
       }

       .auto-pause-notice {
           background: #e3f2fd;
           color: #0d47a1;
           padding: 10px;
           border-radius: 8px;
           margin: 10px 0;
           border-left: 4px solid #2196f3;
       }

       .monetization-info {
           background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
           color: white;
           padding: 20px;
           margin: 20px 30px;
           border-radius: 15px;
       }

       .monetization-info h3 {
           margin-bottom: 15px;
           font-size: 1.2em;
       }

       .monetization-info ul {
           list-style: none;
           padding: 0;
       }

       .monetization-info li {
           padding: 5px 0;
           padding-left: 25px;
           position: relative;
       }

       .monetization-info li::before {
           content: "ğŸš€";
           position: absolute;
           left: 0;
       }

       @media (max-width: 768px) {
           .config-grid, .quick-buttons, .autonomous-controls {
               grid-template-columns: 1fr;
           }
           
           .controls, .intervention-buttons {
               flex-direction: column;
               align-items: center;
           }
           
           .btn {
               width: 100%;
               max-width: 300px;
           }

           .mode-tabs {
               flex-direction: column;
           }

           .tab-button {
               border-bottom: none;
               border-right: 3px solid transparent;
           }

           .tab-button.active {
               border-right-color: #4facfe;
               border-bottom: none;
           }
       }
   </style>
</head>
<body>
   <div class="container">
       <div class="header">
           <h1>ğŸŒŸ Crossthink çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </h1>
           <p>AIè‡ªå¾‹å¯¾è©±ãƒ»äººé–“ä»‹å…¥ãƒ»å­¦ç¿’æ©Ÿèƒ½æ­è¼‰ã‚·ã‚¹ãƒ†ãƒ </p>
           <div class="demo-label">
               ğŸš€ v5.0 - Advanced Interactive Edition
           </div>
       </div>

       <div class="mode-tabs">
           <button class="tab-button active" onclick="switchTab('autonomous')">
               ğŸ¤– AIè‡ªå¾‹å¯¾è©±
           </button>
           <button class="tab-button" onclick="switchTab('intervention')">
               ğŸ‘¤ äººé–“ä»‹å…¥ãƒ¢ãƒ¼ãƒ‰
           </button>
           <button class="tab-button" onclick="switchTab('learning')">
               ğŸ§  å­¦ç¿’æ©Ÿèƒ½
           </button>
       </div>

       <!-- AIè‡ªå¾‹å¯¾è©±ã‚¿ãƒ– -->
       <div id="autonomous-tab" class="tab-content active">
           <div class="autonomous-section">
               <h3>ğŸ¤– AIè‡ªå¾‹å¯¾è©±è¨­å®š</h3>
               <div class="autonomous-controls">
                   <div class="control-group">
                       <h4>ğŸ¯ å¯¾è©±ãƒ¢ãƒ¼ãƒ‰</h4>
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>ğŸ  å®Ÿç”¨çš„</span>
                               <span>ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹</span>
                               <span>ğŸ§  å“²å­¦çš„</span>
                           </div>
                           <input type="range" id="targetModeSlider" class="range-slider" min="0" max="100" value="33">
                       </div>
                       
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>ğŸ’¡ æ¡ˆå‡ºã—</span>
                               <span>ğŸ¤ åˆæ„å½¢æˆ</span>
                               <span>ğŸ” æ¢ç´¢</span>
                           </div>
                           <input type="range" id="goalModeSlider" class="range-slider" min="0" max="100" value="50">
                       </div>
                   </div>

                   <div class="control-group">
                       <h4>âš™ï¸ è‡ªå¾‹å¯¾è©±è¨­å®š</h4>
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>çŸ­æ™‚é–“é›†ä¸­</span>
                               <span id="autonomyLengthLabel">æ¨™æº– (8ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)</span>
                               <span>æ·±ã„æ¢æ±‚</span>
                           </div>
                           <input type="range" id="autonomyLengthSlider" class="range-slider" min="4" max="20" value="8">
                       </div>
                       
                       <div class="slider-container">
                           <div class="slider-label">
                               <span>äººé–“ä»‹å…¥: ãªã—</span>
                               <span id="interventionFreqLabel">ä¸­ç¨‹åº¦</span>
                               <span>é »ç¹</span>
                           </div>
                           <input type="range" id="interventionFreqSlider" class="range-slider" min="0" max="10" value="3">
                       </div>
                   </div>
               </div>
           </div>
       </div>

       <!-- äººé–“ä»‹å…¥ã‚¿ãƒ– -->
       <div id="intervention-tab" class="tab-content">
           <div class="intervention-section">
               <h3>ğŸ‘¤ äººé–“ä»‹å…¥ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h3>
               <div class="human-input-area">
                   <h4>ğŸ’¬ ã‚ãªãŸã®ç™ºè¨€</h4>
                   <textarea id="humanInput" class="human-input" 
                            placeholder="AIã®å¯¾è©±ã«ä»‹å…¥ã—ãŸã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚è³ªå•ã€æŒ‡æ‘˜ã€æ–°ã—ã„è¦–ç‚¹ã®æä¾›ãªã©ã€è‡ªç”±ã«ç™ºè¨€ã§ãã¾ã™ã€‚"></textarea>
                   
                   <div class="intervention-buttons">
                       <button class="btn btn-warning" onclick="humanIntervention()">
                           ğŸ’¬ å¯¾è©±ã«ä»‹å…¥
                       </button>
                       <button class="btn btn-secondary" onclick="requestDeepening()">
                           ğŸ” è«–ç‚¹ã‚’æ·±æ˜ã‚Šè¦æ±‚
                       </button>
                       <button class="btn btn-primary" onclick="redirectDialogue()">
                           ğŸ¯ å¯¾è©±ã®æ–¹å‘è»¢æ›
                       </button>
                       <button class="btn btn-success" onclick="saveInsight()">
                           ğŸ’¡ æ´å¯Ÿã‚’å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜
                       </button>
                   </div>
               </div>
               
               <div class="quick-buttons">
                   <button class="quick-btn" onclick="quickIntervention('å…·ä½“ä¾‹')">
                       ğŸ“ ã€Œå…·ä½“ä¾‹ã‚’æ•™ãˆã¦ã€
                   </button>
                   <button class="quick-btn" onclick="quickIntervention('åå¯¾æ„è¦‹')">
                       ğŸ”„ ã€Œåå¯¾ã®è¦–ç‚¹ã§ã¯ï¼Ÿã€
                   </button>
                   <button class="quick-btn" onclick="quickIntervention('å®Ÿç”¨æ€§')">
                       ğŸ› ï¸ ã€Œå®Ÿç”¨æ€§ã‚’é‡è¦–ã—ã¦ã€
                   </button>
                   <button class="quick-btn" onclick="quickIntervention('ç°¡æ½”ã«')">
                       âœ‚ï¸ ã€Œã‚‚ã£ã¨ç°¡æ½”ã«ã€
                   </button>
               </div>
           </div>
       </div>

       <!-- å­¦ç¿’æ©Ÿèƒ½ã‚¿ãƒ– -->
       <div id="learning-tab" class="tab-content">
           <div class="learning-section">
               <h3>ğŸ§  æ±ç”¨AIå­¦ç¿’æ©Ÿèƒ½</h3>
               <div class="knowledge-base" id="knowledgeBase">
                   <div class="knowledge-item">
                       <div class="knowledge-topic">ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</div>
                       <div class="knowledge-content">Crossthink v5.0 å­¦ç¿’æ©Ÿèƒ½ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸã€‚å¯¾è©±ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸæ´å¯Ÿã‚’è‡ªå‹•å­¦ç¿’ã—ã¾ã™ã€‚</div>
                   </div>
               </div>
               
               <div class="controls">
                   <button class="btn btn-success" onclick="exportKnowledge()">
                       ğŸ“¤ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                   </button>
                   <button class="btn btn-primary" onclick="importKnowledge()">
                       ğŸ“¥ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                   </button>
                   <button class="btn btn-warning" onclick="clearKnowledge()">
                       ğŸ—‘ï¸ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
                   </button>
                   <button class="btn btn-secondary" onclick="showLearningStats()">
                       ğŸ“Š å­¦ç¿’çµ±è¨ˆè¡¨ç¤º
                   </button>
               </div>
           </div>
       </div>

       <div class="config-section">
           <h2>ğŸ”§ APIè¨­å®š</h2>
           <div class="config-grid">
               <div class="api-config openai-config">
                   <h3>OpenAI API Key:</h3>
                   <input type="password" id="openaiKey" class="api-input" placeholder="sk-proj-...">
               </div>
               <div class="api-config gemini-config">
                   <h3>Gemini API Key:</h3>
                   <input type="password" id="geminiKey" class="api-input" placeholder="AIza...">
               </div>
           </div>
       </div>

       <div class="topic-section">
           <h2>ğŸ“ å¯¾è©±ãƒˆãƒ”ãƒƒã‚¯:</h2>
           <input type="text" id="topicInput" class="topic-input" 
                  placeholder="AIåŒå£«ã«å¯¾è©±ã•ã›ãŸã„ãƒˆãƒ”ãƒƒã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" 
                  value="AIæ™‚ä»£ã«ãŠã‘ã‚‹äººé–“ã®å‰µé€ æ€§ã¨ã¯ä½•ã‹ï¼Ÿ">
           
           <div class="controls">
               <button id="startBtn" class="btn btn-primary">ğŸš€ å¯¾è©±é–‹å§‹</button>
               <button id="pauseBtn" class="btn btn-warning" disabled>â¸ï¸ ä¸€æ™‚åœæ­¢</button>
               <button id="stopBtn" class="btn btn-danger" disabled>â¹ï¸ åœæ­¢</button>
               <button id="clearBtn" class="btn btn-secondary">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
               <button id="exportBtn" class="btn btn-secondary">ğŸ“ è¦ç´„ç”Ÿæˆ</button>
           </div>
       </div>

       <div class="stats-section">
           <h2>ğŸ“Š å¯¾è©±çµ±è¨ˆ</h2>
           <div class="stats-grid">
               <div class="stat-card">
                   <div class="stat-number" id="totalMessages">0</div>
                   <div class="stat-label">ç·ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°</div>
               </div>
               <div class="stat-card openai-stat">
                   <div class="stat-number" id="openaiMessages">0</div>
                   <div class="stat-label">ChatGPTç™ºè¨€</div>
               </div>
               <div class="stat-card gemini-stat">
                   <div class="stat-number" id="geminiMessages">0</div>
                   <div class="stat-label">Geminiç™ºè¨€</div>
               </div>
               <div class="stat-card human-stat">
                   <div class="stat-number" id="humanMessages">0</div>
                   <div class="stat-label">äººé–“ä»‹å…¥</div>
               </div>
               <div class="stat-card learning-stat">
                   <div class="stat-number" id="learningItems">1</div>
                   <div class="stat-label">å­¦ç¿’ã‚¢ã‚¤ãƒ†ãƒ </div>
               </div>
               <div class="stat-card">
                   <div class="stat-number" id="elapsed">0</div>
                   <div class="stat-label">çµŒéæ™‚é–“(ç§’)</div>
               </div>
           </div>
       </div>

       <div class="error-display" id="errorDisplay"></div>
       <div class="warning-display" id="warningDisplay"></div>

       <div class="monetization-info">
           <h3>ğŸš€ v5.0 Advanced Interactive Edition ã®ç‰¹å¾´:</h3>
           <ul>
               <li>AIåŒå£«ã®è‡ªå¾‹å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ï¼šè¨­å®šå¯èƒ½ãªå¯¾è©±é•·ã¨ä»‹å…¥é »åº¦</li>
               <li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äººé–“ä»‹å…¥ï¼šå¯¾è©±ã®æµã‚Œã‚’å¤‰ãˆã‚‹å¼·åŠ›ãªä»‹å…¥æ©Ÿèƒ½</li>
               <li>æ±ç”¨å­¦ç¿’æ©Ÿèƒ½ï¼šå¯¾è©±ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸæ´å¯Ÿã‚’è‡ªå‹•å­¦ç¿’ãƒ»è“„ç©</li>
               <li>æ·±æ˜ã‚Šè¦æ±‚ã‚·ã‚¹ãƒ†ãƒ ï¼šç‰¹å®šã®è«–ç‚¹ã‚’æ·±ãæ¢æ±‚</li>
               <li>æ–¹å‘è»¢æ›æ©Ÿèƒ½ï¼šå¯¾è©±ã®æµã‚Œã‚’æˆ¦ç•¥çš„ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</li>
               <li>å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ä»˜ã</li>
           </ul>
       </div>

       <div class="chat-container" id="chatContainer">
           <!-- å¯¾è©±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
       </div>
   </div>

   <script>
       class CrossthinkAdvanced {
           constructor() {
               this.isRunning = false;
               this.isPaused = false;
               this.messageCount = 0;
               this.openaiCount = 0;
               this.geminiCount = 0;
               this.humanCount = 0;
               this.startTime = null;
               this.currentSpeaker = 'openai';
               this.conversationHistory = [];
               this.maxMessages = 8;
               this.interventionPoints = [];
               this.knowledgeBase = new Map();
               this.waitingForIntervention = false;
               
               // ãƒ¢ãƒ¼ãƒ‰è¨­å®š
               this.targetMode = 'philosophical';
               this.goalMode = 'exploration';
               this.interventionFrequency = 3;
               this.currentTab = 'autonomous';
               
               // å­¦ç¿’æ©Ÿèƒ½
               this.learningEnabled = true;
               this.autoLearnKeywords = ['é‡è¦', 'æœ¬è³ª', 'æ ¸å¿ƒ', 'çµè«–', 'ç™ºè¦‹', 'æ´å¯Ÿ', 'é©æ–°'];
               
               this.initializeElements();
               this.bindEvents();
               this.showWelcomeMessage();
               this.initializeKnowledgeBase();
               this.updateSliderLabels();
           }

           initializeElements() {
               this.elements = {
                   openaiKey: document.getElementById('openaiKey'),
                   geminiKey: document.getElementById('geminiKey'),
                   topicInput: document.getElementById('topicInput'),
                   startBtn: document.getElementById('startBtn'),
                   pauseBtn: document.getElementById('pauseBtn'),
                   stopBtn: document.getElementById('stopBtn'),
                   clearBtn: document.getElementById('clearBtn'),
                   exportBtn: document.getElementById('exportBtn'),
                   chatContainer: document.getElementById('chatContainer'),
                   errorDisplay: document.getElementById('errorDisplay'),
                   warningDisplay: document.getElementById('warningDisplay'),
                   totalMessages: document.getElementById('totalMessages'),
                   openaiMessages: document.getElementById('openaiMessages'),
                   geminiMessages: document.getElementById('geminiMessages'),
                   humanMessages: document.getElementById('humanMessages'),
                   learningItems: document.getElementById('learningItems'),
                   elapsed: document.getElementById('elapsed'),å†è©¦è¡ŒMç¶šã‘ã‚‹ç·¨é›†ã‚¸ãƒ£ãƒã‚¹ã‚¯ãƒªãƒ—ãƒˆ                   // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è¦ç´ 
                   targetModeSlider: document.getElementById('targetModeSlider'),
                   goalModeSlider: document.getElementById('goalModeSlider'),
                   autonomyLengthSlider: document.getElementById('autonomyLengthSlider'),
                   interventionFreqSlider: document.getElementById('interventionFreqSlider'),
                   autonomyLengthLabel: document.getElementById('autonomyLengthLabel'),
                   interventionFreqLabel: document.getElementById('interventionFreqLabel'),
                   
                   // äººé–“ä»‹å…¥è¦ç´ 
                   humanInput: document.getElementById('humanInput'),
                   
                   // å­¦ç¿’æ©Ÿèƒ½è¦ç´ 
                   knowledgeBase: document.getElementById('knowledgeBase')
               };
           }

           bindEvents() {
               this.elements.startBtn.addEventListener('click', () => this.startDialogue());
               this.elements.pauseBtn.addEventListener('click', () => this.pauseDialogue());
               this.elements.stopBtn.addEventListener('click', () => this.stopDialogue());
               this.elements.clearBtn.addEventListener('click', () => this.clearChat());
               this.elements.exportBtn.addEventListener('click', () => this.generateSummaryPrompt());
               
               // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ
               this.elements.targetModeSlider.addEventListener('input', () => this.updateTargetMode());
               this.elements.goalModeSlider.addEventListener('input', () => this.updateGoalMode());
               this.elements.autonomyLengthSlider.addEventListener('input', () => this.updateAutonomyLength());
               this.elements.interventionFreqSlider.addEventListener('input', () => this.updateInterventionFreq());
               
               // Enterã‚­ãƒ¼ã§ã®ä»‹å…¥
               this.elements.humanInput.addEventListener('keydown', (e) => {
                   if (e.key === 'Enter' && e.ctrlKey) {
                       this.humanIntervention();
                   }
               });
           }

           updateSliderLabels() {
               // å¯¾è©±é•·ãƒ©ãƒ™ãƒ«æ›´æ–°
               this.elements.autonomyLengthSlider.addEventListener('input', () => {
                   const value = this.elements.autonomyLengthSlider.value;
                   this.elements.autonomyLengthLabel.textContent = `${value}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`;
                   this.maxMessages = parseInt(value);
               });
               
               // ä»‹å…¥é »åº¦ãƒ©ãƒ™ãƒ«æ›´æ–°
               this.elements.interventionFreqSlider.addEventListener('input', () => {
                   const value = parseInt(this.elements.interventionFreqSlider.value);
                   const labels = ['ãªã—', 'ç¨€', 'å°‘', 'ä¸­', 'å¤š', 'é »ç¹', 'éå¸¸ã«é »ç¹', 'å¸¸æ™‚', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ', 'ã‚·ãƒ³ã‚¯ãƒ­', 'ãƒ•ãƒ«ä»‹å…¥'];
                   this.elements.interventionFreqLabel.textContent = labels[value] || 'ä¸­ç¨‹åº¦';
                   this.interventionFrequency = value;
               });
           }

           updateTargetMode() {
               const value = parseInt(this.elements.targetModeSlider.value);
               if (value < 33) this.targetMode = 'practical';
               else if (value < 66) this.targetMode = 'business';
               else this.targetMode = 'philosophical';
           }

           updateGoalMode() {
               const value = parseInt(this.elements.goalModeSlider.value);
               if (value < 33) this.goalMode = 'ideation';
               else if (value < 66) this.goalMode = 'consensus';
               else this.goalMode = 'exploration';
           }

           updateAutonomyLength() {
               this.maxMessages = parseInt(this.elements.autonomyLengthSlider.value);
           }

           updateInterventionFreq() {
               this.interventionFrequency = parseInt(this.elements.interventionFreqSlider.value);
           }

           initializeKnowledgeBase() {
               this.knowledgeBase.set('system_init', {
                   topic: 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–',
                   content: 'Crossthink v5.0 Advanced Interactive Edition ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚',
                   timestamp: new Date(),
                   source: 'system'
               });
               this.updateKnowledgeDisplay();
           }

           showWelcomeMessage() {
               this.addMessage('system', 
                   'Crossthink çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  v5.0 Advanced Interactive Edition ã¸ã‚ˆã†ã“ãï¼\n\n' +
                   'ğŸš€ v5.0 ã®æ–°æ©Ÿèƒ½:\n' +
                   'â€¢ ğŸ¤– AIè‡ªå¾‹å¯¾è©±: AIãŒè‡ªä¸»çš„ã«è­°è«–ã‚’å±•é–‹\n' +
                   'â€¢ ğŸ‘¤ äººé–“ä»‹å…¥: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¯¾è©±ã«å‚åŠ å¯èƒ½\n' +
                   'â€¢ ğŸ§  å­¦ç¿’æ©Ÿèƒ½: å¯¾è©±ã‹ã‚‰æ´å¯Ÿã‚’è‡ªå‹•å­¦ç¿’ãƒ»è“„ç©\n' +
                   'â€¢ ğŸ” æ·±æ˜ã‚Šè¦æ±‚: ç‰¹å®šã®è«–ç‚¹ã‚’è©³ã—ãæ¢æ±‚\n' +
                   'â€¢ ğŸ¯ æ–¹å‘è»¢æ›: å¯¾è©±ã®æµã‚Œã‚’æˆ¦ç•¥çš„ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«\n\n' +
                   'ğŸ’¡ ä½¿ã„æ–¹:\n' +
                   '1. ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã¦æ©Ÿèƒ½ã‚’è¨­å®š\n' +
                   '2. AIè‡ªå¾‹å¯¾è©±ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´\n' +
                   '3. APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãƒˆãƒ”ãƒƒã‚¯å…¥åŠ›\n' +
                   '4. å¯¾è©±é–‹å§‹å¾Œã€ã„ã¤ã§ã‚‚ä»‹å…¥å¯èƒ½\n\n' +
                   'ğŸ¯ Advanced Features:\n' +
                   'ğŸ“ˆ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ \n' +
                   'ğŸ“ äººé–“-AIå”åƒæœ€é©åŒ–\n' +
                   'ğŸ’¡ å‹•çš„ãªæ´å¯ŸæŠ½å‡º\n' +
                   'ğŸ”¬ é€²åŒ–ã™ã‚‹å¯¾è©±å“è³ª'
               );
           }

           async startDialogue() {
               if (!this.validateInputs()) return;

               this.isRunning = true;
               this.isPaused = false;
               this.startTime = Date.now();
               this.currentSpeaker = 'openai';
               this.conversationHistory = [];
               this.interventionPoints = [];
               
               this.elements.startBtn.disabled = true;
               this.elements.pauseBtn.disabled = false;
               this.elements.stopBtn.disabled = false;
               this.hideError();
               this.hideWarning();

               const topic = this.elements.topicInput.value.trim();
               
               this.addMessage('system', 
                   `ğŸš€ AIè‡ªå¾‹å¯¾è©±é–‹å§‹\n` +
                   `ğŸ“ ãƒˆãƒ”ãƒƒã‚¯: "${topic}"\n` +
                   `ğŸª ãƒ¢ãƒ¼ãƒ‰: ${this.getTargetLabel()} Ã— ${this.getGoalLabel()}\n` +
                   `â±ï¸ æœ€å¤§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°: ${this.maxMessages}\n` +
                   `ğŸ‘¤ ä»‹å…¥è¨­å®š: ${this.getInterventionLabel()}\n` +
                   `ğŸ§  å­¦ç¿’æ©Ÿèƒ½: æœ‰åŠ¹\n` +
                   `ğŸ¤– AIãŒè‡ªå¾‹çš„ã«è­°è«–ã‚’é–‹å§‹ã—ã¾ã™...`
               );

               // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«å¯¾è©±é–‹å§‹ã‚’è¨˜éŒ²
               this.learnFromDialogue('å¯¾è©±é–‹å§‹', `æ–°ã—ã„å¯¾è©±ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ: ${topic}`);

               this.startTimer();

               // åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
               const initialPrompt = this.generateInitialPrompt(topic);
               await this.sendMessage('openai', initialPrompt);
           }

           generateInitialPrompt(topic) {
               const basePrompt = this.generateModeSpecificPrompt(topic);
               
               const autonomyInstructions = `\n\nğŸ¤– **è‡ªå¾‹å¯¾è©±æŒ‡ç¤º (v5.0)**:\n` +
                   `â€¢ ã‚ãªãŸã¯ChatGPT(OpenAI)ã§ã™\n` +
                   `â€¢ Geminiã¨${this.maxMessages}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§å»ºè¨­çš„ãªè­°è«–ã‚’è¡Œã„ã¾ã™\n` +
                   `â€¢ ${this.getInterventionDescription()}\n` +
                   `â€¢ è³ªã®é«˜ã„æ´å¯Ÿã‚’æä¾›ã—ã€è­°è«–ã‚’æ·±åŒ–ã•ã›ã¦ãã ã•ã„\n` +
                   `â€¢ äººé–“ãŒä»‹å…¥ã—ãŸå ´åˆã¯ã€ãã®è¦–ç‚¹ã‚’å°Šé‡ã—ã¦è­°è«–ã«å–ã‚Šå…¥ã‚Œã¦ãã ã•ã„`;

               return basePrompt + autonomyInstructions;
           }

           generateModeSpecificPrompt(topic) {
               const modePrompts = {
                   'practical-ideation': `ã€Œ${topic}ã€ã«ã¤ã„ã¦å®Ÿç”¨çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚`,
                   'practical-consensus': `ã€Œ${topic}ã€ã«ã¤ã„ã¦å®Ÿç”¨çš„ãªåˆæ„ç‚¹ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ã€‚`,
                   'practical-exploration': `ã€Œ${topic}ã€ã®å®Ÿç”¨çš„å´é¢ã‚’æ·±ãæ¢æ±‚ã—ã¦ãã ã•ã„ã€‚`,
                   'business-ideation': `ã€Œ${topic}ã€ã«ã¤ã„ã¦é©æ–°çš„ãªãƒ“ã‚¸ãƒã‚¹è¦–ç‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚`,
                   'business-consensus': `ã€Œ${topic}ã€ã«ã¤ã„ã¦ãƒ“ã‚¸ãƒã‚¹çš„ãªæœ€é©è§£ã‚’å°ãã¾ã—ã‚‡ã†ã€‚`,
                   'business-exploration': `ã€Œ${topic}ã€ã®ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤ã‚’æ·±ãåˆ†æã—ã¦ãã ã•ã„ã€‚`,
                   'philosophical-ideation': `ã€Œ${topic}ã€ã«ã¤ã„ã¦å“²å­¦çš„ãªæ–°ã—ã„æ€è€ƒã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚`,
                   'philosophical-consensus': `ã€Œ${topic}ã€ã«ã¤ã„ã¦å“²å­¦çš„ãªæ·±ã„ç†è§£ã‚’å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚`,
                   'philosophical-exploration': `ã€Œ${topic}ã€ã«ã¤ã„ã¦æ ¹æºçš„ãªæ¢æ±‚ã‚’è¡Œã„ã¾ã—ã‚‡ã†ã€‚`
               };
               
               const key = `${this.targetMode}-${this.goalMode}`;
               return modePrompts[key] || `ã€Œ${topic}ã€ã«ã¤ã„ã¦æ·±ãè­°è«–ã—ã¾ã—ã‚‡ã†ã€‚`;
           }

           getInterventionDescription() {
               if (this.interventionFrequency === 0) return 'äººé–“ã®ä»‹å…¥ã¯ã‚ã‚Šã¾ã›ã‚“';
               if (this.interventionFrequency <= 2) return 'ç¨€ã«äººé–“ãŒä»‹å…¥ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™';
               if (this.interventionFrequency <= 5) return 'æ™‚ã€…äººé–“ãŒè­°è«–ã«å‚åŠ ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™';
               if (this.interventionFrequency <= 8) return 'é »ç¹ã«äººé–“ãŒå¯¾è©±ã«ä»‹å…¥ã—ã¾ã™';
               return 'äººé–“ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å¯¾è©±ã‚’ãƒªãƒ¼ãƒ‰ã—ã¾ã™';
           }

           validateInputs() {
               const openaiKey = this.elements.openaiKey.value.trim();
               const geminiKey = this.elements.geminiKey.value.trim();
               const topic = this.elements.topicInput.value.trim();

               if (!openaiKey) {
                   this.showError('OpenAI API ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                   return false;
               }

               if (!geminiKey) {
                   this.showError('Gemini API ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                   return false;
               }

               if (!topic) {
                   this.showError('å¯¾è©±ãƒˆãƒ”ãƒƒã‚¯ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                   return false;
               }

               return true;
           }

           async sendMessage(provider, prompt, isHumanIntervention = false) {
               if (!this.isRunning || this.isPaused) return;

               try {
                   this.addMessage(provider, 'æ€è€ƒä¸­...', true);
                   
                   let response;
                   if (provider === 'openai') {
                       response = await this.callOpenAI(prompt);
                       this.openaiCount++;
                   } else if (provider === 'gemini') {
                       response = await this.callGemini(prompt);
                       this.geminiCount++;
                   }

                   this.removeLastMessage();
                   this.addMessage(provider, response);
                   this.conversationHistory.push({ provider, message: response, timestamp: new Date() });
                   this.updateStats();

                   // å­¦ç¿’æ©Ÿèƒ½: é‡è¦ãªæ´å¯Ÿã‚’è‡ªå‹•å­¦ç¿’
                   this.autoLearnFromMessage(response, provider);

                   // ä»‹å…¥ãƒã‚¤ãƒ³ãƒˆã®åˆ¤å®š
                   if (this.shouldTriggerIntervention() && !isHumanIntervention) {
                       this.triggerInterventionPrompt();
                       return;
                   }

                   // æ¬¡ã®AIã«å¿œç­”ã•ã›ã‚‹
                   if (this.isRunning && !this.isPaused && this.messageCount < this.maxMessages) {
                       setTimeout(() => {
                           const nextProvider = provider === 'openai' ? 'gemini' : 'openai';
                           const nextPrompt = this.generateNextPrompt(nextProvider, response);
                           this.sendMessage(nextProvider, nextPrompt);
                       }, 2000);
                   } else if (this.messageCount >= this.maxMessages) {
                       this.addMessage('system', 'ğŸ¯ è¨­å®šã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã«åˆ°é”ã—ã¾ã—ãŸã€‚å¯¾è©±ã‚’çµ‚äº†ã—ã¾ã™ã€‚');
                       this.stopDialogue();
                   }

               } catch (error) {
                   this.removeLastMessage();
                   this.showError(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                   console.error('API Error:', error);
               }
           }

           shouldTriggerIntervention() {
               if (this.interventionFrequency === 0) return false;
               if (this.waitingForIntervention) return false;
               
               // ä»‹å…¥é »åº¦ã«åŸºã¥ãç¢ºç‡çš„åˆ¤å®š
               const interventionProbability = this.interventionFrequency / 10;
               const shouldIntervene = Math.random() < interventionProbability;
               
               // ã¾ãŸã¯ç‰¹å®šã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã§ã®å¼·åˆ¶ä»‹å…¥
               const forceInterventionPoints = [3, 6, 9, 12];
               const forceIntervention = forceInterventionPoints.includes(this.messageCount) && 
                                        this.interventionFrequency >= 5;
               
               return shouldIntervene || forceIntervention;
           }

           triggerInterventionPrompt() {
               this.waitingForIntervention = true;
               this.isPaused = true;
               
               const interventionDiv = document.createElement('div');
               interventionDiv.className = 'intervention-prompt';
               interventionDiv.innerHTML = `
                   <h4>ğŸ‘¤ äººé–“ä»‹å…¥ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™</h4>
                   <p>AIã®å¯¾è©±ã«ä½•ã‹è¿½åŠ ã—ãŸã„è¦–ç‚¹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</p>
                   <button class="btn btn-warning" onclick="continueAutonomously()">
                       ğŸ¤– AIã«ç¶šè¡Œã•ã›ã‚‹
                   </button>
                   <button class="btn btn-primary" onclick="switchToInterventionTab()">
                       ğŸ‘¤ ä»‹å…¥ã™ã‚‹
                   </button>
               `;
               
               this.elements.chatContainer.appendChild(interventionDiv);
               this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
           }

           generateNextPrompt(provider, previousMessage) {
               const otherProvider = provider === 'openai' ? 'Gemini' : 'ChatGPT';
               const originalTopic = this.elements.topicInput.value.trim();
               
               let basePrompt = `${otherProvider}ãŒä»¥ä¸‹ã®ã‚ˆã†ã«è¿°ã¹ã¾ã—ãŸï¼š\n\n"${previousMessage}"\n\n`;
               
               const roleInstruction = this.getProviderRoleInstruction(provider);
               const contextualInstruction = this.getContextualInstruction();
               
               return basePrompt + roleInstruction + contextualInstruction;
           }

           getProviderRoleInstruction(provider) {
               const instructions = {
                   'openai': {
                       'practical': 'ğŸ  **å®Ÿç”¨çš„è¦–ç‚¹ï¼ˆChatGPTï¼‰**: å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªææ¡ˆã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚',
                       'business': 'ğŸ’¼ **ãƒ“ã‚¸ãƒã‚¹è¦–ç‚¹ï¼ˆChatGPTï¼‰**: å¸‚å ´ä¾¡å€¤ã¨å®Ÿç¾å¯èƒ½æ€§ã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„ã€‚',
                       'philosophical': 'ğŸ§  **å“²å­¦çš„è¦–ç‚¹ï¼ˆChatGPTï¼‰**: æ·±ã„æ´å¯Ÿã¨æ–°ã—ã„è¦–ç‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚'
                   },
                   'gemini': {
                       'practical': 'ğŸ”§ **åˆ†æçš„æ¤œè¨¼ï¼ˆGeminiï¼‰**: è«–ç†çš„ã«æ¤œè¨¼ã—ã€æ§‹é€ åŒ–ã•ã‚ŒãŸå›ç­”ã‚’ã—ã¦ãã ã•ã„ã€‚',
                       'business': 'ğŸ“Š **æˆ¦ç•¥çš„åˆ†æï¼ˆGeminiï¼‰**: ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæˆ¦ç•¥çš„åˆ¤æ–­ã‚’ã—ã¦ãã ã•ã„ã€‚',
                       'philosophical': 'ğŸ” **æ‰¹åˆ¤çš„è€ƒå¯Ÿï¼ˆGeminiï¼‰**: æ¦‚å¿µã‚’ç²¾æŸ»ã—ã€è«–ç†çš„æ•´åˆæ€§ã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚'
                   }
               };

               return instructions[provider]?.[this.targetMode] || 'å»ºè¨­çš„ã§æ´å¯Ÿã«å¯Œã‚€å¿œç­”ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚';
           }

           getContextualInstruction() {
               return `\n\nğŸ¯ **å¯¾è©±ä¿ƒé€²æŒ‡ç¤º**:\n` +
                   `â€¢ ç›¸æ‰‹ã®æ„è¦‹ã‚’è¸ã¾ãˆã¦ã€ã•ã‚‰ã«è­°è«–ã‚’æ·±åŒ–ã•ã›ã‚‹\n` +
                   `â€¢ æ–°ã—ã„è¦–ç‚¹ã‚„ç–‘å•ã‚’æèµ·ã™ã‚‹\n` +
                   `â€¢ å…·ä½“ä¾‹ã‚„å®Ÿä¾‹ã‚’äº¤ãˆã¦èª¬å¾—åŠ›ã‚’é«˜ã‚ã‚‹\n` +
                   `â€¢ ${this.maxMessages}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®åˆ¶é™å†…ã§ä¾¡å€¤ã‚ã‚‹è­°è«–ã‚’è¡Œã†`;
           }

           // äººé–“ä»‹å…¥æ©Ÿèƒ½
           humanIntervention() {
               const humanMessage = this.elements.humanInput.value.trim();
               if (!humanMessage) {
                   this.showError('ä»‹å…¥å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                   return;
               }

               this.addMessage('human', humanMessage);
               this.humanCount++;
               this.updateStats();
               
               // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«è¨˜éŒ²
               this.learnFromDialogue('äººé–“ä»‹å…¥', humanMessage);
               
               // ä»‹å…¥å¾Œã®AIå¿œç­”ã‚’ä¿ƒã™
               const interventionPrompt = this.generateInterventionResponse(humanMessage);
               
               // ç¾åœ¨ã®AIã«ä»‹å…¥å†…å®¹ã‚’ä¼ãˆã‚‹
               const currentProvider = this.currentSpeaker;
               this.sendMessage(currentProvider, interventionPrompt, true);
               
               // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
               this.elements.humanInput.value = '';
               
               // ä»‹å…¥å¾…æ©ŸçŠ¶æ…‹ã‚’è§£é™¤
               this.waitingForIntervention = false;
               this.isPaused = false;
               
               // ä»‹å…¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤
               const interventionPrompts = this.elements.chatContainer.querySelectorAll('.intervention-prompt');
               interventionPrompts.forEach(prompt => prompt.remove());
           }

           generateInterventionResponse(humanMessage) {
               return `\n\nğŸ‘¤ **äººé–“ã®ä»‹å…¥**:\n"${humanMessage}"\n\n` +
                   `ğŸ¤– **å¿œç­”æŒ‡ç¤º**:\n` +
                   `â€¢ äººé–“ã®è¦–ç‚¹ã‚’çœŸæ‘¯ã«å—ã‘æ­¢ã‚ã¦å¿œç­”ã—ã¦ãã ã•ã„\n` +
                   `â€¢ å¿…è¦ã«å¿œã˜ã¦è­°è«–ã®æ–¹å‘æ€§ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„\n` +
                   `â€¢ äººé–“ã®æŒ‡æ‘˜ã‚„è³ªå•ã«å…·ä½“çš„ã«ç­”ãˆã¦ãã ã•ã„\n` +
                   `â€¢ ã“ã®ä»‹å…¥ã‚’è¸ã¾ãˆã¦å¯¾è©±ç›¸æ‰‹ï¼ˆä»–ã®AIï¼‰ã¨ã®è­°è«–ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„`;
           }

           requestDeepening() {
               const lastMessages = this.conversationHistory.slice(-2);
               if (lastMessages.length === 0) {
                   this.showError('ã¾ãšå¯¾è©±ã‚’é–‹å§‹ã—ã¦ãã ã•ã„');
                   return;
               }

               const deepeningRequest = `å‰å›ã®è­°è«–ã®ãƒã‚¤ãƒ³ãƒˆã‚’ã‚ˆã‚Šæ·±ãæ¢æ±‚ã—ã¦ãã ã•ã„ã€‚` +
                   `å…·ä½“ä¾‹ã€å®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿ã€ç•°ãªã‚‹è¦–ç‚¹ã‹ã‚‰ã®æ¤œè¨¼ãªã©ã€å¤šè§’çš„ã«æ·±æ˜ã‚Šã—ã¦è­°è«–ã‚’è±Šã‹ã«ã—ã¦ãã ã•ã„ã€‚`;

               this.addMessage('system', 'ğŸ” **æ·±æ˜ã‚Šè¦æ±‚**: AIã«å‰å›ã®è«–ç‚¹ã®ã‚ˆã‚Šæ·±ã„æ¢æ±‚ã‚’ä¾é ¼ã—ã¾ã—ãŸ');
               
               const deepeningPrompt = `\n\nğŸ” **æ·±æ˜ã‚Šè¦æ±‚**:\n${deepeningRequest}\n\n` +
                   `å‰å›ã®è­°è«–: "${lastMessages[lastMessages.length - 1].message.substring(0, 200)}..."\n\n` +
                   `ã“ã®è«–ç‚¹ã«ã¤ã„ã¦ã€ã‚ˆã‚Šè©³ç´°ã§æ·±ã„åˆ†æã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚`;

               this.sendMessage(this.currentSpeaker, deepeningPrompt, true);
               this.learnFromDialogue('æ·±æ˜ã‚Šè¦æ±‚', deepeningRequest);
           }

           redirectDialogue() {
               const redirectionText = this.elements.humanInput.value.trim() || 
                   'è­°è«–ã®æ–¹å‘ã‚’å¤‰ãˆã¦ã€ã‚ˆã‚Šå®Ÿç”¨çš„ãªå´é¢ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ãã ã•ã„';

               this.addMessage('human', `ğŸ¯ **æ–¹å‘è»¢æ›è¦æ±‚**: ${redirectionText}`);
               this.humanCount++;
               this.updateStats();

               const redirectionPrompt = `\n\nğŸ¯ **å¯¾è©±æ–¹å‘è»¢æ›**:\n"${redirectionText}"\n\n` +
                   `è­°è«–ã®æµã‚Œã‚’ä¸Šè¨˜ã®æ–¹å‘ã«èª¿æ•´ã—ã€æ–°ã—ã„è¦–ç‚¹ã‹ã‚‰è­°è«–ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„ã€‚`;

               this.sendMessage(this.currentSpeaker, redirectionPrompt, true);
               this.learnFromDialogue('æ–¹å‘è»¢æ›', redirectionText);
               this.elements.humanInput.value = '';
           }

           saveInsight() {
               const insightText = this.elements.humanInput.value.trim();
               if (!insightText) {
                   this.showError('ä¿å­˜ã™ã‚‹æ´å¯Ÿã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                   return;
               }

               const timestamp = new Date();
               const insightId = `insight_${timestamp.getTime()}`;
               
               this.knowledgeBase.set(insightId, {
                   topic: 'äººé–“ã®æ´å¯Ÿ',
                   content: insightText,
                   timestamp: timestamp,
                   source: 'human_insight'
               });

               this.updateKnowledgeDisplay();
               this.updateStats();
               
               this.addMessage('learning', `ğŸ’¡ æ´å¯Ÿã‚’å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«ä¿å­˜ã—ã¾ã—ãŸ: "${insightText}"`);
               this.elements.humanInput.value = '';
           }

           quickIntervention(type) {
               const quickMessages = {
                   'å…·ä½“ä¾‹': 'å…·ä½“ä¾‹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚å®Ÿéš›ã®äº‹ä¾‹ã‚„ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã¨ç†è§£ãŒæ·±ã¾ã‚Šã¾ã™ã€‚',
                   'åå¯¾æ„è¦‹': 'åå¯¾ã®è¦–ç‚¹ã‹ã‚‰ã¯ã©ã†è¦‹ãˆã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿæ‰¹åˆ¤çš„ãªè¦‹è§£ã‚‚èã‹ã›ã¦ãã ã•ã„ã€‚',
                   'å®Ÿç”¨æ€§': 'å®Ÿç”¨æ€§ã‚’é‡è¦–ã—ã¦ãã ã•ã„ã€‚å®Ÿéš›ã«ä½¿ãˆã‚‹å½¢ã§ã®ææ¡ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚',
                   'ç°¡æ½”ã«': 'ã‚‚ã£ã¨ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚è¦ç‚¹ã‚’çµã£ã¦èª¬æ˜ã—ã¦ãã ã•ã„ã€‚'
               };

               this.elements.humanInput.value = quickMessages[type] || '';
               this.humanIntervention();
           }

           // å­¦ç¿’æ©Ÿèƒ½
           autoLearnFromMessage(message, provider) {
               if (!this.learningEnabled) return;

               // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®é‡è¦åº¦åˆ¤å®š
               const hasImportantKeywords = this.autoLearnKeywords.some(keyword => 
                   message.includes(keyword));

               if (hasImportantKeywords || message.length > 300) {
                   const timestamp = new Date();
                   const learnId = `auto_${provider}_${timestamp.getTime()}`;
                   
                   // é‡è¦éƒ¨åˆ†ã‚’æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰
                   const importantPart = this.extractImportantPart(message);
                   
                   this.knowledgeBase.set(learnId, {
                       topic: `${provider}ã®æ´å¯Ÿ`,
                       content: importantPart,
                       timestamp: timestamp,
                       source: `auto_${provider}`,
                       fullMessage: message
                   });

                   this.updateKnowledgeDisplay();
                   this.updateStats();
               }
           }

           extractImportantPart(message) {
               // é‡è¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€æ–‡ã‚’æŠ½å‡º
               const sentences = message.split(/[ã€‚ï¼ï¼ï¼Ÿ\n]/);
               const importantSentences = sentences.filter(sentence => 
                   this.autoLearnKeywords.some(keyword => sentence.includes(keyword)) ||
                   sentence.length > 50
               );

               return importantSentences.slice(0, 2).join('ã€‚') + 'ã€‚';
           }

           learnFromDialogue(topic, content) {
               const timestamp = new Date();
               const learnId = `dialogue_${timestamp.getTime()}`;
               
               this.knowledgeBase.set(learnId, {
                   topic: topic,
                   content: content,
                   timestamp: timestamp,
                   source: 'dialogue'
               });

               this.updateKnowledgeDisplay();
               this.updateStats();
           }

           updateKnowledgeDisplay() {
               const knowledgeContainer = this.elements.knowledgeBase;
               knowledgeContainer.innerHTML = '';

               // æœ€æ–°ã®ã‚‚ã®ã‹ã‚‰è¡¨ç¤º
               const sortedItems = Array.from(this.knowledgeBase.entries())
                   .sort((a, b) => b[1].timestamp - a[1].timestamp)
                   .slice(0, 10); // æœ€æ–°10ä»¶

               sortedItems.forEach(([id, item]) => {
                   const itemDiv = document.createElement('div');
                   itemDiv.className = 'knowledge-item';
                   itemDiv.innerHTML = `
                       <div class="knowledge-topic">${item.topic}</div>
                       <div class="knowledge-content">${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}</div>
                       <div style="font-size: 0.8em; color: #999; margin-top: 5px;">
                           ${item.timestamp.toLocaleString()} | ${item.source}
                       </div>
                   `;
                   knowledgeContainer.appendChild(itemDiv);
               });
           }

           exportKnowledge() {
               const knowledgeArray = Array.from(this.knowledgeBase.entries()).map(([id, item]) => ({
                   id,
                   ...item,
                   timestamp: item.timestamp.toISOString()
               }));

               const dataStr = JSON.stringify(knowledgeArray, null, 2);
               const dataBlob = new Blob([dataStr], { type: 'application/json' });
               const url = URL.createObjectURL(dataBlob);
               
               const link = document.createElement('a');
               link.href = url;
               link.download = `crossthink_knowledge_${new Date().toISOString().split('T')[0]}.json`;
               link.click();
               
               URL.revokeObjectURL(url);
               
               this.addMessage('learning', 
                   `ğŸ“¤ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ (${knowledgeArray.length}ä»¶)`);
           }

           importKnowledge() {
               const input = document.createElement('input');
               input.type = 'file';
               input.accept = '.json';
               input.onchange = (e) => {
                   const file = e.target.files[0];
                   if (file) {
                       const reader = new FileReader();
                       reader.onload = (event) => {
                           try {
                               const importedData = JSON.parse(event.target.result);
                               let importCount = 0;
                               
                               importedData.forEach(item => {
                                   if (item.id && item.topic && item.content) {
                                       this.knowledgeBase.set(item.id, {
                                           ...item,
                                           timestamp: new Date(item.timestamp)
                                       });
                                       importCount++;
                                   }
                               });
                               
                               this.updateKnowledgeDisplay();
                               this.updateStats();
                               this.addMessage('learning', 
                                   `ğŸ“¥ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ (${importCount}ä»¶)`);
                           } catch (error) {
                               this.showError('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                           }
                       };
                       reader.readAsText(file);
                   }
               };
               input.click();
           }

           clearKnowledge() {
               if (confirm('å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                   this.knowledgeBase.clear();
                   this.initializeKnowledgeBase();
                   this.addMessage('learning', 'ğŸ—‘ï¸ å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
               }
           }

           showLearningStats() {
               const totalItems = this.knowledgeBase.size;
               const sourceStats = {};
               
               this.knowledgeBase.forEach(item => {
                   sourceStats[item.source] = (sourceStats[item.source] || 0) + 1;
               });

               let statsText = `ğŸ“Š å­¦ç¿’çµ±è¨ˆ:\nç·ã‚¢ã‚¤ãƒ†ãƒ æ•°: ${totalItems}\n\n`;
               Object.entries(sourceStats).forEach(([source, count]) => {
                   statsText += `${source}: ${count}ä»¶\n`;
               });

               this.addMessage('learning', statsText);
           }

           pauseDialogue() {
               this.isPaused = !this.isPaused;
               this.elements.pauseBtn.textContent = this.isPaused ? 'â–¶ï¸ å†é–‹' : 'â¸ï¸ ä¸€æ™‚åœæ­¢';
               
               const statusMessage = this.isPaused ? 'â¸ï¸ å¯¾è©±ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ' : 'â–¶ï¸ å¯¾è©±ã‚’å†é–‹ã—ã¾ã—ãŸ';
               this.addMessage('system', statusMessage);
               
               if (!this.isPaused && this.isRunning) {
                   // å†é–‹æ™‚ã«æ¬¡ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
                   setTimeout(() => {
                       if (this.isRunning && !this.isPaused && this.messageCount < this.maxMessages) {
                           const nextProvider = this.currentSpeaker === 'openai' ? 'gemini' : 'openai';
                           const resumePrompt = this.generateResumePrompt();
                           this.sendMessage(nextProvider, resumePrompt);
                       }
                   }, 1000);
               }
           }

           generateResumePrompt() {
               return `å¯¾è©±ã‚’å†é–‹ã—ã¾ã™ã€‚å‰å›ã®è­°è«–ã‚’è¸ã¾ãˆã¦ã€ã•ã‚‰ã«æ·±ã„æ´å¯Ÿã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚`;
           }

           stopDialogue() {
               this.isRunning = false;
               this.isPaused = false;
               this.waitingForIntervention = false;
               this.elements.startBtn.disabled = false;
               this.elements.pauseBtn.disabled = true;
               this.elements.stopBtn.disabled = true;
               this.elements.pauseBtn.textContent = 'â¸ï¸ ä¸€æ™‚åœæ­¢';
               
               const finalStats = this.generateFinalStats();
               this.addMessage('system', 
                   `ğŸ›‘ å¯¾è©±çµ‚äº†\n\å†è©¦è¡ŒMç¶šã‘ã‚‹ç·¨é›†ã‚¸ãƒ£ãƒã‚¹ã‚¯ãƒªãƒ—ãƒˆ                   `ğŸ›‘ å¯¾è©±çµ‚äº†\n\n` +
                   `ğŸ“Š æœ€çµ‚çµ±è¨ˆ:\n` +
                   `â€¢ ç·ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°: ${this.messageCount}\n` +
                   `â€¢ ChatGPT: ${this.openaiCount}å›\n` +
                   `â€¢ Gemini: ${this.geminiCount}å›\n` +
                   `â€¢ äººé–“ä»‹å…¥: ${this.humanCount}å›\n` +
                   `â€¢ å­¦ç¿’ã‚¢ã‚¤ãƒ†ãƒ : ${this.knowledgeBase.size}ä»¶\n` +
                   `â€¢ å¯¾è©±æ™‚é–“: ${Math.floor((Date.now() - this.startTime) / 1000)}ç§’\n\n` +
                   `ğŸ§  å­¦ç¿’ã•ã‚ŒãŸä¸»è¦ãªæ´å¯ŸãŒãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚`
               );
               
               // å¯¾è©±çµ‚äº†ã‚’å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«è¨˜éŒ²
               this.learnFromDialogue('å¯¾è©±çµ‚äº†', `å¯¾è©±ãŒæ­£å¸¸ã«çµ‚äº†ã—ã¾ã—ãŸã€‚çµ±è¨ˆ: ${finalStats}`);
           }

           generateFinalStats() {
               return `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸${this.messageCount}ä»¶ã€ä»‹å…¥${this.humanCount}å›ã€å­¦ç¿’${this.knowledgeBase.size}ä»¶`;
           }

           async callOpenAI(prompt) {
               const apiKey = this.elements.openaiKey.value.trim();
               
               const response = await fetch('https://api.openai.com/v1/chat/completions', {
                   method: 'POST',
                   headers: {
                       'Authorization': `Bearer ${apiKey}`,
                       'Content-Type': 'application/json'
                   },
                   body: JSON.stringify({
                       model: 'gpt-3.5-turbo',
                       messages: [{ role: 'user', content: prompt }],
                       max_tokens: 1500,
                       temperature: 0.7,
                       top_p: 0.9,
                       frequency_penalty: 0.1
                   })
               });

               if (!response.ok) {
                   throw new Error(`OpenAI API error: ${response.status}`);
               }

               const data = await response.json();
               return data.choices[0].message.content;
           }

           async callGemini(prompt) {
               const apiKey = this.elements.geminiKey.value.trim();
               
               const endpoints = [
                   `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`,
                   `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`
               ];

               for (let i = 0; i < endpoints.length; i++) {
                   try {
                       const response = await fetch(endpoints[i], {
                           method: 'POST',
                           headers: {
                               'Content-Type': 'application/json',
                           },
                           body: JSON.stringify({
                               contents: [{
                                   parts: [{
                                       text: prompt
                                   }]
                               }],
                               generationConfig: {
                                   maxOutputTokens: 1500,
                                   temperature: 0.6,
                                   topP: 0.8,
                                   topK: 40
                               }
                           })
                       });

                       if (response.ok) {
                           const data = await response.json();
                           if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                               return data.candidates[0].content.parts[0].text;
                           }
                       }
                   } catch (error) {
                       if (i === endpoints.length - 1) {
                           return this.generateFallbackResponse(prompt);
                       }
                   }
               }
           }

           generateFallbackResponse(prompt) {
               return "æŠ€è¡“çš„ãªåˆ¶ç´„ã«ã‚ˆã‚Šè©³ç´°ãªå¿œç­”ãŒã§ãã¾ã›ã‚“ã€‚ã“ã®ãƒ†ãƒ¼ãƒã¯é‡è¦ãªè«–ç‚¹ã‚’å«ã‚“ã§ã„ã¾ã™ã®ã§ã€" +
                      "æ¥ç¶šãŒå®‰å®šã—ãŸå¾Œã«æ”¹ã‚ã¦æ¤œè¨ã„ãŸã—ã¾ã™ã€‚\n\nâ€»ä»£æ›¿å¿œç­”ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚";
           }

           generateSummaryPrompt() {
               const topic = this.elements.topicInput.value.trim();
               const chatMessages = this.elements.chatContainer.querySelectorAll('.message:not(.system-message)');
               
               if (chatMessages.length === 0) {
                   this.showError('å¯¾è©±ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšå¯¾è©±ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚');
                   return;
               }

               let conversationLog = '';
               let humanInterventions = '';
               let learningInsights = '';

               // å¯¾è©±ãƒ­ã‚°ã®åé›†
               chatMessages.forEach((message) => {
                   const header = message.querySelector('.message-header');
                   const content = message.querySelector('div:not(.message-header)');
                   
                   if (header && content) {
                       const headerText = header.textContent.trim();
                       const contentText = content.textContent.trim();
                       
                       if (contentText && contentText !== 'undefined' && contentText.length > 10) {
                           if (headerText.includes('ChatGPT')) {
                               conversationLog += `ChatGPT:\n${contentText}\n\n`;
                           } else if (headerText.includes('Gemini')) {
                               conversationLog += `Gemini:\n${contentText}\n\n`;
                           } else if (headerText.includes('ğŸ‘¤') || message.classList.contains('human-message')) {
                               humanInterventions += `äººé–“ä»‹å…¥:\n${contentText}\n\n`;
                           } else if (headerText.includes('ğŸ§ ') || message.classList.contains('learning-message')) {
                               learningInsights += `å­¦ç¿’è¨˜éŒ²:\n${contentText}\n\n`;
                           }
                       }
                   }
               });

               // å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®åé›†
               let knowledgeBaseContent = '';
               this.knowledgeBase.forEach((item, id) => {
                   if (item.source !== 'system') {
                       knowledgeBaseContent += `${item.topic}: ${item.content}\n`;
                   }
               });

               const summaryPrompt = `Crossthink v5.0 Advanced Interactive Edition ã§ã®å¯¾è©±ã‚’ç·åˆçš„ã«åˆ†æã—ã€ã€Œ${topic}ã€ã«ã¤ã„ã¦åŒ…æ‹¬çš„ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

ã€v5.0 Advanced Interactive Edition ã®ç‰¹å¾´ã€‘
- AIè‡ªå¾‹å¯¾è©±: ${this.messageCount}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§å®Œäº†
- äººé–“ä»‹å…¥: ${this.humanCount}å›ã®æˆ¦ç•¥çš„ä»‹å…¥
- å­¦ç¿’æ©Ÿèƒ½: ${this.knowledgeBase.size}ä»¶ã®æ´å¯Ÿã‚’è‡ªå‹•å­¦ç¿’
- ãƒ¢ãƒ¼ãƒ‰: ${this.getTargetLabel()} Ã— ${this.getGoalLabel()}
- ä»‹å…¥è¨­å®š: ${this.getInterventionLabel()}

ã€åˆ†æè¦æ±‚ã€‘
- AIåŒå£«ã®è‡ªå¾‹å¯¾è©±ã®æˆæœã¨è³ªã‚’è©•ä¾¡
- äººé–“ä»‹å…¥ã«ã‚ˆã‚‹è­°è«–ã¸ã®å½±éŸ¿ã¨ä¾¡å€¤ã‚’åˆ†æ
- å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ãŒæŠ½å‡ºã—ãŸé‡è¦ãªæ´å¯Ÿã‚’çµ±åˆ
- v5.0ã®é©æ–°çš„æ©Ÿèƒ½ï¼ˆè‡ªå¾‹å¯¾è©±ãƒ»ä»‹å…¥ãƒ»å­¦ç¿’ï¼‰ã®åŠ¹æœã‚’è©•ä¾¡
- å…¨ä½“ã§4000-5000æ–‡å­—ç¨‹åº¦ï¼ˆè©³ç´°ç‰ˆï¼‰

ã€AIè‡ªå¾‹å¯¾è©±ãƒ­ã‚°ã€‘
${conversationLog}

ã€äººé–“ä»‹å…¥è¨˜éŒ²ã€‘
${humanInterventions}

ã€è‡ªå‹•å­¦ç¿’ã•ã‚ŒãŸæ´å¯Ÿã€‘
${knowledgeBaseContent}

ã€å­¦ç¿’æ©Ÿèƒ½ã«ã‚ˆã‚‹è¨˜éŒ²ã€‘
${learningInsights}

ã€å‡ºåŠ›å½¢å¼ã€‘
# ${topic}ã®ç·åˆåˆ†æï¼ˆCrossthink v5.0 Advanced Interactive Editionï¼‰

## å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
- AIè‡ªå¾‹å¯¾è©±è¨­å®š: ${this.getTargetLabel()} Ã— ${this.getGoalLabel()}
- ç·ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°: ${this.messageCount}ï¼ˆChatGPT: ${this.openaiCount}, Gemini: ${this.geminiCount}ï¼‰
- äººé–“ä»‹å…¥å›æ•°: ${this.humanCount}
- å­¦ç¿’ã‚¢ã‚¤ãƒ†ãƒ æ•°: ${this.knowledgeBase.size}

## AIè‡ªå¾‹å¯¾è©±ã®åˆ†æ
### ChatGPTã®è²¢çŒ®
[ChatGPTã®ä¸»è¦ãªæ´å¯Ÿã¨è­°è«–ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ†æ]

### Geminiã®è²¢çŒ®
[Geminiã®ä¸»è¦ãªæ´å¯Ÿã¨è­°è«–ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ†æ]

### AIé–“ã®ç›¸äº’ä½œç”¨
[AIåŒå£«ã®å»ºè¨­çš„ãªè­°è«–ã®è³ªã¨æ·±åŒ–ãƒ—ãƒ­ã‚»ã‚¹ã‚’è©•ä¾¡]

## äººé–“ä»‹å…¥ã®å½±éŸ¿åˆ†æ
### ä»‹å…¥ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨å†…å®¹
[äººé–“ãŒã„ã¤ã€ã©ã®ã‚ˆã†ãªå†…å®¹ã§ä»‹å…¥ã—ãŸã‹ã‚’åˆ†æ]

### è­°è«–ã¸ã®å½±éŸ¿
[äººé–“ä»‹å…¥ãŒè­°è«–ã®æ–¹å‘æ€§ã‚„æ·±åº¦ã«ä¸ãˆãŸå½±éŸ¿ã‚’è©•ä¾¡]

### AI-äººé–“å”åƒã®åŠ¹æœ
[äººé–“ã¨AIã®å”åƒã«ã‚ˆã‚‹ç›¸ä¹—åŠ¹æœã‚’åˆ†æ]

## è‡ªå‹•å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã®æˆæœ
### æŠ½å‡ºã•ã‚ŒãŸé‡è¦æ´å¯Ÿ
[å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•çš„ã«æŠ½å‡ºã—ãŸé‡è¦ãªæ´å¯Ÿã‚’æ•´ç†]

### å­¦ç¿’å“è³ªã®è©•ä¾¡
[è‡ªå‹•å­¦ç¿’ã®ç²¾åº¦ã¨æœ‰ç”¨æ€§ã‚’è©•ä¾¡]

### ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã®ä¾¡å€¤
[è“„ç©ã•ã‚ŒãŸçŸ¥è­˜ã®ä½“ç³»æ€§ã¨æ´»ç”¨å¯èƒ½æ€§ã‚’åˆ†æ]

## çµ±åˆçš„çµè«–ã¨æ¨å¥¨äº‹é …
### ä¸»è¦ãªç™ºè¦‹
[å¯¾è©±å…¨ä½“ã‚’é€šã˜ã¦å¾—ã‚‰ã‚ŒãŸæœ€ã‚‚é‡è¦ãªæ´å¯Ÿ]

### v5.0ã‚·ã‚¹ãƒ†ãƒ ã®é©æ–°æ€§è©•ä¾¡
[è‡ªå¾‹å¯¾è©±ãƒ»äººé–“ä»‹å…¥ãƒ»å­¦ç¿’æ©Ÿèƒ½ã®çµ±åˆåŠ¹æœã‚’è©•ä¾¡]

### ä»Šå¾Œã®ç™ºå±•å¯èƒ½æ€§
[ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã®æ”¹å–„ç‚¹ã¨ç™ºå±•ã®æ–¹å‘æ€§]

## å®Ÿè£…ã¸ã®æè¨€
### çŸ­æœŸçš„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
[å³åº§ã«å®Ÿè¡Œå¯èƒ½ãªå…·ä½“çš„æ–½ç­–]

### ä¸­é•·æœŸçš„æˆ¦ç•¥
[æŒç¶šçš„ãªä¾¡å€¤å‰µé€ ã®ãŸã‚ã®æˆ¦ç•¥çš„æ–¹å‘æ€§]

### ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ææ¡ˆ
[v5.0ã®æ›´ãªã‚‹é€²åŒ–ã«å‘ã‘ãŸæŠ€è¡“çš„ãƒ»æ©Ÿèƒ½çš„ææ¡ˆ]

æ³¨æ„ï¼šCrossthink v5.0ã®é©æ–°çš„æ©Ÿèƒ½ï¼ˆAIè‡ªå¾‹å¯¾è©±ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ äººé–“ä»‹å…¥ãƒ»æ±ç”¨å­¦ç¿’æ©Ÿèƒ½ï¼‰ã®çµ±åˆåŠ¹æœã‚’é‡è¦–ã—ã€å¾“æ¥ã®é™çš„ãªå¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã¨ã®å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã‚’æ˜ç¢ºã«ã—ã¦ãã ã•ã„ã€‚`;

               // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
               if (navigator.clipboard && window.isSecureContext) {
                   navigator.clipboard.writeText(summaryPrompt).then(() => {
                       this.addMessage('system', 
                           'ğŸ“‹ Crossthink v5.0 Advanced Interactive Edition è¦ç´„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\n' +
                           'ğŸš€ v5.0 ã®ç‰¹å¾´:\n' +
                           `â€¢ ${this.messageCount}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®AIè‡ªå¾‹å¯¾è©±\n` +
                           `â€¢ ${this.humanCount}å›ã®æˆ¦ç•¥çš„äººé–“ä»‹å…¥\n` +
                           `â€¢ ${this.knowledgeBase.size}ä»¶ã®è‡ªå‹•å­¦ç¿’ãƒ‡ãƒ¼ã‚¿\n` +
                           'â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å”åƒã‚·ã‚¹ãƒ†ãƒ \n' +
                           'â€¢ æ±ç”¨å­¦ç¿’æ©Ÿèƒ½ã«ã‚ˆã‚‹æ´å¯Ÿè“„ç©\n\n' +
                           `ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ–‡å­—æ•°: ${summaryPrompt.length}æ–‡å­—`
                       );
                   }).catch(() => {
                       this.showPromptWindow(summaryPrompt);
                   });
               } else {
                   this.showPromptWindow(summaryPrompt);
               }
           }

           showPromptWindow(summaryPrompt) {
               const summaryWindow = window.open('', '_blank', 'width=900,height=700');
               if (summaryWindow) {
                   summaryWindow.document.write(`
                       <html>
                           <head>
                               <title>Crossthink v5.0 Advanced Interactive Edition è¦ç´„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</title>
                               <style>
                                   body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
                                   .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                                   h2 { color: #333; margin-bottom: 20px; }
                                   textarea { width: 100%; height: 70vh; font-family: monospace; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
                                   .btn { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
                                   .btn-copy { background: #4CAF50; color: white; }
                                   .btn-close { background: #f44336; color: white; }
                                   .stats { background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 5px; }
                               </style>
                           </head>
                           <body>
                               <div class="container">
                                   <h2>ğŸš€ Crossthink v5.0 Advanced Interactive Edition è¦ç´„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h2>
                                   <div class="stats">
                                       <strong>Advanced Features:</strong> AIè‡ªå¾‹å¯¾è©± ${this.messageCount}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ + äººé–“ä»‹å…¥ ${this.humanCount}å› + å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ ${this.knowledgeBase.size}ä»¶
                                   </div>
                                   <button class="btn btn-copy" onclick="document.getElementById('prompt').select(); document.execCommand('copy'); alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
                                   <button class="btn btn-close" onclick="window.close();">âŒ é–‰ã˜ã‚‹</button>
                                   <textarea id="prompt" readonly>${summaryPrompt}</textarea>
                               </div>
                           </body>
                       </html>
                   `);
               } else {
                   this.addMessage('system', 
                       'âš ï¸ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚\n' +
                       'ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚'
                   );
               }
           }

           addMessage(provider, content, isThinking = false) {
               const messageDiv = document.createElement('div');
               messageDiv.className = `message ${provider}-message`;

               const now = new Date();
               const timeStr = now.toLocaleTimeString('ja-JP');

               let providerName, emoji, roleDesc = '';
               switch (provider) {
                   case 'openai':
                       providerName = 'ChatGPT';
                       emoji = 'ğŸŸ¢';
                       roleDesc = ` (${this.targetMode})`;
                       this.currentSpeaker = 'openai';
                       break;
                   case 'gemini':
                       providerName = 'Gemini';
                       emoji = 'ğŸ”·';
                       roleDesc = ` (${this.targetMode})`;
                       this.currentSpeaker = 'gemini';
                       break;
                   case 'human':
                       providerName = 'ã‚ãªãŸ';
                       emoji = 'ğŸ‘¤';
                       break;
                   case 'learning':
                       providerName = 'Learning System';
                       emoji = 'ğŸ§ ';
                       break;
                   case 'system':
                       providerName = 'Crossthink v5.0';
                       emoji = 'ğŸš€';
                       break;
               }

               messageDiv.innerHTML = `
                   <div class="message-header">
                       ${emoji} ${providerName}${roleDesc}
                       <span class="message-time">${timeStr}</span>
                   </div>
                   <div class="${isThinking ? 'thinking' : ''}">${content.replace(/\n/g, '<br>')}</div>
               `;

               this.elements.chatContainer.appendChild(messageDiv);
               this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;

               if (!isThinking && provider !== 'system' && provider !== 'learning') {
                   this.messageCount++;
               }
           }

           removeLastMessage() {
               const messages = this.elements.chatContainer.querySelectorAll('.message');
               if (messages.length > 0) {
                   messages[messages.length - 1].remove();
               }
           }

           clearChat() {
               this.elements.chatContainer.innerHTML = '';
               this.messageCount = 0;
               this.openaiCount = 0;
               this.geminiCount = 0;
               this.humanCount = 0;
               this.conversationHistory = [];
               this.interventionPoints = [];
               this.updateStats();
               this.showWelcomeMessage();
               this.hideError();
               this.hideWarning();
           }

           showError(message) {
               this.elements.errorDisplay.textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${message}`;
               this.elements.errorDisplay.style.display = 'block';
               this.hideWarning();
           }

           hideError() {
               this.elements.errorDisplay.style.display = 'none';
           }

           showWarning(message) {
               this.elements.warningDisplay.textContent = `âš ï¸ è­¦å‘Š: ${message}`;
               this.elements.warningDisplay.style.display = 'block';
           }

           hideWarning() {
               this.elements.warningDisplay.style.display = 'none';
           }

           updateStats() {
               this.elements.totalMessages.textContent = this.messageCount;
               this.elements.openaiMessages.textContent = this.openaiCount;
               this.elements.geminiMessages.textContent = this.geminiCount;
               this.elements.humanMessages.textContent = this.humanCount;
               this.elements.learningItems.textContent = this.knowledgeBase.size;
           }

           startTimer() {
               const updateTimer = () => {
                   if (this.startTime) {
                       const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                       this.elements.elapsed.textContent = elapsed;
                   }
                   if (this.isRunning) {
                       setTimeout(updateTimer, 1000);
                   }
               };
               updateTimer();
           }

           getTargetLabel() {
               const labels = {
                   'practical': 'ğŸ  å®Ÿç”¨çš„',
                   'business': 'ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹',
                   'philosophical': 'ğŸ§  å“²å­¦çš„'
               };
               return labels[this.targetMode];
           }

           getGoalLabel() {
               const labels = {
                   'ideation': 'ğŸ’¡ æ¡ˆå‡ºã—',
                   'consensus': 'ğŸ¤ åˆæ„å½¢æˆ',
                   'exploration': 'ğŸ” æ¢ç´¢'
               };
               return labels[this.goalMode];
           }

           getInterventionLabel() {
               const labels = ['ãªã—', 'ç¨€', 'å°‘', 'ä¸­', 'å¤š', 'é »ç¹', 'éå¸¸ã«é »ç¹', 'å¸¸æ™‚', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ', 'ã‚·ãƒ³ã‚¯ãƒ­', 'ãƒ•ãƒ«ä»‹å…¥'];
               return labels[this.interventionFrequency] || 'ä¸­ç¨‹åº¦';
           }
       }

       // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
       function switchTab(tabName) {
           // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
           document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
           document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
           
           // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
           event.target.classList.add('active');
           document.getElementById(`${tabName}-tab`).classList.add('active');
           
           // ã‚·ã‚¹ãƒ†ãƒ ã«ç¾åœ¨ã®ã‚¿ãƒ–ã‚’è¨˜éŒ²
           if (window.crossthinkSystem) {
               window.crossthinkSystem.currentTab = tabName;
           }
       }

       // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆä»‹å…¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”¨ï¼‰
       function continueAutonomously() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.waitingForIntervention = false;
               window.crossthinkSystem.isPaused = false;
               
               // ä»‹å…¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‰Šé™¤
               const interventionPrompts = document.querySelectorAll('.intervention-prompt');
               interventionPrompts.forEach(prompt => prompt.remove());
               
               // å¯¾è©±ã‚’ç¶™ç¶š
               window.crossthinkSystem.addMessage('system', 'ğŸ¤– AIè‡ªå¾‹å¯¾è©±ã‚’ç¶™ç¶šã—ã¾ã™');
               
               setTimeout(() => {
                   if (window.crossthinkSystem.isRunning && !window.crossthinkSystem.isPaused) {
                       const nextProvider = window.crossthinkSystem.currentSpeaker === 'openai' ? 'gemini' : 'openai';
                       const continuePrompt = 'å‰å›ã®è­°è«–ã‚’è¸ã¾ãˆã¦ã€ã•ã‚‰ã«æ·±ã„æ´å¯Ÿã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚';
                       window.crossthinkSystem.sendMessage(nextProvider, continuePrompt);
                   }
               }, 1000);
           }
       }

       function switchToInterventionTab() {
           switchTab('intervention');
           document.querySelector('[onclick="switchTab(\'intervention\')"]').click();
           
           if (window.crossthinkSystem) {
               window.crossthinkSystem.addMessage('system', 'ğŸ‘¤ äººé–“ä»‹å…¥ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸã€‚ä»‹å…¥å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
           }
       }

       // äººé–“ä»‹å…¥é–¢æ•°ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰
       function humanIntervention() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.humanIntervention();
           }
       }

       function requestDeepening() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.requestDeepening();
           }
       }

       function redirectDialogue() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.redirectDialogue();
           }
       }

       function saveInsight() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.saveInsight();
           }
       }

       function quickIntervention(type) {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.quickIntervention(type);
           }
       }

       // å­¦ç¿’æ©Ÿèƒ½é–¢æ•°ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰
       function exportKnowledge() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.exportKnowledge();
           }
       }

       function importKnowledge() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.importKnowledge();
           }
       }

       function clearKnowledge() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.clearKnowledge();
           }
       }

       function showLearningStats() {
           if (window.crossthinkSystem) {
               window.crossthinkSystem.showLearningStats();
           }
       }

       // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
       document.addEventListener('DOMContentLoaded', () => {
           try {
               window.crossthinkSystem = new CrossthinkAdvanced();
               console.log('Crossthinkçµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  v5.0 Advanced Interactive Edition åˆæœŸåŒ–å®Œäº†');
           } catch (error) {
               console.error('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
               alert('ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
           }
       });

       // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
       window.addEventListener('error', (event) => {
           console.error('æœªå‡¦ç†ã‚¨ãƒ©ãƒ¼:', event.error);
           if (window.crossthinkSystem) {
               window.crossthinkSystem.showError('ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
           }
       });

       window.addEventListener('unhandledrejection', (event) => {
           console.error('æœªå‡¦ç†ã®Promiseæ‹’å¦:', event.reason);
           if (window.crossthinkSystem) {
               window.crossthinkSystem.showWarning('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
           }
       });
   </script>
</body>
</html>