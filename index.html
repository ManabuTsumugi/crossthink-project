<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† - AIÂØæË©±„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .demo-label {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin-top: 15px;
            font-weight: bold;
        }

        /* Êñ∞Ê©üËÉΩ: „É¢„Éº„ÉâÈÅ∏Êäû„Çª„ÇØ„Ç∑„Éß„É≥ */
        .mode-selection {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .quick-access {
            margin-bottom: 30px;
        }

        .quick-access h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
        }

        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .quick-btn {
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .mode-selector {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .mode-selector h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .mode-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .mode-slider {
            flex: 1;
            margin: 0 20px;
            position: relative;
        }

        .slider-track {
            height: 8px;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48cae4);
            border-radius: 4px;
            position: relative;
        }

        .slider-thumb {
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 50%;
            position: absolute;
            top: -6px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .slider-thumb:hover {
            transform: scale(1.2);
        }

        .mode-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .selected-mode {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            border-left: 4px solid #2196f3;
        }

        .config-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .api-config {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .api-config h3 {
            margin-bottom: 10px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .openai-config h3::before {
            content: "üü¢";
            font-size: 1.2em;
        }

        .gemini-config h3::before {
            content: "üî∑";
            font-size: 1.2em;
        }

        .api-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .api-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .topic-section {
            padding: 20px 30px;
        }

        .topic-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa500 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .stats-section {
            padding: 20px 30px;
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .openai-stat .stat-number { color: #10a37f; }
        .gemini-stat .stat-number { color: #4285f4; }

        .error-display, .warning-display {
            padding: 15px;
            margin: 20px 30px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .error-display {
            background: #ff6b6b;
            color: white;
        }

        .warning-display {
            background: #ffa500;
            color: white;
        }

        .chat-container {
            padding: 30px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .message-time {
            margin-left: auto;
            font-size: 0.8em;
            opacity: 0.7;
        }

        .system-message {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border-left: 5px solid #fdcb6e;
        }

        .openai-message {
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
            border-left: 5px solid #10a37f;
        }

        .gemini-message {
            background: linear-gradient(135deg, #b3d9ff 0%, #d4edda 100%);
            border-left: 5px solid #4285f4;
        }

        .thinking {
            font-style: italic;
            opacity: 0.8;
            color: #666;
        }

        .monetization-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: 20px 30px;
            border-radius: 15px;
        }

        .monetization-info h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .monetization-info ul {
            list-style: none;
            padding: 0;
        }

        .monetization-info li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }

        .monetization-info li::before {
            content: "üí∞";
            position: absolute;
            left: 0;
        }

        @media (max-width: 768px) {
            .config-grid, .quick-buttons {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }

            .mode-row {
                flex-direction: column;
                gap: 10px;
            }

            .mode-slider {
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†</h1>
            <p>AIÂçîÂÉç„Å´„Çà„ÇãÊÄùËÄÉ„ÅÆÊòüÂ∫ß - ÂÆüÁî®„Åã„ÇâÂì≤Â≠¶„Åæ„Åß</p>
            <div class="demo-label">
                üöÄ Áµ±ÂêàÁâà v3.0 - ÂÖ®„É¢„Éº„ÉâÂØæÂøú
            </div>
        </div>

        <!-- Êñ∞Ê©üËÉΩ: „É¢„Éº„ÉâÈÅ∏Êäû„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="mode-selection">
            <div class="quick-access">
                <h3>üöÄ „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Çª„ÇπÔºà„Çà„Åè‰Ωø„ÅÜÂØæË©±Ôºâ</h3>
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="startQuickDialogue('‰ªäÊó•„ÅÆÊô©Âæ°È£Ø')">
                        üçΩÔ∏è ‰ªäÊó•„ÅÆÊô©Âæ°È£Ø
                        <br><small>ÂÆüÁî®ÁöÑ„ÉªÂêàÊÑèÂΩ¢Êàê„É¢„Éº„Éâ</small>
                    </button>
                    <button class="quick-btn" onclick="startQuickDialogue('‰ªï‰∫ã„ÅÆÁõ∏Ë´á')">
                        üíº ‰ªï‰∫ã„ÅÆÁõ∏Ë´á
                        <br><small>„Éì„Ç∏„Éç„Çπ„ÉªÊ°àÂá∫„Åó„É¢„Éº„Éâ</small>
                    </button>
                    <button class="quick-btn" onclick="startQuickDialogue('Ë≤∑„ÅÑÁâ©„É™„Çπ„Éà')">
                        üõí Ë≤∑„ÅÑÁâ©„É™„Çπ„Éà
                        <br><small>ÂÆüÁî®ÁöÑ„ÉªÂêàÊÑèÂΩ¢Êàê„É¢„Éº„Éâ</small>
                    </button>
                    <button class="quick-btn" onclick="startQuickDialogue('‰∫∫Áîü„Å´„Å§„ÅÑ„Å¶')">
                        ü§î ‰∫∫Áîü„Å´„Å§„ÅÑ„Å¶
                        <br><small>Âì≤Â≠¶ÁöÑ„ÉªÊé¢Á¥¢„É¢„Éº„Éâ</small>
                    </button>
                </div>
            </div>

            <div class="mode-selector">
                <h3>üéØ „Ç´„Çπ„Çø„É†ÂØæË©±Ë®≠ÂÆö</h3>
                
                <div class="mode-row">
                    <span><strong>„Å©„Çì„Å™ÂØæË©±Ôºü</strong></span>
                    <div class="mode-slider">
                        <div class="slider-track">
                            <div class="slider-thumb" id="targetSlider" style="left: 33%;"></div>
                        </div>
                        <div class="mode-labels">
                            <span>üè† ÂÆüÁî®ÁöÑ</span>
                            <span>üíº „Éì„Ç∏„Éç„Çπ</span>
                            <span>üß† Âì≤Â≠¶ÁöÑ</span>
                        </div>
                    </div>
                </div>

                <div class="mode-row">
                    <span><strong>‰Ωï„ÅåÁõÆÊ®ôÔºü</strong></span>
                    <div class="mode-slider">
                        <div class="slider-track">
                            <div class="slider-thumb" id="goalSlider" style="left: 50%;"></div>
                        </div>
                        <div class="mode-labels">
                            <span>üí° Ê°àÂá∫„Åó</span>
                            <span>ü§ù ÂêàÊÑèÂΩ¢Êàê</span>
                            <span>üîç Êé¢Á¥¢</span>
                        </div>
                    </div>
                </div>

                <div class="selected-mode" id="selectedMode">
                    üéØ ÈÅ∏Êäû‰∏≠: ÂÆüÁî®ÁöÑ √ó ÂêàÊÑèÂΩ¢Êàê„É¢„Éº„Éâ
                </div>
            </div>
        </div>

        <div class="config-section">
            <h2>üîß APIË®≠ÂÆö</h2>
            <div class="config-grid">
                <div class="api-config openai-config">
                    <h3>OpenAI API Key:</h3>
                    <input type="password" id="openaiKey" class="api-input" placeholder="sk-proj-...">
                </div>
                <div class="api-config gemini-config">
                    <h3>Gemini API Key:</h3>
                    <input type="password" id="geminiKey" class="api-input" placeholder="AIza...">
                </div>
            </div>
        </div>

        <div class="topic-section">
            <h2>üìù ÂØæË©±„Éà„Éî„ÉÉ„ÇØ:</h2>
            <input type="text" id="topicInput" class="topic-input" 
                   placeholder="Ëá™Áî±„Å´„Éà„Éî„ÉÉ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" 
                   value="">
            
            <div class="controls">
                <button id="startBtn" class="btn btn-primary">üöÄ ÂØæË©±ÈñãÂßã</button>
                <button id="stopBtn" class="btn btn-danger" disabled>‚èπÔ∏è ÂÅúÊ≠¢</button>
                <button id="clearBtn" class="btn btn-secondary">üóëÔ∏è „ÇØ„É™„Ç¢</button>
                <button id="exportBtn" class="btn btn-secondary">üìù Ë¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„ÉàÁîüÊàê</button>
            </div>
        </div>

        <div class="stats-section">
            <h2>üìä ÂØæË©±Áµ±Ë®à</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">Á∑è„É°„ÉÉ„Çª„Éº„Ç∏Êï∞</div>
                </div>
                <div class="stat-card openai-stat">
                    <div class="stat-number" id="openaiMessages">0</div>
                    <div class="stat-label">ChatGPTÁô∫Ë®Ä</div>
                </div>
                <div class="stat-card gemini-stat">
                    <div class="stat-number" id="geminiMessages">0</div>
                    <div class="stat-label">GeminiÁô∫Ë®Ä</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="elapsed">0</div>
                    <div class="stat-label">ÁµåÈÅéÊôÇÈñì(Áßí)</div>
                </div>
            </div>
        </div>

        <div class="error-display" id="errorDisplay"></div>
        <div class="warning-display" id="warningDisplay"></div>

        <div class="monetization-info">
            <h3>üåü Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„ÅÆÁâπÂæ¥:</h3>
            <ul>
                <li>Áµ±‰∏Ä„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£: 1„Å§„ÅÆ„Ç¢„Éó„É™„ÅßÂÖ®„É¢„Éº„ÉâÂØæÂøú</li>
                <li>ÈÅ©ÂøúÂûãAI: ÊñáËÑà„Å´Âøú„Åò„ÅüÊúÄÈÅ©„Å™ÂØæË©±„Çπ„Çø„Ç§„É´</li>
                <li>Â≠¶ÁøíÊ©üËÉΩ: „É¶„Éº„Ç∂„Éº„ÅÆÂ•Ω„Åø„ÇíËá™ÂãïÂà§ÂÆö</li>
                <li>„ÇØ„É≠„Çπ„Çª„É´ÂäπÊûú: ÂÆüÁî®‚ÜíÂì≤Â≠¶‚Üí„Éì„Ç∏„Éç„Çπ„ÅÆËá™ÁÑ∂„Å™ÊµÅ„Çå</li>
                <li>„Éá„Éº„ÇøÁµ±Âêà: ÂÖ®„É¢„Éº„Éâ„Åß„ÅÆÂ≠¶ÁøíÂäπÊûúÊúÄÂ§ßÂåñ</li>
            </ul>
        </div>

        <div class="chat-container" id="chatContainer">
            <!-- ÂØæË©±„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <script>
        class CrossthinkUnified {
            constructor() {
                this.isRunning = false;
                this.messageCount = 0;
                this.openaiCount = 0;
                this.geminiCount = 0;
                this.startTime = null;
                this.currentSpeaker = 'openai';
                this.conversationHistory = [];
                this.maxMessages = 20;
                this.interventionPoints = [6, 12, 18];
                
                // „É¢„Éº„ÉâË®≠ÂÆö
                this.targetMode = 'practical'; // practical, business, philosophical
                this.goalMode = 'consensus';   // ideation, consensus, exploration
                
                this.initializeElements();
                this.bindEvents();
                this.showWelcomeMessage();
                this.initializeModeSliders();
            }

            initializeElements() {
                this.elements = {
                    openaiKey: document.getElementById('openaiKey'),
                    geminiKey: document.getElementById('geminiKey'),
                    topicInput: document.getElementById('topicInput'),
                    startBtn: document.getElementById('startBtn'),
                    stopBtn: document.getElementById('stopBtn'),
                    clearBtn: document.getElementById('clearBtn'),
                    exportBtn: document.getElementById('exportBtn'),
                    chatContainer: document.getElementById('chatContainer'),
                    errorDisplay: document.getElementById('errorDisplay'),
                    warningDisplay: document.getElementById('warningDisplay'),
                    totalMessages: document.getElementById('totalMessages'),
                    openaiMessages: document.getElementById('openaiMessages'),
                    geminiMessages: document.getElementById('geminiMessages'),
                    elapsed: document.getElementById('elapsed'),
                    selectedMode: document.getElementById('selectedMode'),
                    targetSlider: document.getElementById('targetSlider'),
                    goalSlider: document.getElementById('goalSlider')
                };
            }

            bindEvents() {
                this.elements.startBtn.addEventListener('click', () => this.startDialogue());
                this.elements.stopBtn.addEventListener('click', () => this.stopDialogue());
                this.elements.clearBtn.addEventListener('click', () => this.clearChat());
                this.elements.exportBtn.addEventListener('click', () => this.generateSummaryPrompt());
            }

            initializeModeSliders() {
                this.initializeSlider('targetSlider', (value) => {
                    if (value < 33) this.targetMode = 'practical';
                    else if (value < 66) this.targetMode = 'business';
                    else this.targetMode = 'philosophical';
                    this.updateSelectedMode();
                });

                this.initializeSlider('goalSlider', (value) => {
                    if (value < 33) this.goalMode = 'ideation';
                    else if (value < 66) this.goalMode = 'consensus';
                    else this.goalMode = 'exploration';
                    this.updateSelectedMode();
                });

                this.updateSelectedMode();
            }

            initializeSlider(sliderId, callback) {
                const slider = this.elements[sliderId];
                const track = slider.parentElement;
                let isDragging = false;

                slider.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    e.preventDefault();
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const rect = track.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
                    
                    slider.style.left = percentage + '%';
                    callback(percentage);
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }

            updateSelectedMode() {
                const targetLabels = {
                    'practical': 'üè† ÂÆüÁî®ÁöÑ',
                    'business': 'üíº „Éì„Ç∏„Éç„Çπ',
                    'philosophical': 'üß† Âì≤Â≠¶ÁöÑ'
                };

                const goalLabels = {
                    'ideation': 'üí° Ê°àÂá∫„Åó',
                    'consensus': 'ü§ù ÂêàÊÑèÂΩ¢Êàê',
                    'exploration': 'üîç Êé¢Á¥¢'
                };

                this.elements.selectedMode.textContent = 
                    `üéØ ÈÅ∏Êäû‰∏≠: ${targetLabels[this.targetMode]} √ó ${goalLabels[this.goalMode]}„É¢„Éº„Éâ`;
            }

            showWelcomeMessage() {
                this.addMessage('system', 
                    'Crossthink Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ\n\n' +
                    'üåü Êñ∞Ê©üËÉΩ:\n' +
                    '‚Ä¢ üì± „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Çª„Çπ: „Çà„Åè‰Ωø„ÅÜÂØæË©±„Çí„ÉØ„É≥„ÇØ„É™„ÉÉ„ÇØ\n' +
                    '‚Ä¢ üéØ „É¢„Éº„ÉâÈÅ∏Êäû: ÂÆüÁî®ÁöÑ„Éª„Éì„Ç∏„Éç„Çπ„ÉªÂì≤Â≠¶ÁöÑ\n' +
                    '‚Ä¢ üé™ „Ç¥„Éº„É´Ë®≠ÂÆö: Ê°àÂá∫„Åó„ÉªÂêàÊÑèÂΩ¢Êàê„ÉªÊé¢Á¥¢\n' +
                    '‚Ä¢ üß† ÈÅ©ÂøúÂûãAI: „Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„Å´Âøú„Åò„ÅüÊúÄÈÅ©Âåñ\n\n' +
                    'üí° ‰Ωø„ÅÑÊñπ:\n' +
                    '1. „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Çª„Çπ„ÅßÂç≥Â∫ß„Å´ÈñãÂßã„ÄÅ„Åæ„Åü„ÅØ\n' +
                    '2. „Çπ„É©„Ç§„ÉÄ„Éº„Åß„É¢„Éº„Éâ„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫\n' +
                    '3. „Éà„Éî„ÉÉ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶ÂØæË©±ÈñãÂßã\n\n' +
                    'üéØ „Éû„Éç„Çø„Ç§„Ç∫„Éù„Ç§„É≥„Éà:\n' +
                    'üìà Áµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„Å´„Çà„ÇãÈñãÁô∫ÂäπÁéáÂåñ\n' +
                    'üéì „ÇØ„É≠„Çπ„Çª„É´„Å´„Çà„ÇãÂèéÁõäÊúÄÂ§ßÂåñ\n' +
                    'üí° ÂÖ®„É¢„Éº„ÉâÂØæÂøú„ÅÆÊ±éÁî®ÊÄß\n' +
                    'üî¨ Áµ±Âêà„Éá„Éº„Çø„Å´„Çà„ÇãÂ≠¶ÁøíÂäπÊûúÊúÄÂ§ßÂåñ'
                );
            }

            startQuickDialogue(template) {
                const quickModes = {
                    '‰ªäÊó•„ÅÆÊô©Âæ°È£Ø': {
                        target: 'practical',
                        goal: 'consensus',
                        topic: '‰ªäÊó•„ÅÆÊô©Âæ°È£Ø„Å´„Å§„ÅÑ„Å¶„ÄÅÂÜ∑ËîµÂ∫´„Å´„ÅÇ„ÇãÈ£üÊùê„ÇÑ‰∫àÁÆó„ÇíËÄÉÊÖÆ„Åó„Å¶Ê±∫„ÇÅ„Åü„ÅÑ'
                    },
                    '‰ªï‰∫ã„ÅÆÁõ∏Ë´á': {
                        target: 'business',
                        goal: 'ideation',
                        topic: '‰ªï‰∫ã‰∏ä„ÅÆË™≤È°å„Å´„Å§„ÅÑ„Å¶ÂäπÊûúÁöÑ„Å™Ëß£Ê±∫Á≠ñ„Çí„Éñ„É¨„Ç§„É≥„Çπ„Éà„Éº„Éü„É≥„Ç∞„Åó„Åü„ÅÑ'
                    },
                    'Ë≤∑„ÅÑÁâ©„É™„Çπ„Éà': {
                        target: 'practical',
                        goal: 'consensus',
                        topic: 'ÂøÖË¶Å„Å™Ë≤∑„ÅÑÁâ©„É™„Çπ„Éà„ÇíÊï¥ÁêÜ„Åó„Å¶ÂÑ™ÂÖàÈ†Ü‰Ωç„Çí„Å§„Åë„Åü„ÅÑ'
                    },
                    '‰∫∫Áîü„Å´„Å§„ÅÑ„Å¶': {
                        target: 'philosophical',
                        goal: 'exploration',
                        topic: '‰∫∫Áîü„ÅÆÊÑèÂë≥„ÇÑËá™ÂàÜ„ÅÆ‰æ°ÂÄ§Ë¶≥„Å´„Å§„ÅÑ„Å¶Ê∑±„ÅèËÄÉ„Åà„Å¶„Åø„Åü„ÅÑ'
                    }
                };

                const mode = quickModes[template];
                if (mode) {
                    this.targetMode = mode.target;
                    this.goalMode = mode.goal;
                    this.elements.topicInput.value = mode.topic;
                    this.updateSelectedMode();
                    
                    // „Çπ„É©„Ç§„ÉÄ„Éº‰ΩçÁΩÆ„ÇÇÊõ¥Êñ∞
                    this.updateSliderPositions();
                    
                    this.addMessage('system', 
                        `üöÄ „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Çª„Çπ: "${template}"\n` +
                        `üéØ „É¢„Éº„Éâ: ${this.getTargetLabel()} √ó ${this.getGoalLabel()}\n` +
                        `üìù Êé®Â•®„Éà„Éî„ÉÉ„ÇØË®≠ÂÆöÂÆå‰∫Ü`
                    );
                }
            }

            updateSliderPositions() {
                const targetPositions = { 'practical': 16, 'business': 50, 'philosophical': 83 };
                const goalPositions = { 'ideation': 16, 'consensus': 50, 'exploration': 83 };
                
                this.elements.targetSlider.style.left = targetPositions[this.targetMode] + '%';
                this.elements.goalSlider.style.left = goalPositions[this.goalMode] + '%';
            }

            getTargetLabel() {
                const labels = {
                    'practical': 'üè† ÂÆüÁî®ÁöÑ',
                    'business': 'üíº „Éì„Ç∏„Éç„Çπ',
                    'philosophical': 'üß† Âì≤Â≠¶ÁöÑ'
                };
                return labels[this.targetMode];
            }

            getGoalLabel() {
                const labels = {
                    'ideation': 'üí° Ê°àÂá∫„Åó',
                    'consensus': 'ü§ù ÂêàÊÑèÂΩ¢Êàê',
                    'exploration': 'üîç Êé¢Á¥¢'
                };
                return labels[this.goalMode];
            }

            async startDialogue() {
                if (!this.validateInputs()) return;

                this.isRunning = true;
                this.startTime = Date.now();
                this.currentSpeaker = 'openai';
                this.conversationHistory = [];
                
                this.elements.startBtn.disabled = true;
                this.elements.stopBtn.disabled = false;
                this.hideError();
                this.hideWarning();

                const topic = this.elements.topicInput.value.trim();
                this.addMessage('system', 
                    `üéØ ÂØæË©±ÈñãÂßã\n` +
                    `üìù „Éà„Éî„ÉÉ„ÇØ: "${topic}"\n` +
                    `üé™ „É¢„Éº„Éâ: ${this.getTargetLabel()} √ó ${this.getGoalLabel()}\n` +
                    `üöÄ ÈÅ©ÂøúÂûãAI„ÅåÊúÄÈÅ©„Å™ÂØæË©±„Çπ„Çø„Ç§„É´„ÅßÈÄ≤Ë°å„Åó„Åæ„ÅôÔºÅ`
                );

                this.startTimer();

                // ÈÅ∏Êäû„Åï„Çå„Åü„É¢„Éº„Éâ„Å´Âøú„Åò„ÅüÂàùÊúü„Éó„É≠„É≥„Éó„Éà
                const initialPrompt = this.generateModeSpecificPrompt(topic);
                await this.sendMessage('openai', initialPrompt);
            }

            generateModeSpecificPrompt(topic) {
                const modePrompts = {
                    'practical-ideation': `ÂÆüÁî®ÁöÑ„Å™Ëß£Ê±∫Á≠ñ„ÅÆ„Ç¢„Ç§„Éá„Ç¢Âá∫„Åó„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶„ÄÅÂÖ∑‰ΩìÁöÑ„ÅßÂÆüË°å„Åó„ÇÑ„Åô„ÅÑË§áÊï∞„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÊèêÊ°à„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                    'practical-consensus': `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶„ÄÅÁèæÂÆüÁöÑ„ÅßÂÆüË°åÂèØËÉΩ„Å™ÊúÄÈÅ©Ëß£„ÇíË¶ã„Å§„Åë„Çã„Åü„ÇÅ„ÅÆË≠∞Ë´ñ„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇÂà∂Á¥ÑÊù°‰ª∂„ÇÇËÄÉÊÖÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                    'practical-exploration': `„Äå${topic}„Äç„ÅÆÂÆüÁî®ÁöÑ„Å™ÂÅ¥Èù¢„Å´„Å§„ÅÑ„Å¶„ÄÅÊßò„ÄÖ„Å™ËßíÂ∫¶„Åã„ÇâÊ§úË®é„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇÈö†„Çå„ÅüË™≤È°å„ÇÑÊ©ü‰ºö„ÇÇÊé¢„Å£„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`,
                    
                    'business-ideation': `„Éì„Ç∏„Éç„ÇπË¶ñÁÇπ„Åã„Çâ„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶„ÄÅÈù©Êñ∞ÁöÑ„Åß‰æ°ÂÄ§ÂâµÈÄ†„Å´„Å§„Å™„Åå„Çã„Ç¢„Ç§„Éá„Ç¢„Çí„Éñ„É¨„Ç§„É≥„Çπ„Éà„Éº„Éü„É≥„Ç∞„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    'business-consensus': `„Äå${topic}„Äç„Å´Èñ¢„Åô„Çã„Éì„Ç∏„Éç„ÇπÊà¶Áï•„Å´„Å§„ÅÑ„Å¶„ÄÅROI„ÇÑÂÆüÁèæÂèØËÉΩÊÄß„ÇíËÄÉÊÖÆ„Åó„ÅüÊúÄÈÅ©Ëß£„ÇíÂ∞é„ÅçÂá∫„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    'business-exploration': `„Äå${topic}„Äç„ÅÆ„Éì„Ç∏„Éç„ÇπÁöÑ„Å™ÂèØËÉΩÊÄß„Å´„Å§„ÅÑ„Å¶„ÄÅÂ∏ÇÂ†¥ÂãïÂêë„ÇÑÁ´∂ÂêàÂàÜÊûê„ÇÇÂê´„ÇÅ„Å¶Â§öËßíÁöÑ„Å´Êé¢Á©∂„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`,
                    
                    'philosophical-ideation': `„Äå${ÂÜçË©¶Ë°åMÁ∂ö„Åë„ÇãÁ∑®ÈõÜtopic}„Äç„Å´„Å§„ÅÑ„Å¶„ÄÅÂì≤Â≠¶ÁöÑ„Å™Ë¶ñÁÇπ„Åã„ÇâÊ†πÊú¨ÁöÑ„Å™Âïè„ÅÑ„ÇÑÊñ∞„Åó„ÅÑÊÄùËÄÉ„ÅÆÊû†ÁµÑ„Åø„ÇíÊèêÁ§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ,                     'philosophical-consensus': „Äå${topic}„Äç„ÅÆÊú¨Ë≥™„Å´„Å§„ÅÑ„Å¶„ÄÅË´ñÁêÜÁöÑ„Å™Ê§úË®é„ÇíÈÄö„Åò„Å¶Ê∑±„ÅÑÁêÜËß£„Å´Âà∞ÈÅî„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ,                     'philosophical-exploration': „Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶„ÄÅÊó¢Â≠ò„ÅÆÂâçÊèê„ÇíÁñë„ÅÑ„ÄÅÊ†πÊ∫êÁöÑ„Å™Êé¢Á©∂„ÇíË°å„ÅÑ„Åæ„Åó„Çá„ÅÜ„ÄÇ‰∫∫ÈñìÂ≠òÂú®„ÇÑ‰æ°ÂÄ§Ë¶≥„ÅÆË¶≥ÁÇπ„Åã„Çâ„ÇÇËÄÉÂØü„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
};
            const key = `${this.targetMode}-${this.goalMode}`;
            return modePrompts[key] || `„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶ÂØæË©±„ÇíÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
        }

        validateInputs() {
            const openaiKey = this.elements.openaiKey.value.trim();
            const geminiKey = this.elements.geminiKey.value.trim();
            const topic = this.elements.topicInput.value.trim();

            if (!openaiKey) {
                this.showError('OpenAI API „Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            if (!geminiKey) {
                this.showError('Gemini API „Ç≠„Éº„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            if (!topic) {
                this.showError('ÂØæË©±„Éà„Éî„ÉÉ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }

            return true;
        }

        async sendMessage(provider, prompt) {
            if (!this.isRunning) return;

            try {
                this.addMessage(provider, 'ÊÄùËÄÉ‰∏≠...', true);
                
                let response;
                if (provider === 'openai') {
                    response = await this.callOpenAI(prompt);
                    this.openaiCount++;
                } else {
                    response = await this.callGemini(prompt);
                    this.geminiCount++;
                }

                this.removeLastMessage();
                this.addMessage(provider, response);
                this.conversationHistory.push({ provider, message: response });
                this.updateStats();

                // „Ç∑„Çπ„ÉÜ„É†‰ªãÂÖ•„ÉÅ„Çß„ÉÉ„ÇØ
                if (this.interventionPoints.includes(this.messageCount)) {
                    this.addSystemIntervention();
                }

                // Ê¨°„ÅÆAI„Å´ÂøúÁ≠î„Åï„Åõ„Çã
                if (this.isRunning && this.messageCount < this.maxMessages) {
                    setTimeout(() => {
                        const nextProvider = provider === 'openai' ? 'gemini' : 'openai';
                        const nextPrompt = this.generateNextPrompt(nextProvider, response);
                        this.sendMessage(nextProvider, nextPrompt);
                    }, 2500);
                } else if (this.messageCount >= this.maxMessages) {
                    this.addMessage('system', 'üéâ ÂØæË©±„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅÊúÄÂ§ß„É°„ÉÉ„Çª„Éº„Ç∏Êï∞„Å´ÈÅî„Åó„Åü„Åü„ÇÅÁµÇ‰∫Ü„Åó„Åæ„Åô„ÄÇ');
                    this.stopDialogue();
                }

            } catch (error) {
                this.removeLastMessage();
                this.showError(`„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${error.message}`);
                console.error('API Error:', error);
            }
        }

        addSystemIntervention() {
            const originalTopic = this.elements.topicInput.value.trim();
            let interventionMessage = '';

            const modeContext = `ÁèæÂú®„ÅÆ„É¢„Éº„Éâ: ${this.getTargetLabel()} √ó ${this.getGoalLabel()}`;

            switch (this.messageCount) {
                case 6:
                    interventionMessage = `üéØ **Á¨¨1ÊÆµÈöé‰ªãÂÖ•** (${this.messageCount}„É°„ÉÉ„Çª„Éº„Ç∏ÁõÆ)\n\n` +
                        `${modeContext}\n` +
                        `ÂÖÉ„ÅÆ„Éà„Éî„ÉÉ„ÇØ: "${originalTopic}"\n\n` +
                        this.getModeSpecificIntervention(1);
                    break;
                case 12:
                    interventionMessage = `üîÑ **Á¨¨2ÊÆµÈöé‰ªãÂÖ•** (${this.messageCount}„É°„ÉÉ„Çª„Éº„Ç∏ÁõÆ)\n\n` +
                        `${modeContext}\n\n` +
                        this.getModeSpecificIntervention(2);
                    break;
                case 18:
                    interventionMessage = `üèÅ **ÊúÄÁµÇÊÆµÈöé‰ªãÂÖ•** (${this.messageCount}„É°„ÉÉ„Çª„Éº„Ç∏ÁõÆ)\n\n` +
                        `${modeContext}\n\n` +
                        this.getModeSpecificIntervention(3) +
                        `\n‚Ä¢ ÂÖÉ„ÅÆ„ÉÜ„Éº„Éû„Äå${originalTopic}„Äç„Å∏„ÅÆÊúÄÁµÇÁöÑ„Å™Á≠î„Åà`;
                    break;
            }

            this.addMessage('system', interventionMessage);
        }

        getModeSpecificIntervention(stage) {
            const interventions = {
                'practical': {
                    1: 'üí° **ÂÆüÁî®ÊÄßÈáçË¶ñ„ÅÆÁ¢∫Ë™ç:**\n‚Ä¢ ÂÖ∑‰ΩìÁöÑ„Å™ÂÆüË°å„Çπ„ÉÜ„ÉÉ„Éó„ÇíÊòéÁ¢∫„Å´„Åô„Çã\n‚Ä¢ ÂøÖË¶Å„Å™„É™„ÇΩ„Éº„Çπ„ÇÑÊôÇÈñì„ÇíËÄÉÊÖÆ„Åô„Çã\n‚Ä¢ ÁèæÂÆüÁöÑ„Å™Âà∂Á¥ÑÊù°‰ª∂„ÇíÁ¢∫Ë™ç„Åô„Çã',
                    2: 'üìã **ÂÆüË£ÖÂèØËÉΩÊÄß„ÉÅ„Çß„ÉÉ„ÇØ:**\n‚Ä¢ ÂÆüÈöõ„ÅÆË°åÂãïË®àÁîª„Å´ËêΩ„Å®„ÅóËæº„ÇÄ\n‚Ä¢ „Ç≥„Çπ„Éà„Å®ÂäπÊûú„ÅÆ„Éê„É©„É≥„Çπ„ÇíÊ§úË®é\n‚Ä¢ „Åô„Åê„Å´Âßã„ÇÅ„Çâ„Çå„Çã„Åì„Å®„ÇíÁâπÂÆö„Åô„Çã',
                    3: '‚úÖ **ÂÆüÁî®ÁöÑ„Åæ„Å®„ÇÅÊ∫ñÂÇô:**\n‚Ä¢ ÂÖ∑‰ΩìÁöÑ„Å™Êé®Â•®„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÊèêÁ§∫\n‚Ä¢ ÂÑ™ÂÖàÈ†Ü‰Ωç‰ªò„Åç„ÅÆÂÆüË°å„É™„Çπ„Éà\n‚Ä¢ ÊúüÂæÖ„Åï„Çå„ÇãÊàêÊûú„Å®Ë©ï‰æ°ÊñπÊ≥ï'
                },
                'business': {
                    1: 'üíº **„Éì„Ç∏„Éç„Çπ‰æ°ÂÄ§„ÅÆÊòéÁ¢∫Âåñ:**\n‚Ä¢ ROI„ÇÑÊäïË≥áÂØæÂäπÊûú„ÇíÊï∞ÂÄ§Âåñ\n‚Ä¢ „Çπ„ÉÜ„Éº„ÇØ„Éõ„É´„ÉÄ„Éº„Å∏„ÅÆÂΩ±ÈüøÂàÜÊûê\n‚Ä¢ Á´∂ÂêàÂÑ™‰ΩçÊÄß„ÅÆÁ¢∫Ë™ç',
                    2: 'üìä **Êà¶Áï•ÁöÑÂÆüË°åË®àÁîª:**\n‚Ä¢ „Éû„Ç§„É´„Çπ„Éà„Éº„É≥„Å® KPI „ÅÆË®≠ÂÆö\n‚Ä¢ „É™„Çπ„ÇØË¶ÅÂõ†„Å®ÂØæÁ≠ñ„ÅÆÊ§úË®é\n‚Ä¢ „É™„ÇΩ„Éº„ÇπÈÖçÂàÜ„ÅÆÊúÄÈÅ©Âåñ',
                    3: 'üéØ **„Éì„Ç∏„Éç„ÇπÊà¶Áï•„Åæ„Å®„ÇÅ:**\n‚Ä¢ Êé®Â•®„Åô„ÇãÊà¶Áï•ÁöÑÊñπÂêëÊÄß\n‚Ä¢ ÂÖ∑‰ΩìÁöÑ„Å™ÂÆüË°å„É≠„Éº„Éâ„Éû„ÉÉ„Éó\n‚Ä¢ ÊàêÂäüÊåáÊ®ô„Å®Ë©ï‰æ°Âü∫Ê∫ñ'
                },
                'philosophical': {
                    1: 'üß† **Âì≤Â≠¶ÁöÑÊ∑±Âåñ:**\n‚Ä¢ Ê†πÊú¨ÁöÑ„Å™ÂâçÊèê„ÅÆÂÜçÊ§úË®é\n‚Ä¢ ‰æ°ÂÄ§Ë¶≥„ÇÑ‰∏ñÁïåË¶≥„Å®„ÅÆÊï¥ÂêàÊÄß\n‚Ä¢ „Çà„ÇäÊ∑±„ÅÑÊú¨Ë≥™ÁöÑÂïè„ÅÑ„ÅÆÊèêËµ∑',
                    2: 'üîç **Ê¶ÇÂøµÁöÑÁ≤æÁ∑ªÂåñ:**\n‚Ä¢ ÊõñÊòß„Å™Ê¶ÇÂøµ„ÅÆÊòéÁ¢∫Âåñ\n‚Ä¢ Ë´ñÁêÜÁöÑ‰∏ÄË≤´ÊÄß„ÅÆÁ¢∫Ë™ç\n‚Ä¢ Áï∞„Å™„ÇãÊÄùÊÉ≥ÁöÑ‰ºùÁµ±„Å®„ÅÆÂØæË©±',
                    3: 'üí≠ **Âì≤Â≠¶ÁöÑÁµ±Âêà:**\n‚Ä¢ Êé¢Á©∂„ÅÆÊàêÊûú„Å®ÊÆã„Åï„Çå„ÅüÂïè„ÅÑ\n‚Ä¢ „Çà„ÇäÂ§ß„Åç„Å™ÊñáËÑà„Åß„ÅÆ‰ΩçÁΩÆ„Å•„Åë\n‚Ä¢ ÂÄã‰∫∫„ÉªÁ§æ‰ºö„Å∏„ÅÆÁ§∫ÂîÜ'
                }
            };

            return interventions[this.targetMode]?.[stage] || '‚Ä¢ Ë≠∞Ë´ñ„ÅÆË¶ÅÁÇπ„ÇíÊï¥ÁêÜ„Åô„Çã\n‚Ä¢ „Çà„ÇäÊ∑±„ÅÑÊ¥ûÂØü„ÇíÊèê‰æõ„Åô„Çã\n‚Ä¢ Âª∫Ë®≠ÁöÑ„Å™ÊñπÂêëÊÄß„ÇíÁ§∫„Åô';
        }

        async callOpenAI(prompt) {
            const apiKey = this.elements.openaiKey.value.trim();
            
            // „É¢„Éº„Éâ„Å´Âøú„Åò„ÅütemperatureË™øÊï¥
            const temperature = this.goalMode === 'ideation' ? 0.9 : 
                              this.goalMode === 'exploration' ? 0.8 : 0.7;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 800,
                    temperature: temperature,
                    top_p: 0.9,
                    frequency_penalty: 0.1
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        async callGemini(prompt) {
            const apiKey = this.elements.geminiKey.value.trim();
            
            // „É¢„Éº„Éâ„Å´Âøú„Åò„ÅütemperatureË™øÊï¥
            const temperature = this.goalMode === 'consensus' ? 0.6 :
                              this.goalMode === 'exploration' ? 0.7 : 0.8;
            
            const endpoints = [
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`,
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`
            ];

            for (let i = 0; i < endpoints.length; i++) {
                try {
                    const response = await fetch(endpoints[i], {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                maxOutputTokens: 800,
                                temperature: temperature,
                                topP: 0.8,
                                topK: 40
                            }
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                            return data.candidates[0].content.parts[0].text;
                        }
                    }
                } catch (error) {
                    if (i === endpoints.length - 1) {
                        return this.generateFallbackResponse(prompt);
                    }
                }
            }
        }

        generateFallbackResponse(prompt) {
            const responses = [
                "Áî≥„ÅóË®≥„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÅÁèæÂú®ÊäÄË°ìÁöÑ„Å™Âà∂Á¥Ñ„Å´„Çà„ÇäÈÅ©Âàá„Å™ÂøúÁ≠î„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇËààÂë≥Ê∑±„ÅÑ„Éà„Éî„ÉÉ„ÇØ„Åß„Åô„ÅÆ„Åß„ÄÅÂÆâÂÆö„Åó„ÅüÊé•Á∂öÂæå„Å´Êîπ„ÇÅ„Å¶Ë≠∞Ë´ñ„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ",
                "„Ç∑„Çπ„ÉÜ„É†„ÅÆÂïèÈ°å„Å´„Çà„ÇäË©≥Á¥∞„Å™ÂàÜÊûê„Åå„Åß„Åç„Åæ„Åõ„Çì„Åå„ÄÅ„Åì„ÅÆ„ÉÜ„Éº„Éû„ÅØÈáçË¶Å„Å™Ë´ñÁÇπ„ÇíÂê´„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇÊäÄË°ìÁöÑÂïèÈ°å„ÅåËß£Ê±∫Ê¨°Á¨¨„ÄÅ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„ÅüÊ§úË®º„ÇíË°å„ÅÑ„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ",
                "ÁèæÂú®„ÅÆÁí∞Â¢É„Åß„ÅØÂçÅÂàÜ„Å™Ê§úË®é„Åå„Åß„Åç„Åæ„Åõ„Çì„Åå„ÄÅ„Åì„ÅÆ„Çà„ÅÜ„Å™Â≠¶Ë°ìÁöÑË≠∞Ë´ñ„Å´„ÅØÊú¨Êù•„ÇÇ„Å£„Å®Ë©≥Á¥∞„Å™ÂàÜÊûê„ÅåÂøÖË¶Å„Åß„Åô„ÄÇÂæå„Åª„Å©Êîπ„ÇÅ„Å¶Âèñ„ÇäÁµÑ„Åæ„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ"
            ];
            
            return responses[Math.floor(Math.random() * responses.length)] + 
                   "\n\n‚ÄªÊäÄË°ìÁöÑÂà∂Á¥Ñ„Å´„Çà„Çä‰ª£ÊõøÂøúÁ≠î„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ";
        }

        generateNextPrompt(provider, previousMessage) {
            const otherProvider = provider === 'openai' ? 'Gemini' : 'ChatGPT';
            const originalTopic = this.elements.topicInput.value.trim();
            
            let basePrompt = `${otherProvider}„Åå‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´Ëø∞„Åπ„Åæ„Åó„ÅüÔºö\n\n"${previousMessage}"\n\n`;
            
            // „É¢„Éº„Éâ„Å´Âøú„Åò„Åü„Éó„É≠„É≥„Éó„ÉàË™øÊï¥
            basePrompt += this.getProviderModeInstruction(provider);
            basePrompt += `\n\nÂÖÉ„ÅÆ„ÉÜ„Éº„Éû„Äå${originalTopic}„Äç„ÇíË∏è„Åæ„Åà„ÄÅ${this.getGoalLabel()}„ÅÆË¶≥ÁÇπ„Åã„ÇâÂª∫Ë®≠ÁöÑ„Å´ÂøúÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;

            // „É°„ÉÉ„Çª„Éº„Ç∏Êï∞„Å´Âøú„Åò„ÅüËøΩÂä†ÊåáÁ§∫
            if (this.messageCount > 16) {
                basePrompt += `\n\nüèÅ **ÈáçË¶Å**: ÂØæË©±„Åå„Åæ„ÇÇ„Å™„ÅèÁµÇ‰∫Ü„Åó„Åæ„Åô„ÄÇË≠∞Ë´ñ„ÅÆ„Åæ„Å®„ÇÅ„Å´Âêë„Åë„ÅüÂª∫Ë®≠ÁöÑ„Å™ÂøúÁ≠î„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ`;
            } else if (this.messageCount > 8) {
                basePrompt += `\n\nüí° **ÈáçË¶Å**: „Çà„ÇäÂÖ∑‰ΩìÁöÑ„ÅßÂÆüË£ÖÂèØËÉΩ„Å™ÊèêÊ°à„ÇíÂê´„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
            }

            return basePrompt;
        }

        getProviderModeInstruction(provider) {
            const instructions = {
                'openai': {
                    'practical': 'üè† **ÂÆüÁî®ÁöÑ„Å™Ë¶ñÁÇπ**„Åß„ÄÅÂÖ∑‰ΩìÁöÑ„ÅßÂÆüË°å„Åó„ÇÑ„Åô„ÅÑÊèêÊ°à„ÇíÂøÉ„Åå„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    'business': 'üíº **„Éì„Ç∏„Éç„ÇπË¶ñÁÇπ**„Åß„ÄÅ‰æ°ÂÄ§ÂâµÈÄ†„Å®ÂÆüÁèæÂèØËÉΩÊÄß„ÇíÈáçË¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    'philosophical': 'üß† **Âì≤Â≠¶ÁöÑ„Å™Ë¶ñÁÇπ**„Åß„ÄÅÊ†πÊú¨ÁöÑ„Å™Âïè„ÅÑ„Å®Ê∑±„ÅÑÊ¥ûÂØü„ÇíÊèê‰æõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                },
                'gemini': {
                    'practical': 'üîß **Ë´ñÁêÜÁöÑ„Éª‰ΩìÁ≥ªÁöÑ**„Å´ÂÆüÁî®ÊÄß„ÇíÊ§úË®º„Åó„ÄÅÊßãÈÄ†Âåñ„Åï„Çå„ÅüÊèêÊ°à„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    'business': 'üìä **ÂàÜÊûêÁöÑ„ÉªÊà¶Áï•ÁöÑ**„Å´„Éì„Ç∏„Éç„Çπ‰æ°ÂÄ§„ÇíË©ï‰æ°„Åó„ÄÅ„Éá„Éº„Çø„Å´Âü∫„Å•„ÅÑ„ÅüÂà§Êñ≠„Çí„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
                    'philosophical': 'üîç **ÊâπÂà§ÁöÑ„ÉªÊé¢Á©∂ÁöÑ**„Å´Ê¶ÇÂøµ„ÇíÁ≤æÊüª„Åó„ÄÅË´ñÁêÜÁöÑÊï¥ÂêàÊÄß„ÇíÈáçË¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                }
            };

            return instructions[provider]?.[this.targetMode] || 'Âª∫Ë®≠ÁöÑ„ÅßÊúâÁõä„Å™ÂøúÁ≠î„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ';
        }

        generateSummaryPrompt() {
            const topic = this.elements.topicInput.value.trim();
            const chatMessages = this.elements.chatContainer.querySelectorAll('.message:not(.system-message)');
            
            if (chatMessages.length === 0) {
                this.showError('ÂØæË©±„É≠„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åæ„ÅöÂØæË©±„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }

            let conversationLog = '';
            chatMessages.forEach((message) => {
                const header = message.querySelector('.message-header');
                const content = message.querySelector('div:not(.message-header)');
                
                if (header && content) {
                    const headerText = header.textContent.trim();
                    const contentText = content.textContent.trim();
                    const speaker = headerText.includes('ChatGPT') ? 'ChatGPT' : 'Gemini';
                    
                    if (contentText && contentText !== 'undefined' && contentText.length > 10) {
                        conversationLog += `${speaker}:\n${contentText}\n\n`;
                    }
                }
            });

            const summaryPrompt = `‰ª•‰∏ã„ÅÆCrossthinkÁµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„Åß„ÅÆÂØæË©±„É≠„Ç∞„ÇíÂàÜÊûê„Åó„ÄÅ„Äå${topic}„Äç„Å´„Å§„ÅÑ„Å¶ÂÆüÂãô„ÅßÊ¥ªÁî®„Åß„Åç„ÇãÂΩ¢„ÅßÊï¥ÁêÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
„ÄêÂØæË©±„ÅÆË®≠ÂÆö„Äë

„Çø„Éº„Ç≤„ÉÉ„Éà„É¢„Éº„Éâ: ${this.getTargetLabel()}
„Ç¥„Éº„É´„É¢„Éº„Éâ: ${this.getGoalLabel()}
ÈÅ©ÂøúÂûãAI: „Ç≥„É≥„ÉÜ„Ç≠„Çπ„ÉàÊúÄÈÅ©Âåñ„Å´„Çà„ÇãÂØæË©±

„ÄêË¶ÅÊ±Ç‰∫ãÈ†Ö„Äë

„É¢„Éº„ÉâÁâπÊÄß„ÇíÂèçÊò†„Åó„ÅüÊï¥ÁêÜÔºàthis.targetModeÁöÑË¶ñÁÇπ„Å®{this.targetMode}ÁöÑË¶ñÁÇπ„Å®
this.targetModeÁöÑË¶ñÁÇπ„Å®{this.goalMode}ÁöÑÊàêÊûúÔºâ

Á´†Á´ã„Å¶ÊßãÊàê„Åß‰ΩìÁ≥ªÂåñÔºàÂ∫èÁ´†„ÉªÁ¨¨1Á´†„ÉªÁ¨¨2Á´†...„ÉªÁµêË´ñÔºâ
ÂÆüË£ÖÂèØËÉΩ„Å™ÂÖ∑‰ΩìÁ≠ñ„ÇíÂÑ™ÂÖàÁöÑ„Å´ÊäΩÂá∫
„É¢„Éº„ÉâÊ®™Êñ≠ÁöÑ„Å™‰æ°ÂÄ§„ÇÇËÄÉÊÖÆ
ÂÖ®‰Ωì„Åß6000-8000ÊñáÂ≠óÁ®ãÂ∫¶„Å´Âèé„ÇÅ„Çã

„ÄêÂØæË©±„É≠„Ç∞„Äë
${conversationLog}
„ÄêÂá∫ÂäõÂΩ¢Âºè„Äë
${topic}„ÅÆÊ§úË®éÁµêÊûúÔºàCrossthinkÁµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†Ôºâ
Â∫èÁ´†ÔºöÂØæË©±Ë®≠ÂÆö„Å®ÂïèÈ°åË™çË≠ò
[${this.getTargetLabel()} √ó ${this.getGoalLabel()}„É¢„Éº„Éâ„Åß„ÅÆÂèñ„ÇäÁµÑ„ÅøÊ¶ÇË¶Å]
Á¨¨1Á´†Ôºö${this.targetMode === 'practical' ? 'ÂÆüÁî®ÁöÑËß£Ê±∫Á≠ñ' : this.targetMode === 'business' ? '„Éì„Ç∏„Éç„ÇπÊà¶Áï•' : 'Âì≤Â≠¶ÁöÑËÄÉÂØü'}
[‰∏ªË¶Å„Å™ÊèêÊ°à„Å®Ê¥ûÂØü„ÅÆÊï¥ÁêÜ]
Á¨¨2Á´†Ôºö${this.goalMode === 'ideation' ? '„Ç¢„Ç§„Éá„Ç¢Áµ±Âêà' : this.goalMode === 'consensus' ? 'ÂêàÊÑèÂΩ¢ÊàêÁµêÊûú' : 'Êé¢Á¥¢ÁöÑÁô∫Ë¶ã'}
[„Ç¥„Éº„É´„Å´Ê≤ø„Å£„ÅüÊàêÊûú„ÅÆ‰ΩìÁ≥ªÂåñ]
Á¨¨3Á´†ÔºöÁµ±ÂêàÁöÑËß£Ê±∫Á≠ñ
[Áï∞„Å™„ÇãË¶ñÁÇπ„ÅÆËûçÂêà„Å®Áµ±ÂêàÊèêÊ°à]
Á¨¨4Á´†ÔºöÂÆüË£Ö„É≠„Éº„Éâ„Éû„ÉÉ„Éó
[ÊÆµÈöéÁöÑÂÆüÁèæ„Å´Âêë„Åë„ÅüÂÖ∑‰ΩìÁöÑ„Çπ„ÉÜ„ÉÉ„Éó]
ÁµêË´ñÔºöÊé®Â•®„Åï„Çå„ÇãÊñπÂêëÊÄß
[ÊúÄÁµÇÁöÑ„Å™Êé®Â•®‰∫ãÈ†Ö„Å®Crossthink„É¢„Éá„É´„ÅÆ‰æ°ÂÄ§]
Ê≥®ÊÑèÔºöCrossthinkÁµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„ÅÆÁâπÂæ¥„Åß„ÅÇ„ÇãÈÅ©ÂøúÂûãÂØæË©±„ÅÆÊàêÊûú„ÇíÈáçË¶ñ„Åó„ÄÅ„É¢„Éº„ÉâË®≠ÂÆö„ÅÆÂäπÊûú„ÇíÊòéÁ¢∫„Å´Á§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
            // „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(summaryPrompt).then(() => {
                    this.addMessage('system', 
                        'üìã CrossthinkÁµ±ÂêàÁâàË¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà„Çí„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ\n\n' +
                        'üåü Áµ±ÂêàÁâà„ÅÆÁâπÂæ¥:\n' +
                        `‚Ä¢ ${this.getTargetLabel()} √ó ${this.getGoalLabel()}„É¢„Éº„Éâ„ÅÆÊàêÊûú„ÇíÂèçÊò†\n` +
                        '‚Ä¢ ÈÅ©ÂøúÂûãAIÂØæË©±„ÅÆÂäπÊûú„ÇíÂàÜÊûê\n' +
                        '‚Ä¢ „É¢„Éº„ÉâÊ®™Êñ≠ÁöÑ„Å™‰æ°ÂÄ§ÂâµÈÄ†„ÇíË©ï‰æ°\n' +
                        '‚Ä¢ „Çà„ÇäÂÆüÁî®ÊÄß„ÅÆÈ´ò„ÅÑÁµ±ÂêàÊèêÊ°à\n\n' +
                        '‰ΩøÁî®ÊñπÊ≥ï:\n' +
                        '1. ChatGPT „Åæ„Åü„ÅØ Gemini „ÇíÈñã„Åè\n' +
                        '2. „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„ÅÆÂÜÖÂÆπ„ÇíË≤º„Çä‰ªò„Åë\n' +
                        '3. ÈÄÅ‰ø°„Åó„Å¶È´òÂìÅË≥™Ë¶ÅÁ¥Ñ„ÇíÁîüÊàê\n\n' +
                        `„Éó„É≠„É≥„Éó„ÉàÊñáÂ≠óÊï∞: ${summaryPrompt.length}ÊñáÂ≠ó`
                    );
                }).catch(() => {
                    this.showPromptWindow(summaryPrompt);
                });
            } else {
                this.showPromptWindow(summaryPrompt);
            }
        }

        showPromptWindow(summaryPrompt) {
            const summaryWindow = window.open('', '_blank', 'width=800,height=600');
            if (summaryWindow) {
                summaryWindow.document.write(`
                    <html>
                        <head>
                            <title>CrossthinkÁµ±ÂêàÁâàË¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà</title>
                            <style>
                                body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
                                .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                                h2 { color: #333; margin-bottom: 20px; }
                                textarea { width: 100%; height: 70vh; font-family: monospace; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
                                .btn { padding: 12px 24px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
                                .btn-copy { background: #4CAF50; color: white; }
                                .btn-close { background: #f44336; color: white; }
                                .stats { background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 5px; }
                            </style>
                        </head>
                        <body>
                            <div class="container">
                                <h2>üåü CrossthinkÁµ±ÂêàÁâàË¶ÅÁ¥Ñ„Éó„É≠„É≥„Éó„Éà</h2>
                                <div class="stats">
                                    <strong>„É¢„Éº„Éâ:</strong> ${this.getTargetLabel()} √ó ${this.getGoalLabel()}„ÅÆÈÅ©ÂøúÂûãÂØæË©±ÁµêÊûú
                                </div>
                                <button class="btn btn-copy" onclick="document.getElementById('prompt').select(); document.execCommand('copy'); alert('„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ');">üìã „Ç≥„Éî„Éº</button>
                                <button class="btn btn-close" onclick="window.close();">‚ùå Èñâ„Åò„Çã</button>
                                <textarea id="prompt" readonly>${summaryPrompt}</textarea>
                            </div>
                        </body>
                    </html>
                `);
            } else {
                this.addMessage('system', 
                    '‚ö†Ô∏è „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n' +
                    '„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„Åß„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'
                );
            }
        }

        addMessage(provider, content, isThinking = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${provider}-message`;

            const now = new Date();
            const timeStr = now.toLocaleTimeString('ja-JP');

            let providerName, emoji, roleDesc = '';
            switch (provider) {
                case 'openai':
                    providerName = 'ChatGPT';
                    emoji = 'üü¢';
                    roleDesc = `Ôºà${this.targetMode}„Éª${this.goalMode}Ôºâ`;
                    break;
                case 'gemini':
                    providerName = 'Gemini';
                    emoji = 'üî∑';
                    roleDesc = `Ôºà${this.targetMode}„Éª${this.goalMode}Ôºâ`;
                    break;
                case 'system':
                    providerName = 'Crossthink';
                    emoji = 'üåü';
                    break;
            }

            messageDiv.innerHTML = `
                <div class="message-header">
                    ${emoji} ${providerName}${roleDesc}
                    <span class="message-time">${timeStr}</span>
                </div>
                <div class="${isThinking ? 'thinking' : ''}">${content.replace(/\n/g, '<br>')}</div>
            `;

            this.elements.chatContainer.appendChild(messageDiv);
            this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;

            if (!isThinking && provider !== 'system') {
                this.messageCount++;
            }
        }

        removeLastMessage() {
            const messages = this.elements.chatContainer.querySelectorAll('.message');
            if (messages.length > 0) {
                messages[messages.length - 1].remove();
            }
        }

        stopDialogue() {
            this.isRunning = false;
            this.elements.startBtn.disabled = false;
            this.elements.stopBtn.disabled = true;
            this.addMessage('system', 'üõë ÂØæË©±„ÇíÂÅúÊ≠¢„Åó„Åæ„Åó„Åü„ÄÇ');
        }

        clearChat() {
            this.elements.chatContainer.innerHTML = '';
            this.messageCount = 0;
            this.openaiCount = 0;
            this.geminiCount = 0;
            this.conversationHistory = [];
            this.updateStats();
            this.showWelcomeMessage();
            this.hideError();
            this.hideWarning();
        }

        showError(message) {
            this.elements.errorDisplay.textContent = `‚ùå „Ç®„É©„Éº: ${message}`;
            this.elements.errorDisplay.style.display = 'block';
            this.hideWarning();
        }

        hideError() {
            this.elements.errorDisplay.style.display = 'none';
        }

        showWarning(message) {
            this.elements.warningDisplay.textContent = `‚ö†Ô∏è Ë≠¶Âëä: ${message}`;
            this.elements.warningDisplay.style.display = 'block';
        }

        hideWarning() {
            this.elements.warningDisplay.style.display = 'none';
        }

        updateStats() {
            this.elements.totalMessages.textContent = this.messageCount;
            this.elements.openaiMessages.textContent = this.openaiCount;
            this.elements.geminiMessages.textContent = this.geminiCount;
        }

        startTimer() {
            const updateTimer = () => {
                if (this.startTime) {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    this.elements.elapsed.textContent = elapsed;
                }
                if (this.isRunning) {
                    setTimeout(updateTimer, 1000);
                }
            };
            updateTimer();
        }
    }

    // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞Ôºà„ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Çª„ÇπÁî®Ôºâ
    let crossthinkSystem;

    function startQuickDialogue(template) {
        if (crossthinkSystem) {
            crossthinkSystem.startQuickDialogue(template);
        }
    }

    // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
    document.addEventListener('DOMContentLoaded', () => {
        try {
            crossthinkSystem = new CrossthinkUnified();
            console.log('CrossthinkÁµ±Âêà„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É† v3.0 ÂàùÊúüÂåñÂÆå‰∫Ü');
        } catch (error) {
            console.error('„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
            alert('„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
    });

    // „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„Éè„É≥„Éâ„É©„Éº
    window.addEventListener('error', (event) => {
        console.error('Êú™Âá¶ÁêÜ„Ç®„É©„Éº:', event.error);
    });

    window.addEventListener('unhandledrejection', (event) => {
        console.error('Êú™Âá¶ÁêÜ„ÅÆPromiseÊãíÂê¶:', event.reason);
    });
</script>